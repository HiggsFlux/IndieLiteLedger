import{a as le,u as te,b as ae,f as oe,c as ne,d as se,e as ue}from"./email-CkdC8qP5.js";import{d as ie,r as d,M as de,N as re,b as N,o as k,f as l,w as a,y as me,e as c,p as pe,q as fe,a0 as ce,S as ve,E as _e,g as s,J as ye,O as ge,c as O,P as Ve,Q as be,t as b,R as we,U as xe,a1 as Ee,W as ke,X as Te,a2 as r,a3 as Ce,a4 as Ue}from"./index-xTveqTne.js";const Me={class:"h-full flex gap-4 overflow-hidden"},Se={class:"flex gap-4 mt-4"},Ie={class:"flex justify-between items-center"},je={key:1},De={class:"py-4"},Re={class:"w-full"},$e={class:"mb-2 text-gray-500 text-sm"},Be={class:"flex justify-end gap-2"},z=ie({name:"commercial_mail-config",__name:"index",setup(Ne){const u=d({id:0,smtp_host:"",smtp_port:465,username:"",password:"",sender_name:"TalkMyData Official",use_ssl:!0}),T=d(!1),F=d(!1),_=d(!1),w=d(""),C=d(!1),U=d(),P={smtp_host:[{required:!0,message:"请输入SMTP服务器地址",trigger:"blur"}],username:[{required:!0,message:"请输入邮箱账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},j=d([]),M=d(!1),v=d(!1),y=d(null),S=d(!1),D=d(),f={client_name:"{{client_name}}",license_key:"{{license_key}}",product_name:"{{product_name}}",expire_date:"{{expire_date}}"},n=de({name:"",subject:"",content:"",type:"DELIVERY",is_active:!0});async function h(){try{const{data:o}=await le();o&&(u.value=o)}catch{r.error("获取配置失败")}}async function A(){U.value&&await U.value.validate(async o=>{if(o){T.value=!0;try{await te(u.value),r.success("保存成功")}catch{r.error("保存失败")}finally{T.value=!1}}})}async function H(){if(!w.value){r.warning("请输入测试邮箱");return}C.value=!0;try{await ae(w.value),r.success("发送成功"),_.value=!1}catch{r.error("发送失败")}finally{C.value=!1}}async function I(){M.value=!0;try{const{data:o}=await oe();o&&(j.value=o)}catch{r.error("获取模板列表失败")}finally{M.value=!1}}function J(){y.value=null,n.name="",n.subject="",n.content="",n.type="DELIVERY",n.is_active=!0,v.value=!0}function K(o){y.value=o,n.name=o.name,n.subject=o.subject,n.content=o.content,n.type=o.type,n.is_active=o.is_active,v.value=!0}async function Q(){S.value=!0;try{const o={...n};y.value?(await ne(y.value.id,o),r.success("更新成功")):(await se(o),r.success("创建成功")),v.value=!1,I()}catch{r.error("保存失败")}finally{S.value=!1}}function W(o){Ce.confirm("确定要删除该模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ue(o.id),r.success("删除成功"),I()}catch{r.error("删除失败")}})}function x(o){const e=D.value?.textarea;if(e){const m=e.selectionStart,i=e.selectionEnd,E=n.content;n.content=E.substring(0,m)+o+E.substring(i),setTimeout(()=>{e.selectionStart=e.selectionEnd=m+o.length,e.focus()})}else n.content+=o}return re(()=>{h(),I()}),(o,e)=>{const m=fe,i=pe,E=ce,R=ve,p=_e,$=me,B=ye,g=be,V=we,X=Ve,L=Ee,q=Te,G=ke,Z=xe;return k(),N("div",Me,[l(B,{class:"w-1/3 flex-shrink-0 h-full flex flex-col",header:"SMTP设置"},{default:a(()=>[l($,{ref_key:"formRef",ref:U,model:u.value,rules:P,"label-width":"100px",class:"mt-4"},{default:a(()=>[l(i,{label:"服务器地址",prop:"smtp_host"},{default:a(()=>[l(m,{modelValue:u.value.smtp_host,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.smtp_host=t),placeholder:"如 smtp.exmail.qq.com"},null,8,["modelValue"])]),_:1}),l(i,{label:"端口",prop:"smtp_port"},{default:a(()=>[l(E,{modelValue:u.value.smtp_port,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.smtp_port=t),placeholder:"如 465",class:"w-full",min:1,max:65535,"controls-position":"right"},null,8,["modelValue"])]),_:1}),l(i,{label:"发件人邮箱",prop:"username"},{default:a(()=>[l(m,{modelValue:u.value.username,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.username=t),placeholder:"请输入邮箱账号",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),l(i,{label:"邮箱密码",prop:"password"},{default:a(()=>[l(m,{modelValue:u.value.password,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.password=t),type:"password","show-password":"",placeholder:"请输入密码或授权码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),l(i,{label:"发件人昵称",prop:"sender_name"},{default:a(()=>[l(m,{modelValue:u.value.sender_name,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.sender_name=t),placeholder:"如 TalkMyData Official"},null,8,["modelValue"])]),_:1}),l(i,{label:"SSL加密",prop:"use_ssl"},{default:a(()=>[l(R,{modelValue:u.value.use_ssl,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.use_ssl=t)},null,8,["modelValue"])]),_:1}),c("div",Se,[l(p,{type:"primary",loading:T.value,onClick:A},{default:a(()=>[...e[21]||(e[21]=[s("保存配置",-1)])]),_:1},8,["loading"]),l(p,{loading:F.value,onClick:e[6]||(e[6]=t=>_.value=!0)},{default:a(()=>[...e[22]||(e[22]=[s("发送测试邮件",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])]),_:1}),l(B,{class:"flex-1 h-full flex flex-col","body-style":"flex: 1; display: flex; flex-direction: column; overflow: hidden;"},{header:a(()=>[c("div",Ie,[e[24]||(e[24]=c("span",null,"模板管理",-1)),l(p,{type:"primary",size:"small",onClick:J},{default:a(()=>[...e[23]||(e[23]=[s("新增模板",-1)])]),_:1})])]),default:a(()=>[ge((k(),O(X,{data:j.value,style:{width:"100%",height:"100%"},class:"flex-1",height:"100%"},{default:a(()=>[l(g,{prop:"name",label:"模板名称"}),l(g,{prop:"subject",label:"标题","show-overflow-tooltip":""}),l(g,{prop:"type",label:"类型",width:"100"},{default:a(({row:t})=>[s(b(t.type==="DELIVERY"?"交付":"通知"),1)]),_:1}),l(g,{prop:"is_active",label:"状态",width:"100"},{default:a(({row:t})=>[t.is_active?(k(),O(V,{key:0,type:"success",size:"small"},{default:a(()=>[...e[25]||(e[25]=[s("默认",-1)])]),_:1})):(k(),N("span",je,"-"))]),_:1}),l(g,{label:"操作",width:"150",align:"center"},{default:a(({row:t})=>[l(p,{link:"",type:"primary",size:"small",onClick:ee=>K(t)},{default:a(()=>[...e[26]||(e[26]=[s("编辑",-1)])]),_:2},1032,["onClick"]),l(p,{link:"",type:"danger",size:"small",onClick:ee=>W(t)},{default:a(()=>[...e[27]||(e[27]=[s("删除",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Z,M.value]])]),_:1}),l(L,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=t=>_.value=t),title:"发送测试邮件",width:"500px"},{footer:a(()=>[l(p,{onClick:e[8]||(e[8]=t=>_.value=!1)},{default:a(()=>[...e[28]||(e[28]=[s("取消",-1)])]),_:1}),l(p,{type:"primary",loading:C.value,onClick:H},{default:a(()=>[...e[29]||(e[29]=[s("发送",-1)])]),_:1},8,["loading"])]),default:a(()=>[c("div",De,[l(m,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=t=>w.value=t),placeholder:"请输入接收测试邮件的邮箱地址"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),l(L,{modelValue:v.value,"onUpdate:modelValue":e[20]||(e[20]=t=>v.value=t),title:y.value?"编辑模板":"新增模板",width:"800px"},{footer:a(()=>[c("div",Be,[l(p,{onClick:e[19]||(e[19]=t=>v.value=!1)},{default:a(()=>[...e[31]||(e[31]=[s("取消",-1)])]),_:1}),l(p,{type:"primary",loading:S.value,onClick:Q},{default:a(()=>[...e[32]||(e[32]=[s("保存",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l($,{model:n,"label-position":"top"},{default:a(()=>[l(i,{label:"模板名称",prop:"name"},{default:a(()=>[l(m,{modelValue:n.name,"onUpdate:modelValue":e[10]||(e[10]=t=>n.name=t),placeholder:"如：正式版交付话术"},null,8,["modelValue"])]),_:1}),l(i,{label:"邮件标题",prop:"subject"},{default:a(()=>[l(m,{modelValue:n.subject,"onUpdate:modelValue":e[11]||(e[11]=t=>n.subject=t),placeholder:"邮件标题"},null,8,["modelValue"])]),_:1}),l(i,{label:"邮件正文",prop:"content"},{default:a(()=>[c("div",Re,[c("div",$e,[e[30]||(e[30]=s(" 可用变量： ",-1)),l(V,{class:"cursor-pointer mr-2",onClick:e[12]||(e[12]=t=>x(f.client_name))},{default:a(()=>[s(b(f.client_name),1)]),_:1}),l(V,{class:"cursor-pointer mr-2",onClick:e[13]||(e[13]=t=>x(f.license_key))},{default:a(()=>[s(b(f.license_key),1)]),_:1}),l(V,{class:"cursor-pointer mr-2",onClick:e[14]||(e[14]=t=>x(f.product_name))},{default:a(()=>[s(b(f.product_name),1)]),_:1}),l(V,{class:"cursor-pointer mr-2",onClick:e[15]||(e[15]=t=>x(f.expire_date))},{default:a(()=>[s(b(f.expire_date),1)]),_:1})]),l(m,{ref_key:"contentInputRef",ref:D,modelValue:n.content,"onUpdate:modelValue":e[16]||(e[16]=t=>n.content=t),type:"textarea",rows:10,placeholder:"请输入邮件正文，支持HTML"},null,8,["modelValue"])])]),_:1}),l(i,{label:"类型",prop:"type"},{default:a(()=>[l(G,{modelValue:n.type,"onUpdate:modelValue":e[17]||(e[17]=t=>n.type=t)},{default:a(()=>[l(q,{label:"交付",value:"DELIVERY"}),l(q,{label:"通知",value:"NOTIFY"})]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"默认选中",prop:"is_active"},{default:a(()=>[l(R,{modelValue:n.is_active,"onUpdate:modelValue":e[18]||(e[18]=t=>n.is_active=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Le="commercial_mail-config",qe={title:"commercial_mail-config",i18nKey:"route.commercial_mail-config",order:3},Y={name:Le,meta:qe};typeof Y=="function"&&Y(z);const ze=Ue(z,[["__scopeId","data-v-c501e671"]]);export{ze as default};
