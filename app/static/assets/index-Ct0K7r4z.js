import{aq as E,d as z,au as Q,r as i,N as Z,b as h,o as c,f as a,w as o,y as x,p as ee,q as ae,x as A,E as le,g as u,t as d,J as oe,e as M,O as se,c as k,ai as te,aj as ne,R as re,h as ue,ab as de,P as me,G as S,W as D,aw as ie,ag as ce,X as pe,ah as fe,ao as ve,al as we,ac as $}from"./index-DLYPaTml.js";import{f as ge}from"./role-Kmq_HSPA.js";function be(p){return E({url:"/user",method:"get",params:p})}function _e(p){return E({url:"/user",method:"post",data:p})}function ye(p,n){return E({url:`/user/${p}`,method:"put",data:n})}function he(p){return E({url:`/user/${p}`,method:"delete"})}const $e={class:"h-full overflow-hidden flex flex-col p-4"},Ve={class:"mb-4"},ke={key:1},Ee={class:"dialog-footer"},Ne=z({name:"manage_user",__name:"index",setup(p){const{t:n}=Q(),U=i(!1),V=i([]),B=i([]),f=i({username:"",nickname:""}),g=i(!1),m=i("add"),C=i(""),b=i(!1),t=i({username:"",password:"",old_password:"",nickname:"",role_id:"",is_active:!0});async function q(){try{const e=await ge();e.data&&Array.isArray(e.data)&&(B.value=e.data)}catch(e){console.error("Error fetching role list:",e)}}async function y(){U.value=!0;try{const e=await be(f.value);e.data&&Array.isArray(e.data)?V.value=e.data:(console.warn("User list data is not an array:",e.data),V.value=[])}catch(e){console.error("Error fetching user list:",e),V.value=[]}finally{U.value=!1}}function N(){y()}function I(){f.value={username:"",nickname:""},y()}function Y(){m.value="add",C.value="",b.value=!1,t.value={username:"",password:"",old_password:"",nickname:"",role_id:"",is_active:!0},g.value=!0}function F(e){m.value="edit",C.value=e.id,b.value=!1,t.value={username:e.username,nickname:e.nickname,role_id:e.role?.id||e.role_id||"",is_active:e.is_active,password:"",old_password:""},g.value=!0}async function K(e){try{await we.confirm(n("manage.user.deleteConfirm"),n("common.warning"),{type:"warning",confirmButtonText:n("common.delete"),cancelButtonText:n("common.cancel")}),await he(e.id),$.success(n("common.deleteSuccess")),y()}catch{}}async function j(){try{const e={...t.value};if(m.value==="edit")if(b.value){if(!e.password||!e.old_password){$.warning(n("manage.user.form.password"));return}}else delete e.password,delete e.old_password;else if(m.value==="add"&&!e.password){$.warning(n("manage.user.form.password"));return}m.value==="add"?(await _e(e),$.success(n("common.addSuccess"))):(await ye(C.value,e),$.success(n("common.updateSuccess"))),g.value=!1,y()}catch(e){console.error("Error submitting user form:",e)}}return Z(()=>{q(),y()}),(e,s)=>{const v=ae,r=ee,w=le,P=x,T=oe,_=ne,R=re,G=te,L=ie,H=fe,O=ce,J=ve,W=me;return c(),h("div",$e,[a(T,{class:"mb-4"},{default:o(()=>[a(P,{inline:!0,model:f.value},{default:o(()=>[a(r,{label:e.$t("manage.user.userName")},{default:o(()=>[a(v,{modelValue:f.value.username,"onUpdate:modelValue":s[0]||(s[0]=l=>f.value.username=l),placeholder:e.$t("manage.user.form.userName"),clearable:"",onKeyup:A(N,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("manage.user.nickName")},{default:o(()=>[a(v,{modelValue:f.value.nickname,"onUpdate:modelValue":s[1]||(s[1]=l=>f.value.nickname=l),placeholder:e.$t("manage.user.form.nickName"),clearable:"",onKeyup:A(N,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,null,{default:o(()=>[a(w,{type:"primary",onClick:N},{default:o(()=>[u(d(e.$t("common.search")),1)]),_:1}),a(w,{onClick:I},{default:o(()=>[u(d(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(T,{class:"flex-1 overflow-hidden flex flex-col"},{default:o(()=>[M("div",Ve,[a(w,{type:"primary",onClick:Y},{default:o(()=>[u(d(e.$t("manage.user.addUser")),1)]),_:1})]),se((c(),k(G,{data:V.value,border:"",style:{width:"100%",flex:"1",overflow:"auto"}},{default:o(()=>[a(_,{prop:"username",label:e.$t("manage.user.userName"),"min-width":"120"},null,8,["label"]),a(_,{prop:"nickname",label:e.$t("manage.user.nickName"),"min-width":"120"},null,8,["label"]),a(_,{prop:"role",label:e.$t("manage.user.userRole"),"min-width":"120"},{default:o(({row:l})=>[l.role?(c(),k(R,{key:0},{default:o(()=>[u(d(l.role.name),1)]),_:2},1024)):(c(),h("span",ke,"-"))]),_:1},8,["label"]),a(_,{prop:"is_active",label:e.$t("manage.user.userStatus"),"min-width":"100"},{default:o(({row:l})=>[a(R,{type:l.is_active?"success":"danger"},{default:o(()=>[u(d(l.is_active?e.$t("common.status.enable"):e.$t("common.status.disable")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(_,{prop:"created_at",label:e.$t("manage.user.createTime"),"min-width":"160"},{default:o(({row:l})=>[u(d(ue(de)(l.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),a(_,{label:e.$t("common.action"),width:"180",fixed:"right"},{default:o(({row:l})=>[a(w,{link:"",type:"primary",onClick:X=>F(l)},{default:o(()=>[u(d(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),a(w,{link:"",type:"danger",onClick:X=>K(l)},{default:o(()=>[u(d(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[W,U.value]])]),_:1}),a(J,{modelValue:g.value,"onUpdate:modelValue":s[11]||(s[11]=l=>g.value=l),title:m.value==="add"?e.$t("manage.user.addUser"):e.$t("manage.user.editUser"),width:"500px"},{footer:o(()=>[M("span",Ee,[a(w,{onClick:s[10]||(s[10]=l=>g.value=!1)},{default:o(()=>[u(d(e.$t("common.cancel")),1)]),_:1}),a(w,{type:"primary",onClick:j},{default:o(()=>[u(d(e.$t("common.confirm")),1)]),_:1})])]),default:o(()=>[a(P,{model:t.value,"label-width":"80px"},{default:o(()=>[a(r,{label:e.$t("manage.user.userName")},{default:o(()=>[a(v,{modelValue:t.value.username,"onUpdate:modelValue":s[2]||(s[2]=l=>t.value.username=l),placeholder:e.$t("manage.user.form.userName"),disabled:m.value==="edit",autocomplete:"off"},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),m.value==="add"?(c(),k(r,{key:0,label:e.$t("manage.user.password")},{default:o(()=>[a(v,{modelValue:t.value.password,"onUpdate:modelValue":s[3]||(s[3]=l=>t.value.password=l),type:"password",placeholder:e.$t("manage.user.form.password"),"show-password":"",autocomplete:"new-password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):S("",!0),m.value==="edit"?(c(),h(D,{key:1},[a(r,{label:e.$t("manage.user.form.changePassword")},{default:o(()=>[a(L,{modelValue:b.value,"onUpdate:modelValue":s[4]||(s[4]=l=>b.value=l)},null,8,["modelValue"])]),_:1},8,["label"]),b.value?(c(),h(D,{key:0},[a(r,{label:e.$t("manage.user.form.oldPassword")},{default:o(()=>[a(v,{modelValue:t.value.old_password,"onUpdate:modelValue":s[5]||(s[5]=l=>t.value.old_password=l),type:"password",placeholder:e.$t("manage.user.form.oldPassword"),"show-password":"",autocomplete:"new-password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("manage.user.form.newPassword")},{default:o(()=>[a(v,{modelValue:t.value.password,"onUpdate:modelValue":s[6]||(s[6]=l=>t.value.password=l),type:"password",placeholder:e.$t("manage.user.form.newPassword"),"show-password":"",autocomplete:"new-password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):S("",!0)],64)):S("",!0),a(r,{label:e.$t("manage.user.nickName")},{default:o(()=>[a(v,{modelValue:t.value.nickname,"onUpdate:modelValue":s[7]||(s[7]=l=>t.value.nickname=l),placeholder:e.$t("manage.user.form.nickName"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("manage.user.userRole")},{default:o(()=>[a(O,{modelValue:t.value.role_id,"onUpdate:modelValue":s[8]||(s[8]=l=>t.value.role_id=l),placeholder:e.$t("manage.user.form.userRole"),clearable:""},{default:o(()=>[(c(!0),h(D,null,pe(B.value,l=>(c(),k(H,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("manage.user.userStatus")},{default:o(()=>[a(L,{modelValue:t.value.is_active,"onUpdate:modelValue":s[9]||(s[9]=l=>t.value.is_active=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ne as default};
