import{at as v,d as A,af as T,r as b,N as D,b as w,o as i,e as m,f as s,c as p,w as a,g as d,_ as I,E as S,b8 as Y,ak as j,W as R,X as V,R as q,t as _,a9 as z,aj as F,ac as G}from"./index-CN2tD0BG.js";function H(l){return v({url:"/plugins/commercial/license/record/list",method:"get",params:l})}function W(l){return v({url:"/plugins/commercial/license/config/list",method:"get",params:l})}const X={class:"h-full flex flex-col"},$={class:"mb-4"},J={class:"grid grid-cols-2 gap-2 px-2 py-1"},O=A({__name:"LicenseTab",props:{clientId:{},clientName:{},clientStatus:{}},setup(l){const f=l,x=T(),r=b([]),h=b({});function k(e){return e?G(e).format("YYYY-MM-DD HH:mm"):"-"}async function C(){try{const{data:e}=await W({is_active:void 0});if(e){const u=Array.isArray(e)?e:e.items||[],o={};u.forEach(n=>{n.module_name_cn&&(o[n.module_code]=n.module_name_cn,o[n.module_name]=n.module_name_cn)}),h.value=o}}catch(e){console.error("Failed to fetch module configs",e)}}function E(e){return h.value[e]||e}async function L(){const{data:e}=await H({keyword:f.clientName});e&&(e.items?r.value=e.items:Array.isArray(e)?r.value=e:r.value=[])}function N(){x.push({name:"commercial_generate",query:{client_id:f.clientId}})}return D(()=>{f.clientName&&(C(),L())}),(e,u)=>{const o=I,n=S,B=Y,c=j,y=q,M=F;return i(),w("div",X,[m("div",$,[e.clientStatus!==9?(i(),p(n,{key:0,type:"primary",onClick:N},{icon:a(()=>[s(o,{icon:"carbon:flash"})]),default:a(()=>[u[0]||(u[0]=d(" 签发新授权 ",-1))]),_:1})):(i(),p(B,{key:1,title:"黑名单用户不允许签发新授权",type:"error",closable:!1,"show-icon":"",class:"!w-fit"}))]),s(M,{data:r.value,border:"",style:{width:"100%",flex:"1"},height:"100%"},{default:a(()=>[s(c,{prop:"license_key",label:"授权码","min-width":"220","show-overflow-tooltip":""}),s(c,{label:"模块",width:"260","show-overflow-tooltip":""},{default:a(({row:t})=>[m("div",J,[(i(!0),w(R,null,V(t.summary_modules.split(", ").filter(Boolean),g=>(i(),p(y,{key:g,size:"small",type:"info",effect:"plain",class:"w-full justify-center"},{default:a(()=>[d(_(E(g)),1)]),_:2},1024))),128))])]),_:1}),s(c,{prop:"created_at",label:"签发时间",width:"180"},{default:a(({row:t})=>[d(_(k(t.created_at)),1)]),_:1}),s(c,{prop:"expire_at_min",label:"过期时间",width:"120"},{default:a(({row:t})=>[m("span",{class:z(t.is_expired?"text-red-500":"text-green-600")},_(t.expire_at_min||"永久"),3)]),_:1}),s(c,{label:"状态",width:"100"},{default:a(({row:t})=>[s(y,{type:t.is_expired?"danger":"success"},{default:a(()=>[d(_(t.is_expired?"已过期":"正常"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])}}});export{O as default};
