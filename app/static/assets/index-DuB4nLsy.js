import{d as $,r,N as H,b as P,o as v,f as e,w as a,y as j,p as G,q as J,x as D,E as Q,g as n,J as W,e as R,O as X,c as k,P as z,Q as Z,R as ee,t as le,h as U,a9 as ae,U as te,aF as oe,W as de,X as ne,a1 as se,a3 as re,a2 as h}from"./index-xTveqTne.js";import{f as ie,a as ue,b as me,c as ce}from"./role-CbqmSXZY.js";const pe={class:"h-full overflow-hidden flex flex-col p-4"},fe={class:"mb-4"},_e={class:"dialog-footer"},ge=$({name:"manage_role",__name:"index",setup(be){const y=r(!1),_=r([]),B=r(),i=r({name:"",code:""}),m=r(!1),b=r("add"),g=r(""),d=r({name:"",code:"",description:"",menu_keys:[],data_scope:2,is_system:!1}),T={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色标识",trigger:"blur"}],data_scope:[{required:!0,message:"请选择数据权限",trigger:"change"}]},M=[{id:"dashboard",label:"仪表盘",children:[{id:"dashboard_analysis",label:"销售分析"},{id:"dashboard_workbench",label:"工作台"}]},{id:"customer",label:"客户管理",children:[{id:"customer_list",label:"客户列表"},{id:"customer_detail",label:"客户详情"}]},{id:"commercial",label:"授权管理",children:[{id:"commercial_generate",label:"授权码生成"},{id:"commercial_history",label:"授权记录"},{id:"commercial_config",label:"授权配置"},{id:"commercial_mail-config",label:"邮件配置"}]},{id:"manage",label:"用户权限",children:[{id:"manage_user",label:"用户管理"},{id:"manage_role",label:"角色管理"}]},{id:"order",label:"财务管理",children:[{id:"order_list",label:"订单列表"},{id:"order_expense",label:"成本支出"}]}];async function p(){y.value=!0;try{const o=await ie(i.value);o.data&&Array.isArray(o.data)?_.value=o.data:_.value=[]}catch(o){console.error("Error fetching role list:",o),_.value=[]}finally{y.value=!1}}function V(){p()}function q(){i.value={name:"",code:""},p()}function N(){b.value="add",g.value="",d.value={name:"",code:"",description:"",menu_keys:[],data_scope:2,is_system:!1},m.value=!0}function A(o){b.value="edit",g.value=o.id,d.value={name:o.name,code:o.code,description:o.description,menu_keys:o.menu_keys,data_scope:o.data_scope,is_system:o.is_system},m.value=!0}async function I(o){try{await re.confirm("确定要删除此角色吗？","警告",{type:"warning",confirmButtonText:"删除",cancelButtonText:"取消"}),await ue(o.id),h.success("删除成功"),p()}catch{}}async function S(){try{b.value==="add"?(await me(d.value),h.success("创建成功")):(await ce(g.value,d.value),h.success("更新成功")),m.value=!1,p()}catch(o){console.error("Error submitting role form:",o)}}return H(()=>{p()}),(o,l)=>{const f=J,s=G,u=Q,x=j,E=W,c=Z,w=ee,Y=z,C=ne,F=de,K=se,L=te;return v(),P("div",pe,[e(E,{class:"mb-4"},{default:a(()=>[e(x,{inline:!0,model:i.value},{default:a(()=>[e(s,{label:"角色名称"},{default:a(()=>[e(f,{modelValue:i.value.name,"onUpdate:modelValue":l[0]||(l[0]=t=>i.value.name=t),placeholder:"请输入角色名称",clearable:"",onKeyup:D(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"角色标识"},{default:a(()=>[e(f,{modelValue:i.value.code,"onUpdate:modelValue":l[1]||(l[1]=t=>i.value.code=t),placeholder:"请输入角色标识",clearable:"",onKeyup:D(V,["enter"])},null,8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(u,{type:"primary",onClick:V},{default:a(()=>[...l[8]||(l[8]=[n("查询",-1)])]),_:1}),e(u,{onClick:q},{default:a(()=>[...l[9]||(l[9]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(E,{class:"flex-1 overflow-hidden flex flex-col"},{default:a(()=>[R("div",fe,[e(u,{type:"primary",onClick:N},{default:a(()=>[...l[10]||(l[10]=[n("新增角色",-1)])]),_:1})]),X((v(),k(Y,{data:_.value,border:"",style:{width:"100%",flex:"1",overflow:"auto"}},{default:a(()=>[e(c,{prop:"name",label:"角色名称","min-width":"120"}),e(c,{prop:"code",label:"角色标识","min-width":"120"}),e(c,{prop:"description",label:"描述","min-width":"150"}),e(c,{prop:"data_scope",label:"数据权限","min-width":"100"},{default:a(({row:t})=>[t.data_scope===1?(v(),k(w,{key:0,type:"danger"},{default:a(()=>[...l[11]||(l[11]=[n("全部数据",-1)])]),_:1})):(v(),k(w,{key:1,type:"info"},{default:a(()=>[...l[12]||(l[12]=[n("仅本人数据",-1)])]),_:1}))]),_:1}),e(c,{prop:"created_at",label:"创建时间","min-width":"160"},{default:a(({row:t})=>[n(le(U(ae)(t.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(c,{label:"操作",width:"180",fixed:"right"},{default:a(({row:t})=>[e(u,{link:"",type:"primary",onClick:O=>A(t)},{default:a(()=>[...l[13]||(l[13]=[n("编辑",-1)])]),_:2},1032,["onClick"]),e(u,{link:"",type:"danger",onClick:O=>I(t)},{default:a(()=>[...l[14]||(l[14]=[n("删除",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,y.value]])]),_:1}),e(K,{modelValue:m.value,"onUpdate:modelValue":l[7]||(l[7]=t=>m.value=t),title:b.value==="add"?"新增角色":"编辑角色",width:"500px"},{footer:a(()=>[R("span",_e,[e(u,{onClick:l[6]||(l[6]=t=>m.value=!1)},{default:a(()=>[...l[15]||(l[15]=[n("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:S},{default:a(()=>[...l[16]||(l[16]=[n("确定",-1)])]),_:1})])]),default:a(()=>[e(x,{ref:"formRef",model:d.value,rules:T,"label-width":"80px"},{default:a(()=>[e(s,{label:"角色名称",prop:"name"},{default:a(()=>[e(f,{modelValue:d.value.name,"onUpdate:modelValue":l[2]||(l[2]=t=>d.value.name=t),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"角色标识",prop:"code"},{default:a(()=>[e(f,{modelValue:d.value.code,"onUpdate:modelValue":l[3]||(l[3]=t=>d.value.code=t),placeholder:"请输入角色标识 (如: ADMIN)"},null,8,["modelValue"])]),_:1}),e(s,{label:"描述",prop:"description"},{default:a(()=>[e(f,{modelValue:d.value.description,"onUpdate:modelValue":l[4]||(l[4]=t=>d.value.description=t),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(s,{label:"菜单权限"},{default:a(()=>[e(U(oe),{ref_key:"treeRef",ref:B,data:M,"show-checkbox":"","node-key":"id",props:{label:"label",children:"children"}},null,512)]),_:1}),e(s,{label:"数据权限",prop:"data_scope"},{default:a(()=>[e(F,{modelValue:d.value.data_scope,"onUpdate:modelValue":l[5]||(l[5]=t=>d.value.data_scope=t),placeholder:"请选择数据权限"},{default:a(()=>[e(C,{label:"全部数据",value:1}),e(C,{label:"仅本人数据",value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ge as default};
