import{d as z,a as T,r as k,af as W,$ as e,am as oe,c as R,o as D,w as l,f as t,y as J,p as X,h as a,ag as re,b as O,W as H,X as j,ah as ne,q as Z,ax as de,E as Y,g as v,t as r,ao as se,ac as L,G as B,N as Q,e as u,O as ie,P as ue,ai as ce,aj as me,a9 as we,ab as ee,al as te,az as De,_ as xe,J as pe,U as Ee,V as ke,R as _e,a0 as Me,a1 as Ce,aA as Ve,ad as fe,ae as Ie,x as le,ak as Ne}from"./index-DLYPaTml.js";import{c as $e,u as G,a as Oe,f as Ae,d as Le,b as Pe,e as Re,g as Te,h as Ue,v as Se}from"./order-CWAkhiTI.js";import{b as Fe}from"./client-7Sf9uVTU.js";const ze=z({__name:"OrderForm",props:{visible:{type:Boolean},operateType:{},rowData:{}},emits:["update:visible","submitted"],setup(P,{emit:I}){const d=P,f=I,m=T({get:()=>d.visible,set:p=>f("update:visible",p)}),h=k(),V=k(!1),n=k([]),M=k(!1),o=W({client_id:"",product_info:"",amount:0,order_type:"NEW",remark:""}),x={client_id:[{required:!0,message:e("order.list.validation.client"),trigger:"change"}],product_info:[{required:!0,message:e("order.list.validation.productInfo"),trigger:"blur"}],amount:[{required:!0,message:e("order.list.validation.amount"),trigger:"blur"}],order_type:[{required:!0,message:e("order.list.validation.orderType"),trigger:"change"}]},i=[{label:e("order.list.typeMap.new"),value:"NEW"},{label:e("order.list.typeMap.renew"),value:"RENEW"},{label:e("order.list.typeMap.upsell"),value:"UPSELL"},{label:e("order.list.typeMap.service"),value:"SERVICE"},{label:e("order.list.typeMap.implementation"),value:"IMPLEMENTATION"}];async function c(p){if(p){M.value=!0;try{const{data:_}=await Fe({name:p,limit:20});_&&(Array.isArray(_)?n.value=_:_.items&&(n.value=_.items))}finally{M.value=!1}}else n.value=[]}oe(()=>d.visible,p=>{p&&(d.operateType==="edit"&&d.rowData?(d.rowData.client_info&&(n.value=[d.rowData.client_info]),Object.assign(o,{client_id:d.rowData.client_id,product_info:d.rowData.product_info,amount:d.rowData.amount,order_type:d.rowData.order_type,remark:d.rowData.remark})):(Object.assign(o,{client_id:"",product_info:"",amount:0,order_type:"NEW",remark:""}),n.value=[]))});async function w(){await h.value?.validate(),V.value=!0;try{if(d.operateType==="add"){const{error:p}=await $e(o);if(p){L.error(p.message||"Failed to create order");return}L.success(e("common.addSuccess"))}else if(d.operateType==="edit"&&d.rowData){const{error:p}=await G(d.rowData.id,{product_info:o.product_info,amount:o.amount,order_type:o.order_type,remark:o.remark});if(p){L.error(p.message||"Failed to update order");return}L.success(e("common.updateSuccess"))}f("submitted"),m.value=!1}finally{V.value=!1}}return(p,_)=>{const g=ne,N=re,A=X,$=Z,U=de,C=J,s=Y,E=se;return D(),R(E,{modelValue:m.value,"onUpdate:modelValue":_[6]||(_[6]=b=>m.value=b),title:p.operateType==="add"?a(e)("order.list.addOrder"):a(e)("order.list.editOrder"),width:"600px"},{footer:l(()=>[t(s,{onClick:_[5]||(_[5]=b=>m.value=!1)},{default:l(()=>[v(r(a(e)("common.cancel")),1)]),_:1}),t(s,{type:"primary",loading:V.value,onClick:w},{default:l(()=>[v(r(a(e)("common.confirm")),1)]),_:1},8,["loading"])]),default:l(()=>[t(C,{ref_key:"formRef",ref:h,model:o,rules:x,"label-width":"100px"},{default:l(()=>[t(A,{label:a(e)("order.list.clientName"),prop:"client_id"},{default:l(()=>[t(N,{modelValue:o.client_id,"onUpdate:modelValue":_[0]||(_[0]=b=>o.client_id=b),filterable:"",remote:"","reserve-keyword":"",placeholder:a(e)("common.keywordSearch"),"remote-method":c,loading:M.value,class:"w-full",disabled:p.operateType==="edit"},{default:l(()=>[(D(!0),O(H,null,j(n.value,b=>(D(),R(g,{key:b.id,label:b.name,value:b.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading","disabled"])]),_:1},8,["label"]),t(A,{label:a(e)("order.list.productInfo"),prop:"product_info"},{default:l(()=>[t($,{modelValue:o.product_info,"onUpdate:modelValue":_[1]||(_[1]=b=>o.product_info=b),placeholder:a(e)("order.list.productInfoPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(A,{label:a(e)("order.list.amount"),prop:"amount"},{default:l(()=>[t(U,{modelValue:o.amount,"onUpdate:modelValue":_[2]||(_[2]=b=>o.amount=b),min:0,precision:2,class:"w-full"},null,8,["modelValue"])]),_:1},8,["label"]),t(A,{label:a(e)("order.list.type"),prop:"order_type"},{default:l(()=>[t(N,{modelValue:o.order_type,"onUpdate:modelValue":_[3]||(_[3]=b=>o.order_type=b),class:"w-full"},{default:l(()=>[(D(),O(H,null,j(i,b=>t(g,{key:b.value,label:b.label,value:b.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(A,{label:a(e)("common.remark"),prop:"remark"},{default:l(()=>[t($,{modelValue:o.remark,"onUpdate:modelValue":_[4]||(_[4]=b=>o.remark=b),type:"textarea",rows:3},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Be={key:0,class:"text-xs text-gray-400 mt-1"},Ye=z({__name:"PaymentConfirmDialog",props:{visible:{type:Boolean},orderId:{},type:{},amountLimit:{}},emits:["update:visible","submitted"],setup(P,{emit:I}){const d=P,f=I,m=T({get:()=>d.visible,set:i=>f("update:visible",i)}),h=k(),V=k(!1),n=W({amount:0,pay_method:"BANK",transaction_id:"",remark:""}),M=[{label:e("order.list.payMethodMap.wechat"),value:"WECHAT"},{label:e("order.list.payMethodMap.alipay"),value:"ALIPAY"},{label:e("order.list.payMethodMap.bank"),value:"BANK"},{label:e("order.list.payMethodMap.cash"),value:"CASH"}],o={amount:[{required:!0,message:e("order.list.validation.amount"),trigger:"blur"},{validator:(i,c,w)=>{c<=0?w(new Error(e("order.detail.payment.validation.amountGreaterZero"))):d.amountLimit!==void 0&&c>d.amountLimit&&d.type==="REFUND"?w(new Error(e("order.detail.payment.validation.refundExceedNetPaid"))):w()},trigger:"blur"}],transaction_id:[{required:!0,message:e("order.detail.payment.validation.transactionId"),trigger:"blur"}]};oe(()=>d.visible,i=>{i&&(n.amount=d.amountLimit||0,n.pay_method="BANK",n.transaction_id="",n.remark="")});async function x(){await h.value?.validate(),V.value=!0;try{let i=n.amount;d.type==="REFUND"?i=-Math.abs(i):i=Math.abs(i),await Oe(d.orderId,{amount:i,pay_method:n.pay_method,transaction_id:n.transaction_id,remark:n.remark}),L.success(d.type==="COLLECTION"?e("order.detail.payment.success.collectionSuccess"):e("order.detail.payment.success.refundSuccess")),f("submitted"),m.value=!1}finally{V.value=!1}}return(i,c)=>{const w=de,p=X,_=ne,g=re,N=Z,A=J,$=Y,U=se;return D(),R(U,{modelValue:m.value,"onUpdate:modelValue":c[5]||(c[5]=C=>m.value=C),title:i.type==="COLLECTION"?a(e)("order.detail.payment.registerCollection"):a(e)("order.detail.payment.registerRefund"),width:"500px"},{footer:l(()=>[t($,{onClick:c[4]||(c[4]=C=>m.value=!1)},{default:l(()=>[v(r(a(e)("common.cancel")),1)]),_:1}),t($,{type:"primary",loading:V.value,onClick:x},{default:l(()=>[v(r(i.type==="COLLECTION"?a(e)("order.detail.payment.confirmCollection"):a(e)("order.detail.payment.confirmRefund")),1)]),_:1},8,["loading"])]),default:l(()=>[t(A,{ref_key:"formRef",ref:h,model:n,rules:o,"label-width":"100px"},{default:l(()=>[t(p,{label:i.type==="COLLECTION"?a(e)("order.detail.payment.collectionAmount"):a(e)("order.detail.payment.refundAmount"),prop:"amount"},{default:l(()=>[t(w,{modelValue:n.amount,"onUpdate:modelValue":c[0]||(c[0]=C=>n.amount=C),min:0,precision:2,class:"w-full"},null,8,["modelValue"]),i.amountLimit!==void 0?(D(),O("div",Be,r(i.type==="COLLECTION"?a(e)("order.detail.payment.maxCollection"):a(e)("order.detail.payment.maxRefund"))+": "+r(i.amountLimit),1)):B("",!0)]),_:1},8,["label"]),t(p,{label:i.type==="COLLECTION"?a(e)("order.detail.payment.payMethod"):a(e)("order.detail.payment.refundMethod"),prop:"pay_method"},{default:l(()=>[t(g,{modelValue:n.pay_method,"onUpdate:modelValue":c[1]||(c[1]=C=>n.pay_method=C),class:"w-full"},{default:l(()=>[(D(),O(H,null,j(M,C=>t(_,{key:C.value,label:C.label,value:C.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(p,{label:a(e)("order.detail.payment.transactionId"),prop:"transaction_id"},{default:l(()=>[t(N,{modelValue:n.transaction_id,"onUpdate:modelValue":c[2]||(c[2]=C=>n.transaction_id=C),placeholder:i.type==="REFUND"?a(e)("order.detail.payment.refundIdPlaceholder"):a(e)("order.detail.payment.transactionIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:a(e)("common.remark"),prop:"remark"},{default:l(()=>[t(N,{modelValue:n.remark,"onUpdate:modelValue":c[3]||(c[3]=C=>n.remark=C),type:"textarea",rows:2,placeholder:i.type==="REFUND"?a(e)("order.detail.payment.refundReasonPlaceholder"):a(e)("order.detail.payment.collectionRemarkPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),We={class:"h-full flex flex-col"},He={class:"flex items-center mb-4 bg-gray-50 p-4 rounded border border-gray-100"},je={class:"w-full flex justify-between"},qe={class:"flex-1 text-center"},Ke={class:"text-gray-500 text-xs mb-1"},Ge={class:"text-xl font-bold"},Je={class:"flex-1 text-center"},Xe={class:"text-gray-500 text-xs mb-1"},Ze={class:"text-xl font-bold text-green-600"},Qe={class:"flex-1 text-center"},et={class:"text-gray-500 text-xs mb-1"},tt={class:"text-xl font-bold text-orange-500"},at={class:"flex justify-end mb-2"},lt={class:"flex gap-2"},ot=z({__name:"PaymentTab",props:{orderId:{},amountDue:{},netPaid:{}},emits:["refresh"],setup(P,{emit:I}){const d=P,f=k(!1),m=k([]),h=k(!1),V=k("COLLECTION"),n=k(0),M=T(()=>({WECHAT:e("order.list.payMethodMap.wechat"),ALIPAY:e("order.list.payMethodMap.alipay"),BANK:e("order.list.payMethodMap.bank"),CASH:e("order.list.payMethodMap.cash")}));function o(g){return g?ee(g).format("YYYY-MM-DD HH:mm:ss"):"-"}async function x(){f.value=!0;try{const{data:g}=await Ae(d.orderId);g&&(m.value=g)}finally{f.value=!1}}function i(){V.value="COLLECTION",n.value=Math.max(0,d.amountDue-d.netPaid),h.value=!0}function c(){V.value="REFUND",n.value=d.netPaid,h.value=!0}const w=I;function p(){x(),w("refresh")}async function _(g){await te.confirm(e("common.confirmDelete"),e("common.warning"),{type:"warning"}),await Le(d.orderId,g),L.success(e("common.deleteSuccess")),x(),w("refresh")}return Q(()=>{d.orderId&&x()}),(g,N)=>{const A=Y,$=me,U=ce,C=ue;return D(),O("div",We,[u("div",He,[u("div",je,[u("div",qe,[u("div",Ke,r(a(e)("order.detail.payment.amountDue")),1),u("div",Ge,r(g.amountDue),1)]),u("div",Je,[u("div",Xe,r(a(e)("order.detail.payment.netPaid")),1),u("div",Ze,r(g.netPaid),1)]),u("div",Qe,[u("div",et,r(a(e)("order.detail.payment.remainingAmount")),1),u("div",tt,r((g.amountDue-g.netPaid).toFixed(2)),1)])])]),u("div",at,[u("div",lt,[t(A,{type:"danger",plain:"",onClick:c,disabled:g.netPaid<=0},{default:l(()=>[v(r(a(e)("order.detail.payment.registerRefund")),1)]),_:1},8,["disabled"]),t(A,{type:"primary",onClick:i,disabled:g.amountDue-g.netPaid<=0},{default:l(()=>[v(r(a(e)("order.detail.payment.registerCollection")),1)]),_:1},8,["disabled"])])]),ie((D(),R(U,{data:m.value,border:"",style:{width:"100%",flex:"1"}},{default:l(()=>[t($,{prop:"pay_time",label:a(e)("order.list.createdAt"),width:"180"},{default:l(({row:s})=>[v(r(o(s.pay_time)),1)]),_:1},8,["label"]),t($,{prop:"amount",label:a(e)("order.list.amount"),width:"120"},{default:l(({row:s})=>[u("span",{class:we(s.amount>=0?"text-green-600":"text-red-500")},r(s.amount>=0?"+":"")+r(s.amount),3)]),_:1},8,["label"]),t($,{prop:"pay_method",label:a(e)("order.detail.payment.payMethod"),width:"120"},{default:l(({row:s})=>[v(r(M.value[s.pay_method]||s.pay_method),1)]),_:1},8,["label"]),t($,{prop:"transaction_id",label:a(e)("order.detail.payment.transactionId"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),t($,{prop:"remark",label:a(e)("common.remark"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),t($,{label:a(e)("common.operate"),width:"100",fixed:"right"},{default:l(({row:s})=>[t(A,{link:"",type:"danger",onClick:E=>_(s.id)},{default:l(()=>[v(r(a(e)("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[C,f.value]]),t(Ye,{visible:h.value,"onUpdate:visible":N[0]||(N[0]=s=>h.value=s),"order-id":g.orderId,type:V.value,"amount-limit":n.value,onSubmitted:p},null,8,["visible","order-id","type","amount-limit"])])}}}),rt={class:"h-full flex flex-col p-4"},nt={class:"mb-4"},dt={class:"el-upload__tip"},st={key:0,class:"flex-1 flex items-center justify-center text-gray-400 flex-col"},it={key:1,class:"grid grid-cols-2 gap-4"},ut={class:"flex items-start gap-3"},ct={class:"p-2 bg-gray-100 rounded"},mt={class:"flex-1 min-w-0"},pt=["title"],_t={class:"text-xs text-gray-400 mt-1"},ft={class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1"},yt=["href","title"],vt=["title","onClick"],bt=z({__name:"AttachmentTab",props:{orderId:{}},setup(P){const I=P,d=k(!1),f=k([]);async function m(){d.value=!0;try{const{data:n}=await Pe(I.orderId);if(n&&n.attachments)if(typeof n.attachments=="string")try{f.value=JSON.parse(n.attachments)}catch{f.value=[]}else Array.isArray(n.attachments)?f.value=n.attachments:f.value=[];else f.value=[]}finally{d.value=!1}}async function h(n){const{file:M}=n;try{const{data:o}=await Re(M);if(o){const x=[...f.value,o];await G(I.orderId,{attachments:x}),L.success(e("order.detail.attachment.uploadSuccess")),m()}}catch{L.error(e("order.detail.attachment.uploadFailed"))}}async function V(n){await te.confirm(e("order.detail.attachment.deleteConfirm"),e("common.warning"),{type:"warning"});const M=[...f.value];M.splice(n,1),await G(I.orderId,{attachments:M}),L.success(e("common.deleteSuccess")),m()}return Q(()=>{I.orderId&&m()}),(n,M)=>{const o=xe,x=Y,i=De,c=pe;return D(),O("div",rt,[u("div",nt,[t(i,{class:"upload-demo",action:"","http-request":h,"show-file-list":!1},{tip:l(()=>[u("div",dt,r(a(e)("order.detail.attachment.uploadDesc")),1)]),default:l(()=>[t(x,{type:"primary"},{icon:l(()=>[t(o,{icon:"mdi:cloud-upload"})]),default:l(()=>[v(" "+r(a(e)("order.detail.attachment.uploadBtn")),1)]),_:1})]),_:1})]),f.value.length===0?(D(),O("div",st,[t(o,{icon:"mdi:file-document-outline",class:"text-4xl mb-2"}),u("p",null,r(a(e)("order.detail.attachment.noAttachment")),1)])):(D(),O("div",it,[(D(!0),O(H,null,j(f.value,(w,p)=>(D(),R(c,{key:p,shadow:"hover",class:"relative group"},{default:l(()=>[u("div",ut,[u("div",ct,[t(o,{icon:"mdi:file",class:"text-2xl text-blue-500"})]),u("div",mt,[u("div",{class:"font-medium truncate",title:w.name},r(w.name),9,pt),u("div",_t,r(w.type),1)])]),u("div",ft,[u("a",{href:w.url,target:"_blank",class:"p-1.5 bg-blue-50 text-blue-600 rounded hover:bg-blue-100",title:a(e)("common.download")},[t(o,{icon:"mdi:download"})],8,yt),u("button",{class:"p-1.5 bg-red-50 text-red-600 rounded hover:bg-red-100",title:a(e)("common.delete"),onClick:_=>V(p)},[t(o,{icon:"mdi:delete"})],8,vt)])]),_:2},1024))),128))]))])}}}),ht={key:0,class:"flex flex-col h-full"},gt={class:"mb-6"},wt={class:"font-bold mb-3 border-l-4 border-primary pl-2"},Dt={key:1},xt={key:0,class:"mt-2 text-gray-500 text-sm"},Et={class:"font-bold"},kt=z({__name:"OrderDetailDrawer",props:{visible:{type:Boolean},rowData:{}},emits:["update:visible","refresh"],setup(P,{emit:I}){const d=P,f=I,m=T({get:()=>d.visible,set:o=>f("update:visible",o)}),h=k("payment");function V(o){return o?ee(o).format("YYYY-MM-DD HH:mm:ss"):"-"}const n=T(()=>({PENDING:{label:e("order.list.statusMap.pending"),type:"warning"},PARTIAL:{label:e("order.list.statusMap.partial"),type:"warning"},PAID:{label:e("order.list.statusMap.paid"),type:"success"},REFUND_PART:{label:e("order.list.statusMap.refundPart"),type:"danger"},REFUNDED:{label:e("order.list.statusMap.refunded"),type:"info"},VOID:{label:e("order.list.statusMap.void"),type:"info"}})),M=T(()=>({NEW:e("order.list.typeMap.new"),RENEW:e("order.list.typeMap.renew"),UPSELL:e("order.list.typeMap.upsell"),SERVICE:e("order.list.typeMap.service"),IMPLEMENTATION:e("order.list.typeMap.implementation")}));return(o,x)=>{const i=ke,c=_e,w=Ee,p=Ce,_=Me,g=Ve;return D(),R(g,{modelValue:m.value,"onUpdate:modelValue":x[2]||(x[2]=N=>m.value=N),title:a(e)("order.detail.title"),size:"600px"},{default:l(()=>[o.rowData?(D(),O("div",ht,[u("div",gt,[u("h3",wt,r(a(e)("order.detail.baseInfo")),1),t(w,{column:2,border:"",size:"small"},{default:l(()=>[t(i,{label:a(e)("order.detail.orderNo")},{default:l(()=>[v(r(o.rowData.order_no),1)]),_:1},8,["label"]),t(i,{label:a(e)("order.detail.status")},{default:l(()=>[n.value[o.rowData.status]?(D(),R(c,{key:0,type:n.value[o.rowData.status].type,size:"small"},{default:l(()=>[v(r(n.value[o.rowData.status].label),1)]),_:1},8,["type"])):(D(),O("span",Dt,r(o.rowData.status),1))]),_:1},8,["label"]),t(i,{label:a(e)("order.detail.amount")},{default:l(()=>[v(r(o.rowData.amount),1)]),_:1},8,["label"]),t(i,{label:a(e)("order.detail.actualAmount")},{default:l(()=>[v(r(o.rowData.total_paid||0),1)]),_:1},8,["label"]),t(i,{label:a(e)("order.detail.type")},{default:l(()=>[v(r(M.value[o.rowData.order_type]||o.rowData.order_type),1)]),_:1},8,["label"]),t(i,{label:a(e)("order.detail.clientName")},{default:l(()=>[v(r(o.rowData.client_info?.name||"-"),1)]),_:1},8,["label"]),t(i,{label:a(e)("order.detail.createdAt")},{default:l(()=>[v(r(V(o.rowData.created_at)),1)]),_:1},8,["label"])]),_:1}),o.rowData.remark?(D(),O("div",xt,[u("span",Et,r(a(e)("order.detail.remark"))+":",1),v(" "+r(o.rowData.remark),1)])):B("",!0)]),t(_,{modelValue:h.value,"onUpdate:modelValue":x[1]||(x[1]=N=>h.value=N),class:"flex-1 flex flex-col min-h-0"},{default:l(()=>[t(p,{label:a(e)("order.detail.paymentTab"),name:"payment",class:"h-full overflow-hidden"},{default:l(()=>[t(ot,{"order-id":o.rowData.id,"amount-due":o.rowData.amount,"net-paid":o.rowData.total_paid||0,onRefresh:x[0]||(x[0]=N=>f("refresh"))},null,8,["order-id","amount-due","net-paid"])]),_:1},8,["label"]),t(p,{label:a(e)("order.detail.attachmentTab"),name:"attachment",class:"h-full overflow-hidden"},{default:l(()=>[t(bt,{"order-id":o.rowData.id},null,8,["order-id"])]),_:1},8,["label"])]),_:1},8,["modelValue"])])):B("",!0)]),_:1},8,["modelValue","title"])}}}),Mt=fe(kt,[["__scopeId","data-v-d3d7d3cd"]]),Ct={class:"h-full overflow-hidden flex flex-col p-4 gap-4"},Vt={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-4 shrink-0"},It={class:"text-gray-500 text-sm mb-2"},Nt={class:"text-2xl font-bold text-gray-900"},$t={class:"text-gray-500 text-sm mb-2"},Ot={class:"text-2xl font-bold text-orange-500"},At={class:"text-gray-500 text-sm mb-2"},Lt={class:"text-2xl font-bold text-gray-900"},Pt={class:"mb-4"},Rt=["onClick"],Tt={class:"mt-4 flex justify-end"},Ut=z({name:"order_list",__name:"index",setup(P){Ie();const I=k(!1),d=k([]),f=k(null),m=W({order_no:"",client_name:"",status:void 0,order_type:void 0}),h=W({current:1,size:20,total:0}),V=k("add"),n=k(!1),M=k(!1),o=k(null),x=T(()=>({PENDING:{label:e("order.list.statusMap.pending"),type:"warning"},PARTIAL:{label:e("order.list.statusMap.partial"),type:"warning"},PAID:{label:e("order.list.statusMap.paid"),type:"success"},REFUND_PART:{label:e("order.list.statusMap.refundPart"),type:"danger"},REFUNDED:{label:e("order.list.statusMap.refunded"),type:"info"},VOID:{label:e("order.list.statusMap.void"),type:"info"}}));T(()=>({NEW:e("order.list.typeMap.new"),RENEW:e("order.list.typeMap.renew"),UPSELL:e("order.list.typeMap.upsell"),SERVICE:e("order.list.typeMap.service"),IMPLEMENTATION:e("order.list.typeMap.implementation")}));async function i(){const{data:s,error:E}=await Te();!E&&s&&(f.value=s)}async function c(){I.value=!0;try{const{data:s}=await Ue({...m,current:h.current,size:h.size});s&&(Array.isArray(s)?d.value=s:s.items&&(d.value=s.items,h.total=s.total))}finally{I.value=!1}}function w(){h.current=1,c()}function p(){m.order_no="",m.client_name="",m.status=void 0,m.order_type=void 0,w()}function _(){V.value="add",o.value=null,n.value=!0}function g(s){V.value="edit",o.value=s,n.value=!0}function N(s){o.value=s,M.value=!0}async function A(){if(await c(),i(),o.value){const s=d.value.find(E=>E.id===o.value?.id);s&&(o.value=s)}}async function $(s){try{await te.confirm(e("order.list.voidConfirm"),e("common.tip"),{type:"warning"});const{error:E}=await Se(s.id);E||(L.success(e("order.list.voidSuccess")),c())}catch{}}function U(s){return s?ee(s).format("YYYY-MM-DD HH:mm"):"-"}function C(s){navigator.clipboard.writeText(s),L.success(e("order.list.copySuccess"))}return Q(()=>{c(),i()}),(s,E)=>{const b=pe,ae=Z,q=X,S=Y,ye=J,F=me,ve=_e,be=ce,he=Ne,ge=ue;return D(),O("div",Ct,[f.value?(D(),O("div",Vt,[t(b,{shadow:"hover",class:"!border-none bg-gradient-to-br from-blue-50 to-white"},{default:l(()=>[u("div",It,r(a(e)("order.list.monthlyRevenue")),1),u("div",Nt,r(f.value.monthly_revenue.toLocaleString()),1)]),_:1}),t(b,{shadow:"hover",class:"!border-none bg-gradient-to-br from-orange-50 to-white"},{default:l(()=>[u("div",$t,r(a(e)("order.list.pendingAmount")),1),u("div",Ot,r(f.value.pending_amount.toLocaleString()),1)]),_:1}),t(b,{shadow:"hover",class:"!border-none bg-gradient-to-br from-green-50 to-white"},{default:l(()=>[u("div",At,r(a(e)("order.list.monthlyCount")),1),u("div",Lt,r(f.value.monthly_count),1)]),_:1})])):B("",!0),t(b,{shadow:"never",class:"flex-none"},{default:l(()=>[t(ye,{inline:!0,model:m},{default:l(()=>[t(q,{label:a(e)("order.list.orderNo")},{default:l(()=>[t(ae,{modelValue:m.order_no,"onUpdate:modelValue":E[0]||(E[0]=y=>m.order_no=y),placeholder:a(e)("order.list.searchPlaceholder"),clearable:"",onKeyup:le(w,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(q,{label:a(e)("order.list.clientName")},{default:l(()=>[t(ae,{modelValue:m.client_name,"onUpdate:modelValue":E[1]||(E[1]=y=>m.client_name=y),clearable:"",onKeyup:le(w,["enter"])},null,8,["modelValue"])]),_:1},8,["label"]),t(q,null,{default:l(()=>[t(S,{type:"primary",onClick:w},{default:l(()=>[v(r(a(e)("common.search")),1)]),_:1}),t(S,{onClick:p},{default:l(()=>[v(r(a(e)("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(b,{shadow:"never",class:"flex-1 flex flex-col min-h-0"},{default:l(()=>[u("div",Pt,[t(S,{type:"primary",onClick:_},{default:l(()=>[v(r(a(e)("order.list.addOrder")),1)]),_:1})]),ie((D(),R(be,{data:d.value,border:"",style:{width:"100%",height:"100%"}},{default:l(()=>[t(F,{prop:"order_no",label:a(e)("order.list.orderNo"),width:"180"},{default:l(({row:y})=>[u("span",{class:"cursor-pointer hover:text-primary",onClick:K=>C(y.order_no)},r(y.order_no),9,Rt)]),_:1},8,["label"]),t(F,{prop:"client_name",label:a(e)("order.list.clientName"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),t(F,{prop:"amount",label:a(e)("order.list.amount"),width:"120"},{default:l(({row:y})=>[v(r(y.amount),1)]),_:1},8,["label"]),t(F,{prop:"status",label:a(e)("order.list.status"),width:"100"},{default:l(({row:y})=>[t(ve,{type:x.value[y.status]?.type},{default:l(()=>[v(r(x.value[y.status]?.label||y.status),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(F,{prop:"created_at",label:a(e)("order.list.createdAt"),width:"180"},{default:l(({row:y})=>[v(r(U(y.created_at)),1)]),_:1},8,["label"]),t(F,{label:a(e)("order.list.operate"),width:"250",fixed:"right"},{default:l(({row:y})=>[t(S,{link:"",type:"primary",onClick:K=>N(y)},{default:l(()=>[v(r(a(e)("common.check")),1)]),_:2},1032,["onClick"]),t(S,{link:"",type:"primary",onClick:K=>g(y),disabled:y.status==="VOID"},{default:l(()=>[v(r(a(e)("common.edit")),1)]),_:2},1032,["onClick","disabled"]),y.status!=="VOID"?(D(),R(S,{key:0,link:"",type:"danger",onClick:K=>$(y)},{default:l(()=>[v(r(a(e)("order.list.voidOrder")),1)]),_:2},1032,["onClick"])):B("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[ge,I.value]]),u("div",Tt,[t(he,{"current-page":h.current,"onUpdate:currentPage":E[2]||(E[2]=y=>h.current=y),"page-size":h.size,"onUpdate:pageSize":E[3]||(E[3]=y=>h.size=y),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:h.total,onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])]),_:1}),t(ze,{visible:n.value,"onUpdate:visible":E[4]||(E[4]=y=>n.value=y),"operate-type":V.value,"row-data":o.value,onSubmitted:c},null,8,["visible","operate-type","row-data"]),t(Mt,{visible:M.value,"onUpdate:visible":E[5]||(E[5]=y=>M.value=y),"row-data":o.value,onRefresh:A},null,8,["visible","row-data"])])}}}),Bt=fe(Ut,[["__scopeId","data-v-9e6de487"]]);export{Bt as default};
