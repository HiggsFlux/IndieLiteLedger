import{at as K,d as oe,a as ae,r as d,ag as se,ac as H,c as $,o as y,w as a,f as t,y as ne,p as re,q as Ee,ah as ie,b as B,W as te,X as le,ai as ue,az as ke,a6 as de,a4 as Ae,aA as Me,g as p,aB as Ye,aC as Se,h as De,aD as ze,e as l,E as ce,ar as Ie,ad as q,ae as Re,N as Pe,G as Ue,a3 as je,J as Ne,_ as Te,t as u,a9 as I,R as Le,a2 as Oe,O as Be,aj as Fe,ak as Ge,aE as $e,P as qe,al as He,aF as Ke}from"./index-CN2tD0BG.js";function We(x){return K({url:"/cost/list",method:"get",params:x})}function Je(x){return K({url:"/cost",method:"post",data:x})}function Xe(x){return K({url:`/cost/${x}`,method:"delete"})}function Qe(){return K({url:"/cost/stats",method:"get"})}const Ze={class:"dialog-footer"},et=oe({__name:"AddCostModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","success"],setup(x,{emit:R}){const M=x,Y=R,h=ae({get:()=>M.modelValue,set:m=>Y("update:modelValue",m)}),S=d(!1),v=d(),r=se({title:"",category:"OTHER",amount:0,pay_time:H().format("YYYY-MM-DD"),pay_account:"ALIPAY",invoice_url:"",remark:""}),w=[{label:"云资源",value:"CLOUD"},{label:"模型服务",value:"AI_API"},{label:"外包与人力",value:"LABOR"},{label:"软件订阅",value:"SAAS"},{label:"营销推广",value:"MARKETING"},{label:"其他",value:"OTHER"}],C={title:[{required:!0,message:"请输入摘要",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}],pay_time:[{required:!0,message:"请选择付款日期",trigger:"change"}],pay_account:[{required:!0,message:"请选择资金来源",trigger:"change"}]},V=ae(()=>"新增支出"),E=m=>{m.code===200?(r.invoice_url=m.data.url,q.success("凭证上传成功")):q.error(m.message||"上传失败")},k=()=>{v.value?.resetFields(),r.pay_time=H().format("YYYY-MM-DD"),r.invoice_url=""},D=async()=>{v.value&&await v.value.validate(async m=>{if(m)try{S.value=!0,await Je(r),q.success("新增成功"),h.value=!1,Y("success")}catch{}finally{S.value=!1}})};return(m,n)=>{const f=Ee,_=re,P=ue,W=ie,J=ke,X=de,U=Me,g=Ae,c=Se,b=Ye,Q=ne,F=ce,Z=Ie;return y(),$(Z,{modelValue:h.value,"onUpdate:modelValue":n[7]||(n[7]=i=>h.value=i),title:V.value,width:"600px","destroy-on-close":"",onClose:k},{footer:a(()=>[l("span",Ze,[t(F,{onClick:n[6]||(n[6]=i=>h.value=!1)},{default:a(()=>[...n[11]||(n[11]=[p("取消",-1)])]),_:1}),t(F,{type:"primary",loading:S.value,onClick:D},{default:a(()=>[...n[12]||(n[12]=[p(" 确认 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[t(Q,{ref_key:"formRef",ref:v,model:r,rules:C,"label-width":"100px"},{default:a(()=>[t(_,{label:"摘要",prop:"title"},{default:a(()=>[t(f,{modelValue:r.title,"onUpdate:modelValue":n[0]||(n[0]=i=>r.title=i),placeholder:"如: 阿里云12月ECS续费"},null,8,["modelValue"])]),_:1}),t(_,{label:"分类",prop:"category"},{default:a(()=>[t(W,{modelValue:r.category,"onUpdate:modelValue":n[1]||(n[1]=i=>r.category=i),placeholder:"请选择支出分类",class:"w-full"},{default:a(()=>[(y(),B(te,null,le(w,i=>t(P,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"金额",prop:"amount"},{default:a(()=>[t(J,{modelValue:r.amount,"onUpdate:modelValue":n[2]||(n[2]=i=>r.amount=i),min:.01,precision:2,step:100,class:"w-full","controls-position":"right"},null,8,["modelValue"])]),_:1}),t(_,{label:"付款日期",prop:"pay_time"},{default:a(()=>[t(X,{modelValue:r.pay_time,"onUpdate:modelValue":n[3]||(n[3]=i=>r.pay_time=i),type:"date",placeholder:"选择付款日期",class:"w-full","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(_,{label:"资金来源",prop:"pay_account"},{default:a(()=>[t(g,{modelValue:r.pay_account,"onUpdate:modelValue":n[4]||(n[4]=i=>r.pay_account=i)},{default:a(()=>[t(U,{label:"ALIPAY"},{default:a(()=>[...n[8]||(n[8]=[p("支付宝",-1)])]),_:1}),t(U,{label:"WECHAT"},{default:a(()=>[...n[9]||(n[9]=[p("微信",-1)])]),_:1}),t(U,{label:"BANK"},{default:a(()=>[...n[10]||(n[10]=[p("银行卡",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"凭证上传",prop:"invoice_url"},{default:a(()=>[t(b,{class:"upload-demo",action:"/api/v1/upload","on-success":E,"show-file-list":!0,limit:1,"list-type":"picture-card"},{default:a(()=>[t(c,null,{default:a(()=>[t(De(ze))]),_:1})]),_:1})]),_:1}),t(_,{label:"备注",prop:"remark"},{default:a(()=>[t(f,{modelValue:r.remark,"onUpdate:modelValue":n[5]||(n[5]=i=>r.remark=i),type:"textarea",rows:3,placeholder:"可选备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),tt=Re(et,[["__scopeId","data-v-6cd69aab"]]),lt={class:"h-full overflow-hidden flex flex-col p-4 gap-4"},at={class:"flex items-start justify-between mb-4 relative z-10"},ot={class:"w-16 h-16 rounded-xl bg-blue-50 flex items-center justify-center text-blue-500 shrink-0 shadow-sm shadow-blue-100"},st={class:"flex flex-col items-end min-w-0 flex-1 ml-4"},nt={class:"text-5xl font-bold text-gray-800 font-din whitespace-nowrap overflow-hidden text-ellipsis w-full text-right"},rt={class:"mt-auto flex flex-col gap-1.5 relative z-10"},it={class:"flex items-center justify-between text-base text-gray-500"},ut={class:"font-din font-bold text-gray-700 truncate ml-2"},dt={class:"flex items-center justify-between text-base"},ct={class:"flex items-center justify-between text-base"},pt={class:"flex items-start justify-between mb-4 relative z-10"},mt={class:"w-16 h-16 rounded-xl bg-indigo-50 flex items-center justify-center text-indigo-500 shrink-0 shadow-sm shadow-indigo-100"},ft={class:"flex flex-col items-end min-w-0 flex-1 ml-4"},gt={class:"text-5xl font-bold text-gray-800 font-din whitespace-nowrap overflow-hidden text-ellipsis w-full text-right"},vt={class:"mt-auto flex flex-col gap-1.5 relative z-10"},_t={class:"flex items-center justify-between text-base text-gray-500"},bt={class:"font-din font-bold text-gray-700 truncate ml-2"},yt={class:"flex items-center justify-between text-base"},xt={class:"flex items-center justify-between text-base"},ht={class:"flex items-center justify-between mb-3"},wt={class:"grid grid-cols-3 gap-4"},Ct={class:"flex flex-col overflow-hidden"},Vt={class:"text-gray-500 text-xs mb-0.5 truncate"},Et={class:"font-bold text-gray-800 truncate font-din text-lg"},kt={class:"absolute bottom-2 right-2 text-xs font-din text-gray-400 group-hover:text-gray-500 transition-colors"},At={class:"flex justify-between items-center mb-4"},Mt={class:"font-bold"},Yt={key:1,class:"text-gray-300"},St={class:"mt-4 flex justify-end"},zt=oe({name:"order_expense",__name:"index",setup(x){const R=d(!1),M=d([]),Y=d(!1),h=d(!1),S=d(""),v=d(0),r=d(0),w=d(0),C=d(0),V=d(0),E=d(0),k=d(0),D=d(0),m=d({}),n=d(null),f=d({category:void 0,pay_time_start:void 0,pay_time_end:void 0}),_=[{label:"云资源",value:"CLOUD"},{label:"模型服务",value:"AI_API"},{label:"外包与人力",value:"LABOR"},{label:"软件订阅",value:"SAAS"},{label:"营销推广",value:"MARKETING"},{label:"其他",value:"OTHER"}],P={CLOUD:{label:"云资源",type:"primary",icon:"mdi:cloud-outline",bgClass:"bg-blue-50 group-hover:bg-blue-100",textClass:"text-blue-500"},AI_API:{label:"模型服务",type:"warning",icon:"mdi:robot-outline",bgClass:"bg-orange-50 group-hover:bg-orange-100",textClass:"text-orange-500"},LABOR:{label:"外包与人力",type:"danger",icon:"mdi:account-group-outline",bgClass:"bg-red-50 group-hover:bg-red-100",textClass:"text-red-500"},SAAS:{label:"软件订阅",type:"success",icon:"mdi:apps-box",bgClass:"bg-green-50 group-hover:bg-green-100",textClass:"text-green-500"},MARKETING:{label:"营销推广",type:"",icon:"mdi:bullhorn-outline",bgClass:"bg-purple-50 group-hover:bg-purple-100",textClass:"text-purple-500"},OTHER:{label:"其他",type:"info",icon:"mdi:file-document-outline",bgClass:"bg-gray-50 group-hover:bg-gray-100",textClass:"text-gray-500"}},W={ALIPAY:"支付宝",WECHAT:"微信",BANK:"银行卡"},J=o=>P[o]?.label||o,X=o=>P[o]?.type||"info",U=o=>W[o]||o,g=o=>{if(o==null)return"0";const e=Number(o);return isNaN(e)?"0":e.toFixed(0)},c=se({currentPage:1,pageSize:20,total:0}),b=async()=>{R.value=!0;try{const o=await We({...f.value,skip:(c.currentPage-1)*c.pageSize,limit:c.pageSize});o.data&&(Array.isArray(o.data)?(M.value=o.data,c.total=o.data.length):o.data.items?(M.value=o.data.items,c.total=o.data.total||o.data.items.length):M.value=o.data),await pe()}finally{R.value=!1}},Q=o=>{c.pageSize=o,b()},F=o=>{c.currentPage=o,b()},Z=()=>{c.currentPage=1,b()},i=()=>{f.value={category:void 0,pay_time_start:void 0,pay_time_end:void 0},n.value=null,c.currentPage=1,b()},pe=async()=>{const o=await Qe();if(o.data){V.value=o.data.total_cost,m.value=o.data.cost_breakdown||{};const e=o.data.trend||[],j=H().format("YYYY-MM"),z=H().subtract(1,"month").format("YYYY-MM"),N=e.find(T=>T.month===j),G=e.find(T=>T.month===z);v.value=N?.cost||0,r.value=G?.cost||0,w.value=v.value-r.value,r.value>0?C.value=w.value/r.value*100:C.value=v.value>0?100:0,E.value=0,k.value=V.value-E.value,D.value=E.value>0?k.value/E.value*100:100}},me=o=>{o?(f.value.pay_time_start=o[0],f.value.pay_time_end=o[1]):(f.value.pay_time_start=void 0,f.value.pay_time_end=void 0)},fe=async o=>{try{await Xe(o.id),q.success("删除成功"),b()}catch{}},ge=o=>{S.value=o,h.value=!0};return Pe(()=>{b()}),(o,e)=>{const j=Te,z=Ne,N=je,G=Le,T=Oe,ve=ue,_e=ie,ee=re,be=de,L=ce,ye=ne,A=Ge,xe=$e,he=Fe,we=He,Ce=Ke,Ve=qe;return y(),B("div",lt,[t(T,{gutter:16,class:"!mx-0 flex-none"},{default:a(()=>[t(N,{span:6},{default:a(()=>[t(z,{shadow:"hover",class:"!border-none h-full relative overflow-hidden group","body-style":{padding:"24px 28px",position:"relative",zIndex:1,overflow:"hidden",height:"100%",display:"flex",flexDirection:"column"}},{default:a(()=>[e[11]||(e[11]=l("div",{class:"absolute -right-8 -top-8 w-56 h-56 bg-blue-100/40 rounded-full blur-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"},null,-1)),e[12]||(e[12]=l("div",{class:"absolute -right-4 bottom-8 w-32 h-32 bg-blue-50/60 rounded-full blur-2xl pointer-events-none"},null,-1)),l("div",at,[l("div",ot,[t(j,{icon:"mdi:calendar-month-outline",class:"text-4xl"})]),l("div",st,[e[7]||(e[7]=l("span",{class:"text-gray-500 text-lg mb-2 truncate text-right opacity-80 w-full"},"本月总支出",-1)),l("div",nt,"¥ "+u(g(v.value)),1)])]),l("div",rt,[l("div",it,[e[8]||(e[8]=l("span",{class:"shrink-0"},"上月同期",-1)),l("span",ut,"¥ "+u(g(r.value)),1)]),l("div",dt,[e[9]||(e[9]=l("span",{class:"text-gray-500 shrink-0"},"变动金额",-1)),l("span",{class:I(["font-din font-bold truncate ml-2",w.value>=0?"text-red-500":"text-green-500"])},u(w.value>=0?"+":"-")+"¥ "+u(g(Math.abs(w.value))),3)]),l("div",ct,[e[10]||(e[10]=l("span",{class:"text-gray-500 shrink-0"},"变动幅度",-1)),l("span",{class:I(["font-din font-bold truncate ml-2",C.value>=0?"text-red-500":"text-green-500"])},u(C.value>=0?"+":"")+u(C.value.toFixed(1))+"% ",3)])])]),_:1})]),_:1}),t(N,{span:6},{default:a(()=>[t(z,{shadow:"hover",class:"!border-none h-full relative overflow-hidden group","body-style":{padding:"24px 28px",position:"relative",zIndex:1,overflow:"hidden",height:"100%",display:"flex",flexDirection:"column"}},{default:a(()=>[e[17]||(e[17]=l("div",{class:"absolute -right-8 -top-8 w-56 h-56 bg-indigo-100/40 rounded-full blur-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"},null,-1)),e[18]||(e[18]=l("div",{class:"absolute -right-4 bottom-8 w-32 h-32 bg-indigo-50/60 rounded-full blur-2xl pointer-events-none"},null,-1)),l("div",pt,[l("div",mt,[t(j,{icon:"mdi:chart-timeline-variant",class:"text-4xl"})]),l("div",ft,[e[13]||(e[13]=l("span",{class:"text-gray-500 text-lg mb-2 truncate text-right opacity-80 w-full"},"年度累计支出",-1)),l("div",gt,"¥ "+u(g(V.value)),1)])]),l("div",vt,[l("div",_t,[e[14]||(e[14]=l("span",{class:"shrink-0"},"去年同期",-1)),l("span",bt,"¥ "+u(g(E.value)),1)]),l("div",yt,[e[15]||(e[15]=l("span",{class:"text-gray-500 shrink-0"},"变动金额",-1)),l("span",{class:I(["font-din font-bold truncate ml-2",k.value>=0?"text-red-500":"text-green-500"])},u(k.value>=0?"+":"-")+"¥ "+u(g(Math.abs(k.value))),3)]),l("div",xt,[e[16]||(e[16]=l("span",{class:"text-gray-500 shrink-0"},"变动幅度",-1)),l("span",{class:I(["font-din font-bold truncate ml-2",D.value>=0?"text-red-500":"text-green-500"])},u(D.value>=0?"+":"")+u(D.value.toFixed(1))+"% ",3)])])]),_:1})]),_:1}),t(N,{span:12},{default:a(()=>[t(z,{shadow:"hover",class:"!border-none h-full","body-style":{padding:"16px 20px"}},{default:a(()=>[l("div",ht,[e[20]||(e[20]=l("div",{class:"flex items-center gap-2"},[l("div",{class:"w-1 h-4 bg-primary rounded-full"}),l("span",{class:"font-bold text-gray-700"},"年度分类支出概览")],-1)),t(G,{size:"small",type:"info",effect:"plain"},{default:a(()=>[...e[19]||(e[19]=[p("Unit: CNY",-1)])]),_:1})]),l("div",wt,[(y(),B(te,null,le(P,(s,O)=>l("div",{key:O,class:"flex items-center gap-3 p-3 bg-gray-50/80 rounded-xl border border-gray-100 hover:shadow-sm transition-all duration-300 group relative"},[l("div",{class:I(["w-10 h-10 rounded-lg flex items-center justify-center shrink-0 transition-colors",s.bgClass])},[t(j,{icon:s.icon,class:I(["text-xl",s.textClass])},null,8,["icon","class"])],2),l("div",Ct,[l("span",Vt,u(s.label),1),l("div",Et,u(g(m.value[O]||0)),1)]),l("div",kt,u(V.value>0?((m.value[O]||0)/V.value*100).toFixed(1):"0.0")+"% ",1)])),64))])]),_:1})]),_:1})]),_:1}),t(z,{shadow:"never",class:"flex-1 flex flex-col min-h-0","body-style":{display:"flex",flexDirection:"column",height:"100%"}},{default:a(()=>[l("div",At,[t(ye,{inline:!0,model:f.value,class:"flex-1"},{default:a(()=>[t(ee,{label:"分类"},{default:a(()=>[t(_e,{modelValue:f.value.category,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value.category=s),placeholder:"全部分类",clearable:"",class:"w-32"},{default:a(()=>[(y(),B(te,null,le(_,s=>t(ve,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(ee,{label:"时间范围"},{default:a(()=>[t(be,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",onChange:me,class:"!w-64"},null,8,["modelValue"])]),_:1}),t(ee,null,{default:a(()=>[t(L,{type:"primary",onClick:Z},{default:a(()=>[...e[21]||(e[21]=[p("搜索",-1)])]),_:1}),t(L,{onClick:i},{default:a(()=>[...e[22]||(e[22]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),t(L,{type:"primary",onClick:e[2]||(e[2]=s=>Y.value=!0)},{default:a(()=>[...e[23]||(e[23]=[l("div",{class:"i-mdi-plus mr-1"},null,-1),p(" 新增支出 ",-1)])]),_:1})]),Be((y(),$(he,{data:M.value,style:{width:"100%",height:"100%"},class:"flex-1",stripe:""},{default:a(()=>[t(A,{prop:"pay_time",label:"支出时间",width:"120",sortable:""}),t(A,{prop:"title",label:"摘要","min-width":"200","show-overflow-tooltip":""}),t(A,{prop:"category",label:"分类",width:"120"},{default:a(({row:s})=>[t(G,{type:X(s.category)},{default:a(()=>[p(u(J(s.category)),1)]),_:2},1032,["type"])]),_:1}),t(A,{prop:"amount",label:"金额",width:"120",align:"right"},{default:a(({row:s})=>[l("span",Mt,"¥ "+u(g(s.amount)),1)]),_:1}),t(A,{prop:"pay_account",label:"支付账户",width:"100"},{default:a(({row:s})=>[p(u(U(s.pay_account)),1)]),_:1}),t(A,{label:"凭证",width:"80",align:"center"},{default:a(({row:s})=>[s.invoice_url?(y(),$(L,{key:0,link:"",type:"primary",onClick:O=>ge(s.invoice_url)},{default:a(()=>[...e[24]||(e[24]=[p(" 查看 ",-1)])]),_:2},1032,["onClick"])):(y(),B("span",Yt,"-"))]),_:1}),t(A,{label:"操作",width:"150",align:"right",fixed:"right"},{default:a(({row:s})=>[t(xe,{title:"确定删除吗?",onConfirm:O=>fe(s)},{reference:a(()=>[t(L,{link:"",type:"danger"},{default:a(()=>[...e[25]||(e[25]=[p("删除",-1)])]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[Ve,R.value]]),l("div",St,[t(we,{"current-page":c.currentPage,"onUpdate:currentPage":e[3]||(e[3]=s=>c.currentPage=s),"page-size":c.pageSize,"onUpdate:pageSize":e[4]||(e[4]=s=>c.pageSize=s),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:c.total,onSizeChange:Q,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1}),t(tt,{modelValue:Y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>Y.value=s),onSuccess:b},null,8,["modelValue"]),h.value?(y(),$(Ce,{key:0,"url-list":[S.value],onClose:e[6]||(e[6]=s=>h.value=!1)},null,8,["url-list"])):Ue("",!0)])}}});export{zt as default};
