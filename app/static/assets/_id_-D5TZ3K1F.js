import{d as ue,L as de,M as me,r as b,a as V,$ as e,N as _e,b as d,o as i,O as pe,f as a,P as fe,c as f,w as s,G as x,e as o,Q as ve,g as r,t as l,h as n,R as he,S as be,E as xe,_ as ye,U as we,V as ge,W as y,X as C,Y as ke,Z as Ee,J as Ve,a0 as Ce,a1 as Ue,y as De,a2 as Ie,a3 as Te,p as Fe,a4 as ze,a5 as Me,a6 as Ae,q as Pe,a7 as Ye,a8 as Re,a9 as $e,I as Be,aa as Se,ab as Le,ac as U,ad as Ne}from"./index-DLYPaTml.js";import{f as je,a as We,c as He}from"./client-7Sf9uVTU.js";import{_ as Ge}from"./ClientOperateDialog.vue_vue_type_script_setup_true_lang-fPVgsWOt.js";const Oe={class:"h-full flex gap-4 p-4 overflow-hidden"},qe={key:0},Je={class:"flex items-start justify-between mb-4"},Qe={class:"flex items-center gap-3 flex-1 min-w-0 mr-2"},Xe={class:"min-w-0 flex-1"},Ze=["title"],Ke={class:"flex flex-wrap gap-2 mt-2"},et={class:"flex items-center gap-1"},tt=["href"],lt={key:1},at={key:0,class:"flex items-center gap-1"},st={key:1},ot={key:0,class:"mb-4"},nt={class:"text-gray-500 text-xs mb-2"},it={class:"flex flex-wrap gap-2"},ct={class:"flex items-center gap-1 font-bold text-gray-600"},rt={class:"text-xs text-gray-600 space-y-1"},ut={class:"text-gray-400"},dt={class:"text-gray-400"},mt={class:"text-gray-400"},_t={class:"text-gray-400"},pt={class:"mt-6 pt-4 border-t border-gray-100 text-xs text-gray-400"},ft={key:1,class:"flex flex-col items-center justify-center h-full text-gray-400 py-10"},vt={class:"p-4 bg-gray-50 rounded mb-4 flex-none"},ht={class:"flex items-center gap-1"},bt={class:"flex justify-end"},xt={class:"flex-1 overflow-y-auto pr-2 pl-4"},yt={class:"flex justify-between items-center"},wt={class:"font-bold flex items-center gap-2"},gt={class:"whitespace-pre-wrap text-sm text-gray-700 leading-relaxed"},kt={key:0,class:"text-orange-500 text-sm mt-3 flex items-center gap-1 font-medium bg-orange-50 p-2 rounded inline-block"},Et=ue({name:"customer_detail",__name:"[id]",setup(Vt){const S=de(),L=me(),w=S.params.id,t=b(null),M=b([]),A=b("timeline"),k=b(!1),N=V(()=>[{label:`ðŸ’¬ ${e("customer.detail.followUpRecord")}`,name:"timeline"}]),P=b("edit"),D=b(!1),p=b({method:"Wechat",content:"",next_time:null}),Y=V(()=>[{label:e("customer.detail.wechatChat"),value:"Wechat",icon:"mdi:wechat"},{label:e("customer.detail.phoneCall"),value:"Phone",icon:"mdi:phone"},{label:e("customer.detail.offlineVisit"),value:"Visit",icon:"mdi:walk"},{label:e("customer.detail.email"),value:"Email",icon:"mdi:email"}]),j=V(()=>({Wechat:e("customer.detail.wechatChat"),Phone:e("customer.detail.phoneCall"),Visit:e("customer.detail.offlineVisit"),Email:e("customer.detail.email")})),I=V(()=>({0:{label:e("customer.list.statusLeads"),type:"info"},1:{label:e("customer.list.statusTrial"),type:"primary"},2:{label:e("customer.list.statusDone"),type:"success"},3:{label:e("customer.list.statusLost"),type:"warning"},9:{label:e("customer.list.statusBlacklist"),type:"danger"}}));function g(_){return _?Le(_).format("YYYY-MM-DD HH:mm"):"-"}async function T(){k.value=!0;try{const{data:_,error:m}=await je(w);if(m){U.error(m.message||"Failed to fetch client detail");return}_&&(t.value=_,L.setTabLabel(`${e("customer.detail.title")} - ${_.name}`))}catch(_){console.error(_),U.error("Failed to load client detail")}finally{k.value=!1}}async function R(){const{data:_}=await We(w);_&&(M.value=_)}async function W(){if(!p.value.content){U.warning(e("customer.detail.validation.content"));return}await He({client_id:w,method:p.value.method,content:p.value.content,next_time:p.value.next_time||void 0}),U.success(e("customer.detail.success.recordAdded")),p.value.content="",p.value.next_time=null,R(),T()}function H(){P.value="edit",D.value=!0}function G(){T()}return _e(()=>{w&&(T(),R())}),(_,m)=>{const O=ve,E=he,q=be,v=ye,$=xe,h=ge,J=we,Q=Ee,X=ke,F=Ve,Z=Me,K=ze,z=Fe,B=Te,ee=Ae,te=Ie,le=Pe,ae=De,se=Re,oe=Ye,ne=Ue,ie=Ce,ce=fe;return i(),d("div",Oe,[pe((i(),f(F,{shadow:"never",class:"w-1/3 min-w-[340px] flex-none overflow-y-auto"},{default:s(()=>[t.value?(i(),d("div",qe,[o("div",Je,[o("div",Qe,[a(O,{size:64,class:"bg-primary text-white text-2xl flex-shrink-0"},{default:s(()=>[r(l(t.value.type===1?n(e)("customer.detail.avatar.enterprise"):t.value.name.charAt(0)),1)]),_:1}),o("div",Xe,[o("h2",{class:"text-xl font-bold m-0 truncate",title:t.value.name},l(t.value.name),9,Ze),o("div",Ke,[t.value.type===0?(i(),f(E,{key:0,type:"info",size:"small"},{default:s(()=>[r(l(n(e)("customer.list.personal")),1)]),_:1})):(i(),f(E,{key:1,type:"primary",size:"small"},{default:s(()=>[r(l(n(e)("customer.list.enterprise")),1)]),_:1})),I.value[t.value.status]?(i(),f(E,{key:2,type:I.value[t.value.status].type,size:"small"},{default:s(()=>[r(l(I.value[t.value.status].label),1)]),_:1},8,["type"])):x("",!0),a(q,{modelValue:t.value.level,"onUpdate:modelValue":m[0]||(m[0]=u=>t.value.level=u),disabled:"","text-color":"#ff9900","score-template":"{value}",size:"small"},null,8,["modelValue"])])])]),a($,{plain:"",type:"primary",size:"small",class:"flex-shrink-0",onClick:H},{icon:s(()=>[a(v,{icon:"mdi:pencil"})]),default:s(()=>[r(" "+l(n(e)("common.edit")),1)]),_:1})]),a(J,{column:1,border:"",size:"small",class:"mb-4"},{default:s(()=>[a(h,{label:n(e)("customer.detail.descriptions.wechat")},{default:s(()=>[o("div",et,[o("span",null,l(t.value.wechat||"-"),1),t.value.wechat?(i(),f(v,{key:0,icon:"mdi:wechat",class:"text-green-500"})):x("",!0)])]),_:1},8,["label"]),a(h,{label:n(e)("customer.detail.descriptions.website")},{default:s(()=>[t.value.website?(i(),d("a",{key:0,href:t.value.website.startsWith("http")?t.value.website:`https://${t.value.website}`,target:"_blank",class:"text-blue-500 flex items-center gap-1 hover:underline"},[r(l(t.value.website)+" ",1),a(v,{icon:"mdi:link-variant"})],8,tt)):(i(),d("span",lt,"-"))]),_:1},8,["label"]),a(h,{label:n(e)("customer.detail.descriptions.telegram")},{default:s(()=>[t.value.telegram?(i(),d("div",at,[o("span",null,l(t.value.telegram),1),a(v,{icon:"logos:telegram",class:"text-sm"})])):(i(),d("span",st,"-"))]),_:1},8,["label"]),t.value.type===1?(i(),d(y,{key:0},[a(h,{label:n(e)("customer.detail.descriptions.contactPerson")},{default:s(()=>[r(l(t.value.contact_person),1)]),_:1},8,["label"]),a(h,{label:n(e)("customer.detail.descriptions.role")},{default:s(()=>[r(l(t.value.contact_role||"-"),1)]),_:1},8,["label"]),a(h,{label:n(e)("customer.detail.descriptions.phone")},{default:s(()=>[r(l(t.value.phone),1)]),_:1},8,["label"])],64)):(i(),d(y,{key:1},[a(h,{label:n(e)("customer.detail.descriptions.phone")},{default:s(()=>[r(l(t.value.phone||"-"),1)]),_:1},8,["label"]),a(h,{label:n(e)("customer.detail.descriptions.email")},{default:s(()=>[r(l(t.value.email||"-"),1)]),_:1},8,["label"])],64))]),_:1}),t.value.tech_tags&&t.value.tech_tags.length?(i(),d("div",ot,[o("div",nt,l(n(e)("customer.detail.descriptions.tags")),1),o("div",it,[(i(!0),d(y,null,C(t.value.tech_tags,u=>(i(),f(E,{key:u,size:"small"},{default:s(()=>[r(l(u),1)]),_:2},1024))),128))])])):x("",!0),t.value.type===1?(i(),f(X,{key:1,class:"mt-4"},{default:s(()=>[a(Q,{name:"1"},{title:s(()=>[o("div",ct,[a(v,{icon:"carbon:folder"}),o("span",null,l(n(e)("customer.detail.financialInfo")),1)])]),default:s(()=>[o("div",rt,[o("p",null,[o("span",ut,l(n(e)("customer.detail.taxCode"))+":",1),r(" "+l(t.value.tax_code||"-"),1)]),o("p",null,[o("span",dt,l(n(e)("customer.detail.bankName"))+":",1),r(" "+l(t.value.bank_name||"-"),1)]),o("p",null,[o("span",mt,l(n(e)("customer.detail.bankAccount"))+":",1),r(" "+l(t.value.bank_account||"-"),1)]),o("p",null,[o("span",_t,l(n(e)("customer.detail.regAddress"))+":",1),r(" "+l(t.value.reg_address||"-"),1)])])]),_:1})]),_:1})):x("",!0),o("div",pt,[o("p",null,l(n(e)("customer.detail.timeInfo.createdAt"))+": "+l(g(t.value.created_at)),1),o("p",null,l(n(e)("customer.detail.timeInfo.updatedAt"))+": "+l(g(t.value.updated_at)),1),o("p",null,l(n(e)("customer.detail.timeInfo.lastActive"))+": "+l(g(t.value.last_active||"")),1)])])):k.value?x("",!0):(i(),d("div",ft,[a(v,{icon:"mdi:alert-circle-outline",class:"text-4xl mb-2"}),o("p",null,l(n(e)("common.noData")),1)]))]),_:1})),[[ce,k.value]]),a(F,{shadow:"never",class:"flex-1 flex flex-col min-h-0"},{default:s(()=>[a(ie,{modelValue:A.value,"onUpdate:modelValue":m[4]||(m[4]=u=>A.value=u),class:"h-full flex flex-col"},{default:s(()=>[(i(!0),d(y,null,C(N.value,u=>(i(),f(ne,{key:u.name,label:u.label,name:u.name,class:"h-full overflow-hidden flex flex-col"},{default:s(()=>[u.name==="timeline"?(i(),d(y,{key:0},[o("div",vt,[a(ae,{"label-position":"top"},{default:s(()=>[a(te,{gutter:10},{default:s(()=>[a(B,{span:12},{default:s(()=>[a(z,{label:n(e)("customer.detail.followUpMethod")},{default:s(()=>[a(K,{modelValue:p.value.method,"onUpdate:modelValue":m[1]||(m[1]=c=>p.value.method=c),size:"small"},{default:s(()=>[(i(!0),d(y,null,C(Y.value,c=>(i(),f(Z,{key:c.value,value:c.value},{default:s(()=>[o("div",ht,[a(v,{icon:c.icon},null,8,["icon"]),r(" "+l(c.label),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),a(B,{span:12},{default:s(()=>[a(z,{label:n(e)("customer.detail.nextFollowUpTime")},{default:s(()=>[a(ee,{modelValue:p.value.next_time,"onUpdate:modelValue":m[2]||(m[2]=c=>p.value.next_time=c),type:"datetime",placeholder:n(e)("customer.detail.nextFollowUpPlaceholder"),"value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),a(z,null,{default:s(()=>[a(le,{modelValue:p.value.content,"onUpdate:modelValue":m[3]||(m[3]=c=>p.value.content=c),type:"textarea",rows:3,placeholder:n(e)("customer.detail.followUpContentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1}),o("div",bt,[a($,{type:"primary",onClick:W},{default:s(()=>[r(l(n(e)("customer.detail.publishRecord")),1)]),_:1})])]),_:1})]),o("div",xt,[a(oe,null,{default:s(()=>[(i(!0),d(y,null,C(M.value,c=>(i(),f(se,{key:c.id,timestamp:g(c.created_at),type:c.method==="Visit"?"primary":"info",placement:"top"},{default:s(()=>[a(F,{shadow:"hover",class:$e(["!border-l-4",c.method==="Visit"?"!border-l-primary":"!border-l-gray-200"])},{header:s(()=>[o("div",yt,[o("span",wt,[a(v,{icon:Y.value.find(re=>re.value===c.method)?.icon||"mdi:message"},null,8,["icon"]),r(" "+l(j.value[c.method]||c.method),1)])])]),default:s(()=>[o("p",gt,l(c.content),1),c.next_time?(i(),d("p",kt,[a(v,{icon:"carbon:notification"}),o("span",null,l(n(e)("customer.detail.nextFollowUp"))+": "+l(g(c.next_time)),1)])):x("",!0)]),_:2},1032,["class"])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])],64)):u.component&&t.value?(i(),f(Be(u.component),Se({key:1,"client-id":n(w),"client-name":t.value.name,"client-status":t.value.status},{ref_for:!0},u.props),null,16,["client-id","client-name","client-status"])):x("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(Ge,{visible:D.value,"onUpdate:visible":m[5]||(m[5]=u=>D.value=u),"operate-type":P.value,"row-data":t.value,onSubmitted:G},null,8,["visible","operate-type","row-data"])])}}}),It=Ne(Et,[["__scopeId","data-v-9c012820"]]);export{It as default};
