import{aq as Y,d as $,a as M,r as C,af as G,$ as e,am as Q,c as k,o as m,w as n,f as a,y as Z,p as ee,h as o,q as te,ax as ae,g as f,ag as q,b as A,W as P,X as U,ah as F,a6 as W,a4 as oe,a5 as le,t as l,E as z,ao as se,ac as J,N as ne,G as re,e as t,_ as ce,a9 as V,J as de,O as ie,ai as ue,aj as pe,R as _e,P as me,al as ge,ad as xe}from"./index-tAfeRux5.js";import{_ as be}from"./image-upload.vue_vue_type_script_setup_true_lang-BcmTQ18k.js";import"./order-Dh73Lvvn.js";function ye(y){return Y({url:"/cost/list",method:"get",params:y})}function ve(y){return Y({url:"/cost",method:"post",data:y})}function fe(y){return Y({url:`/cost/${y}`,method:"delete"})}function he(){return Y({url:"/cost/stats",method:"get"})}const we=$({name:"AddCostModal",__name:"AddCostModal",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(y,{emit:E}){const O=y,r=E,_=M({get(){return O.visible},set(g){r("update:visible",g)}}),b=C(),h=C(!1),d=G({title:"",amount:0,category:"CLOUD",pay_time:new Date().toISOString().split("T")[0],pay_account:"ALIPAY",invoice_url:"",remark:""}),N=M(()=>({title:[{required:!0,message:e("order.expense.validation.summary"),trigger:"blur"}],amount:[{required:!0,message:e("order.expense.validation.amount"),trigger:"blur"}],category:[{required:!0,message:e("order.expense.validation.category"),trigger:"change"}],pay_time:[{required:!0,message:e("order.expense.validation.payTime"),trigger:"change"}],pay_account:[{required:!0,message:e("order.expense.validation.payAccount"),trigger:"change"}]})),T=M(()=>[{label:e("order.expense.categoryMap.CLOUD"),value:"CLOUD"},{label:e("order.expense.categoryMap.AI_API"),value:"AI_API"},{label:e("order.expense.categoryMap.LABOR"),value:"LABOR"},{label:e("order.expense.categoryMap.SAAS"),value:"SAAS"},{label:e("order.expense.categoryMap.MARKETING"),value:"MARKETING"},{label:e("order.expense.categoryMap.OTHER"),value:"OTHER"}]),I=M(()=>[{label:e("order.expense.accountMap.ALIPAY"),value:"ALIPAY"},{label:e("order.expense.accountMap.WECHAT"),value:"WECHAT"},{label:e("order.expense.accountMap.BANK"),value:"BANK"}]);async function L(){await b.value?.validate(),h.value=!0;try{const{error:g}=await ve(d);g||(J.success(e("common.addSuccess")),r("success"),_.value=!1,w())}finally{h.value=!1}}function w(){b.value?.resetFields(),d.title="",d.amount=0,d.category="CLOUD",d.pay_time=new Date().toISOString().split("T")[0],d.pay_account="ALIPAY",d.invoice_url="",d.remark=""}return Q(_,g=>{g||w()}),(g,i)=>{const R=te,p=ee,u=ae,v=F,S=q,j=W,H=le,B=oe,D=Z,x=z,K=se;return m(),k(K,{modelValue:_.value,"onUpdate:modelValue":i[8]||(i[8]=c=>_.value=c),title:o(e)("order.expense.addTitle"),width:"600px","destroy-on-close":""},{footer:n(()=>[a(x,{onClick:i[7]||(i[7]=c=>_.value=!1)},{default:n(()=>[f(l(o(e)("common.cancel")),1)]),_:1}),a(x,{type:"primary",loading:h.value,onClick:L},{default:n(()=>[f(l(o(e)("common.confirm")),1)]),_:1},8,["loading"])]),default:n(()=>[a(D,{ref_key:"formRef",ref:b,model:d,rules:N.value,"label-width":"100px"},{default:n(()=>[a(p,{label:o(e)("order.expense.summary"),prop:"title"},{default:n(()=>[a(R,{modelValue:d.title,"onUpdate:modelValue":i[0]||(i[0]=c=>d.title=c),placeholder:o(e)("order.expense.summaryPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:o(e)("order.expense.amount"),prop:"amount"},{default:n(()=>[a(u,{modelValue:d.amount,"onUpdate:modelValue":i[1]||(i[1]=c=>d.amount=c),min:0,precision:2,class:"!w-full"},{prefix:n(()=>[...i[9]||(i[9]=[f("¥",-1)])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(p,{label:o(e)("order.expense.category"),prop:"category"},{default:n(()=>[a(S,{modelValue:d.category,"onUpdate:modelValue":i[2]||(i[2]=c=>d.category=c),placeholder:o(e)("order.expense.categoryPlaceholder"),class:"w-full"},{default:n(()=>[(m(!0),A(P,null,U(T.value,c=>(m(),k(v,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:o(e)("order.expense.expenseTime"),prop:"pay_time"},{default:n(()=>[a(j,{modelValue:d.pay_time,"onUpdate:modelValue":i[3]||(i[3]=c=>d.pay_time=c),type:"date",placeholder:o(e)("order.expense.payTimePlaceholder"),"value-format":"YYYY-MM-DD",class:"!w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(p,{label:o(e)("order.expense.payAccount"),prop:"pay_account"},{default:n(()=>[a(B,{modelValue:d.pay_account,"onUpdate:modelValue":i[4]||(i[4]=c=>d.pay_account=c)},{default:n(()=>[(m(!0),A(P,null,U(I.value,c=>(m(),k(H,{key:c.value,value:c.value},{default:n(()=>[f(l(c.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(p,{label:o(e)("order.expense.voucher"),prop:"invoice_url"},{default:n(()=>[a(be,{modelValue:d.invoice_url,"onUpdate:modelValue":i[5]||(i[5]=c=>d.invoice_url=c)},null,8,["modelValue"])]),_:1},8,["label"]),a(p,{label:o(e)("common.remark"),prop:"remark"},{default:n(()=>[a(R,{modelValue:d.remark,"onUpdate:modelValue":i[6]||(i[6]=c=>d.remark=c),type:"textarea",rows:3,placeholder:o(e)("order.expense.remarkPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ae={class:"h-full flex flex-col gap-4 p-4 overflow-hidden"},Me={key:0,class:"grid grid-cols-1 lg:grid-cols-4 gap-4 shrink-0"},Se={class:"flex flex-col h-full p-5"},Ve={class:"flex justify-between items-start mb-4"},Ce={class:"p-4 bg-blue-50 rounded-xl text-blue-500 flex items-center justify-center"},Ee={class:"text-right"},Ie={class:"text-gray-500 text-base font-medium mb-1"},Le={class:"text-3xl font-bold text-gray-900"},ke={class:"mt-auto space-y-1 text-base"},Oe={class:"flex justify-between items-center"},Te={class:"text-gray-500"},Re={class:"font-medium text-gray-700"},Be={class:"flex justify-between items-center"},De={class:"text-gray-500"},Pe={class:"flex justify-between items-center"},Ue={class:"text-gray-500"},Ye={class:"flex flex-col h-full p-5"},Ne={class:"flex justify-between items-start mb-4"},je={class:"p-4 bg-indigo-50 rounded-xl text-indigo-500 flex items-center justify-center"},He={class:"text-right"},Ke={class:"text-gray-500 text-base font-medium mb-1"},Ge={class:"text-3xl font-bold text-gray-900"},$e={class:"mt-auto space-y-1 text-base"},qe={class:"flex justify-between items-center"},Fe={class:"text-gray-500"},We={class:"font-medium text-gray-700"},ze={class:"flex justify-between items-center"},Je={class:"text-gray-500"},Xe={class:"flex justify-between items-center"},Qe={class:"text-gray-500"},Ze={class:"flex flex-col h-full p-4"},et={class:"flex items-center justify-between mb-4"},tt={class:"flex items-center gap-2 font-bold text-gray-800"},at={class:"grid grid-cols-2 sm:grid-cols-3 gap-2"},ot={class:"flex flex-col flex-1 min-w-0"},lt={class:"text-xs text-gray-500 mb-1 truncate"},st={class:"flex items-baseline justify-between gap-2"},nt={class:"font-bold text-gray-900 text-lg truncate"},rt={class:"text-xs text-gray-400 shrink-0"},ct={class:"flex justify-between items-center"},dt={class:"flex gap-4"},it={class:"font-mono font-bold text-red-500"},ut=$({name:"order_expense",__name:"index",setup(y){const E=C(!1),O=C([]),r=C(null),_=G({category:void 0,pay_time_start:void 0,pay_time_end:void 0}),b=G({current:1,pageSize:20,total:0}),h=C(!1),d=M(()=>[{label:e("order.expense.allCategory"),value:void 0},{label:e("order.expense.categoryMap.CLOUD"),value:"CLOUD"},{label:e("order.expense.categoryMap.AI_API"),value:"AI_API"},{label:e("order.expense.categoryMap.LABOR"),value:"LABOR"},{label:e("order.expense.categoryMap.SAAS"),value:"SAAS"},{label:e("order.expense.categoryMap.MARKETING"),value:"MARKETING"},{label:e("order.expense.categoryMap.OTHER"),value:"OTHER"}]),N=M(()=>({ALIPAY:e("order.expense.accountMap.ALIPAY"),WECHAT:e("order.expense.accountMap.WECHAT"),BANK:e("order.expense.accountMap.BANK")})),T=M(()=>({CLOUD:e("order.expense.categoryMap.CLOUD"),AI_API:e("order.expense.categoryMap.AI_API"),LABOR:e("order.expense.categoryMap.LABOR"),SAAS:e("order.expense.categoryMap.SAAS"),MARKETING:e("order.expense.categoryMap.MARKETING"),OTHER:e("order.expense.categoryMap.OTHER")}));function I(p){return{CLOUD:{bg:"bg-blue-50",text:"text-blue-600",icon:"carbon:cloud-service-management",iconBg:"bg-blue-100"},AI_API:{bg:"bg-orange-50",text:"text-orange-600",icon:"carbon:bot",iconBg:"bg-orange-100"},LABOR:{bg:"bg-red-50",text:"text-red-600",icon:"carbon:user-multiple",iconBg:"bg-red-100"},SAAS:{bg:"bg-green-50",text:"text-green-600",icon:"carbon:application",iconBg:"bg-green-100"},MARKETING:{bg:"bg-purple-50",text:"text-purple-600",icon:"carbon:bullhorn",iconBg:"bg-purple-100"},OTHER:{bg:"bg-gray-50",text:"text-gray-600",icon:"carbon:document",iconBg:"bg-gray-100"}}[p]||{bg:"bg-gray-50",text:"text-gray-600",icon:"carbon:unknown",iconBg:"bg-gray-100"}}async function L(){const{data:p,error:u}=await he();!u&&p&&(r.value=p)}async function w(){E.value=!0;try{const p={..._,skip:(b.current-1)*b.pageSize,limit:b.pageSize},{data:u,error:v}=await ye(p);!v&&u&&(O.value=u,b.total=u.length)}finally{E.value=!1}}function g(){b.current=1,w()}async function i(p){try{await ge.confirm(e("order.expense.deleteConfirm"),e("common.warning"),{type:"warning"});const{error:u}=await fe(p.id);u||(J.success(e("common.deleteSuccess")),w(),L())}catch{}}function R(){w(),L()}return ne(()=>{w(),L()}),(p,u)=>{const v=ce,S=de,j=F,H=q,B=W,D=z,x=pe,K=_e,c=ue,X=me;return m(),A("div",Ae,[r.value?(m(),A("div",Me,[a(S,{shadow:"never",class:"!border-none bg-white rounded-xl"},{default:n(()=>[t("div",Se,[t("div",Ve,[t("div",Ce,[a(v,{icon:"material-symbols:calendar-month-outline",class:"text-4xl"})]),t("div",Ee,[t("div",Ie,l(o(e)("order.expense.monthlyCost")),1),t("div",Le,l(r.value.month_cost.toLocaleString()),1)])]),t("div",ke,[t("div",Oe,[t("span",Te,l(o(e)("order.expense.lastMonthPeriod")),1),t("span",Re,l(r.value.month_cost_last.toLocaleString()),1)]),t("div",Be,[t("span",De,l(o(e)("order.expense.growthAmount")),1),t("span",{class:V(["font-bold",r.value.month_cost-r.value.month_cost_last>0?"text-red-500":"text-green-500"])},l(r.value.month_cost-r.value.month_cost_last>0?"+":"")+l(Math.abs(r.value.month_cost-r.value.month_cost_last).toLocaleString()),3)]),t("div",Pe,[t("span",Ue,l(o(e)("order.expense.growthRate")),1),t("span",{class:V(["font-bold",r.value.month_growth>0?"text-red-500":"text-green-500"])},l(r.value.month_growth>0?"+":"")+l(r.value.month_growth)+"% ",3)])])])]),_:1}),a(S,{shadow:"never",class:"!border-none bg-white rounded-xl"},{default:n(()=>[t("div",Ye,[t("div",Ne,[t("div",je,[a(v,{icon:"material-symbols:trending-up",class:"text-4xl"})]),t("div",He,[t("div",Ke,l(o(e)("order.expense.yearlyCost")),1),t("div",Ge,l(r.value.year_cost.toLocaleString()),1)])]),t("div",$e,[t("div",qe,[t("span",Fe,l(o(e)("order.expense.lastYearPeriod")),1),t("span",We,l(r.value.year_cost_last.toLocaleString()),1)]),t("div",ze,[t("span",Je,l(o(e)("order.expense.growthAmount")),1),t("span",{class:V(["font-bold",r.value.year_cost-r.value.year_cost_last>0?"text-red-500":"text-green-500"])},l(r.value.year_cost-r.value.year_cost_last>0?"+":"")+l(Math.abs(r.value.year_cost-r.value.year_cost_last).toLocaleString()),3)]),t("div",Xe,[t("span",Qe,l(o(e)("order.expense.growthRate")),1),t("span",{class:V(["font-bold",r.value.year_growth>0?"text-red-500":"text-green-500"])},l(r.value.year_growth>0?"+":"")+l(r.value.year_growth)+"% ",3)])])])]),_:1}),a(S,{shadow:"never",class:"!border-none bg-white lg:col-span-2 rounded-xl"},{default:n(()=>[t("div",Ze,[t("div",et,[t("div",tt,l(o(e)("order.expense.categoryOverview")),1)]),t("div",at,[(m(!0),A(P,null,U(r.value.category_breakdown,s=>(m(),A("div",{key:s.name,class:V(["p-3 rounded-xl flex items-center gap-3 transition-all hover:shadow-sm border border-transparent hover:border-gray-100",I(s.name).bg])},[t("div",{class:V(["w-10 h-10 rounded-lg flex items-center justify-center shrink-0 bg-white shadow-sm",I(s.name).text])},[a(v,{icon:I(s.name).icon,class:"text-xl"},null,8,["icon"])],2),t("div",ot,[t("span",lt,l(T.value[s.name]||s.name),1),t("div",st,[t("span",nt,l(s.amount.toLocaleString()),1),t("span",rt,l(s.percent)+"%",1)])])],2))),128))])])]),_:1})])):re("",!0),a(S,{shadow:"never",class:"flex-1 flex flex-col !border-none"},{header:n(()=>[t("div",ct,[t("div",dt,[a(H,{modelValue:_.category,"onUpdate:modelValue":u[0]||(u[0]=s=>_.category=s),placeholder:o(e)("order.expense.category"),clearable:"",onChange:g,class:"w-40"},{default:n(()=>[(m(!0),A(P,null,U(d.value,s=>(m(),k(j,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),a(B,{modelValue:_.pay_time_start,"onUpdate:modelValue":u[1]||(u[1]=s=>_.pay_time_start=s),type:"date",placeholder:o(e)("common.startTime"),"value-format":"YYYY-MM-DD",onChange:g,class:"w-40"},null,8,["modelValue","placeholder"]),a(B,{modelValue:_.pay_time_end,"onUpdate:modelValue":u[2]||(u[2]=s=>_.pay_time_end=s),type:"date",placeholder:o(e)("common.endTime"),"value-format":"YYYY-MM-DD",onChange:g,class:"w-40"},null,8,["modelValue","placeholder"])]),a(D,{type:"primary",onClick:u[3]||(u[3]=s=>h.value=!0)},{icon:n(()=>[a(v,{icon:"material-symbols:add"})]),default:n(()=>[f(" "+l(o(e)("order.expense.addExpense")),1)]),_:1})])]),default:n(()=>[ie((m(),k(c,{data:O.value,height:"100%",stripe:""},{default:n(()=>[a(x,{prop:"pay_time",label:o(e)("order.expense.expenseTime"),width:"120",sortable:""},null,8,["label"]),a(x,{prop:"title",label:o(e)("order.expense.summary"),"min-width":"200","show-overflow-tooltip":""},null,8,["label"]),a(x,{prop:"category",label:o(e)("order.expense.category"),width:"120"},{default:n(({row:s})=>[a(K,null,{default:n(()=>[f(l(T.value[s.category]||s.category),1)]),_:2},1024)]),_:1},8,["label"]),a(x,{prop:"amount",label:o(e)("order.expense.amount"),width:"120",align:"right"},{default:n(({row:s})=>[t("span",it,"-¥"+l(Number(s.amount).toLocaleString()),1)]),_:1},8,["label"]),a(x,{prop:"pay_account",label:o(e)("order.expense.payAccount"),width:"120"},{default:n(({row:s})=>[f(l(N.value[s.pay_account]||s.pay_account),1)]),_:1},8,["label"]),a(x,{prop:"remark",label:o(e)("common.remark"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),a(x,{label:o(e)("common.action"),width:"100",fixed:"right"},{default:n(({row:s})=>[a(D,{type:"danger",link:"",onClick:pt=>i(s)},{default:n(()=>[f(l(o(e)("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[X,E.value]])]),_:1}),a(we,{visible:h.value,"onUpdate:visible":u[4]||(u[4]=s=>h.value=s),onSuccess:R},null,8,["visible"])])}}}),xt=xe(ut,[["__scopeId","data-v-22644162"]]);export{xt as default};
