import{d as M,a7 as A,r as g,N as T,b,o as i,e as f,f as s,c as m,w as a,g as d,_ as D,E as I,bc as S,Q as Y,ai as j,aj as R,R as V,t as _,ak as z,P as F,a9 as G}from"./index-xTveqTne.js";import{f as H}from"./license-record-BAeqi8K7.js";import{f as q}from"./license-config-tLAC3KGb.js";const P={class:"h-full flex flex-col"},Q={class:"mb-4"},$={class:"grid grid-cols-2 gap-2 px-2 py-1"},U=M({__name:"LicenseTab",props:{clientId:{},clientName:{},clientStatus:{}},setup(w){const u=w,v=A(),c=g([]),p=g({});function x(e){return e?G(e).format("YYYY-MM-DD HH:mm"):"-"}async function k(){try{const{data:e}=await q({is_active:void 0});if(e){const r=Array.isArray(e)?e:e.items||[],n={};r.forEach(o=>{o.module_name_cn&&(n[o.module_code]=o.module_name_cn,n[o.module_name]=o.module_name_cn)}),p.value=n}}catch(e){console.error("Failed to fetch module configs",e)}}function C(e){return p.value[e]||e}async function E(){const{data:e}=await H({keyword:u.clientName});e&&(e.items?c.value=e.items:Array.isArray(e)?c.value=e:c.value=[])}function L(){v.push({name:"commercial_generate",query:{client_id:u.clientId}})}return T(()=>{u.clientName&&(k(),E())}),(e,r)=>{const n=D,o=I,N=S,l=Y,h=V,B=F;return i(),b("div",P,[f("div",Q,[e.clientStatus!==9?(i(),m(o,{key:0,type:"primary",onClick:L},{icon:a(()=>[s(n,{icon:"carbon:flash"})]),default:a(()=>[r[0]||(r[0]=d(" 签发新授权 ",-1))]),_:1})):(i(),m(N,{key:1,title:"黑名单用户不允许签发新授权",type:"error",closable:!1,"show-icon":"",class:"!w-fit"}))]),s(B,{data:c.value,border:"",style:{width:"100%",flex:"1"},height:"100%"},{default:a(()=>[s(l,{prop:"license_key",label:"授权码","min-width":"220","show-overflow-tooltip":""}),s(l,{label:"模块",width:"260","show-overflow-tooltip":""},{default:a(({row:t})=>[f("div",$,[(i(!0),b(j,null,R(t.summary_modules.split(", ").filter(Boolean),y=>(i(),m(h,{key:y,size:"small",type:"info",effect:"plain",class:"w-full justify-center"},{default:a(()=>[d(_(C(y)),1)]),_:2},1024))),128))])]),_:1}),s(l,{prop:"created_at",label:"签发时间",width:"180"},{default:a(({row:t})=>[d(_(x(t.created_at)),1)]),_:1}),s(l,{prop:"expire_at_min",label:"过期时间",width:"120"},{default:a(({row:t})=>[f("span",{class:z(t.is_expired?"text-red-500":"text-green-600")},_(t.expire_at_min||"永久"),3)]),_:1}),s(l,{label:"状态",width:"100"},{default:a(({row:t})=>[s(h,{type:t.is_expired?"danger":"success"},{default:a(()=>[d(_(t.is_expired?"已过期":"正常"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])}}});export{U as default};
