import{L as $,b as E,o as g,e as d,d as Z,r as _,M as ee,N as le,f as l,w as a,q as te,x as oe,E as ae,g as s,O as ne,c as de,P as se,Q as ie,t as x,R as ue,S as re,U as me,J as _e,y as ce,p as pe,G as fe,V as ve,W as ge,X as ye,Y as be,Z as Ve,a0 as xe,a1 as he,a2 as h,a3 as Ee,a4 as we}from"./index-Cl2Qds7-.js";import{f as Ce,a as ke,b as B,c as Se}from"./license-config-B1dkp8ko.js";const Te={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Le(T,i){return g(),E("svg",Te,[...i[0]||(i[0]=[d("path",{fill:"currentColor",d:"M18 12.998h-5v5a1 1 0 0 1-2 0v-5H6a1 1 0 0 1 0-2h5v-5a1 1 0 0 1 2 0v5h5a1 1 0 0 1 0 2"},null,-1)])])}const Ue=$({name:"ic-round-plus",render:Le}),Me={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"};function Ne(T,i){return g(),E("svg",Me,[...i[0]||(i[0]=[d("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0s.41-1.08 0-1.49zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"},null,-1)])])}const Ie=$({name:"ic-round-search",render:Ne}),Re={class:"h-full overflow-hidden p-4"},Be={class:"flex justify-between items-center mb-4"},De={class:"flex gap-2"},$e={class:"flex gap-2"},Pe={class:"flex-1 overflow-hidden"},Ae={class:"font-mono text-gray-600"},Ge={key:0,class:"text-xs text-gray-400 mt-1"},Ye={class:"ml-2"},qe={class:"dialog-footer"},P=Z({name:"commercial_config",__name:"index",setup(T){const i=_(!1),L=_([]),y=_(""),f=_(!1),c=_("add"),w=_(null),C=_(!1),o=ee({module_code:"",module_name:"",module_name_cn:"",module_type:"PLUGIN",default_strategy:"TRIAL",sort_order:0,is_active:!0,description:""}),A={module_code:[{required:!0,message:"请输入模块标识",trigger:"blur"},{pattern:/^[a-z0-9_]+$/,message:"仅支持小写字母、数字和下划线",trigger:"blur"}],module_name:[{required:!0,message:"请输入模块名称",trigger:"blur"}],module_type:[{required:!0,message:"请选择模块类型",trigger:"change"}],sort_order:[{required:!0,message:"请输入排序权重",trigger:"blur"}]},k=_("");async function b(){i.value=!0;try{const n=await Ce();if(n.data){let e=n.data;if(y.value){const v=y.value.toLowerCase();e=e.filter(u=>u.module_name.toLowerCase().includes(v)||u.module_code.toLowerCase().includes(v))}L.value=e}}catch(n){console.error(n)}finally{i.value=!1}}function S(){b()}function U(n,e){c.value=n,f.value=!0,n==="add"?(k.value="",o.module_code="",o.module_name="",o.module_name_cn="",o.module_type="PLUGIN",o.default_strategy="TRIAL",o.sort_order=0,o.is_active=!0,o.description=""):e&&(k.value=e.id,o.module_code=e.module_code,o.module_name=e.module_name,o.module_type=e.module_type,o.default_strategy=e.default_strategy,o.sort_order=e.sort_order,o.is_active=e.is_active,o.description=e.description||"")}async function G(){w.value&&await w.value.validate(async n=>{if(n){C.value=!0;try{c.value==="add"?(await ke(o),h.success("新增成功")):(await B(k.value,o),h.success("更新成功")),f.value=!1,b()}catch(e){console.error(e)}finally{C.value=!1}}})}async function Y(n){try{await Ee.confirm(`确定要删除模块 "${n.module_name}" 吗？此操作不可恢复。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await Se(n.id),h.success("删除成功"),b()}catch{}}async function q(n){const e=!n.is_active;try{await B(n.id,{is_active:n.is_active}),h.success("状态更新成功")}catch{n.is_active=e}}function z(n){U("edit",n)}return le(()=>{b()}),(n,e)=>{const v=Ie,u=te,p=ae,K=Ue,r=ie,M=ue,N=re,F=se,O=_e,m=pe,I=ye,j=ge,R=Ve,H=be,J=xe,Q=ce,W=he,X=me;return g(),E("div",Re,[l(O,{shadow:"never",class:"h-full flex flex-col border-none","body-style":{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"}},{default:a(()=>[d("div",Be,[d("div",De,[l(u,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"搜索模块名称、标识或中文名称",clearable:"",onKeyup:oe(S,["enter"]),onClear:S,style:{width:"240px"}},{prefix:a(()=>[l(v)]),_:1},8,["modelValue"]),l(p,{onClick:S},{default:a(()=>[...e[12]||(e[12]=[s("搜索",-1)])]),_:1})]),d("div",$e,[l(p,{type:"primary",onClick:e[1]||(e[1]=t=>U("add"))},{default:a(()=>[l(K,{class:"mr-1"}),e[13]||(e[13]=s(" 新增配置 ",-1))]),_:1})])]),d("div",Pe,[ne((g(),de(F,{data:L.value,height:"100%",border:"",stripe:""},{default:a(()=>[l(r,{prop:"sort_order",label:"排序",width:"80",align:"center",sortable:""}),l(r,{prop:"module_code",label:"模块标识","min-width":"150","show-overflow-tooltip":""},{default:a(({row:t})=>[d("span",Ae,x(t.module_code),1)]),_:1}),l(r,{prop:"module_name",label:"模块名称","min-width":"150","show-overflow-tooltip":""}),l(r,{prop:"module_name_cn",label:"模块中文名称","min-width":"150","show-overflow-tooltip":""}),l(r,{prop:"module_type",label:"类型",width:"100",align:"center"},{default:a(({row:t})=>[l(M,{type:t.module_type==="SYSTEM"?"danger":"primary",effect:"plain"},{default:a(()=>[s(x(t.module_type),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"default_strategy",label:"默认策略",width:"120",align:"center"},{default:a(({row:t})=>[l(M,{type:t.default_strategy==="PERMANENT"?"success":"warning",effect:"light"},{default:a(()=>[s(x(t.default_strategy==="PERMANENT"?"永久":"限期"),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"is_active",label:"状态",width:"100",align:"center"},{default:a(({row:t})=>[l(N,{modelValue:t.is_active,"onUpdate:modelValue":V=>t.is_active=V,disabled:t.module_type==="SYSTEM"&&t.module_code==="sys_core",onChange:V=>q(t)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])]),_:1}),l(r,{label:"操作",width:"150",align:"center",fixed:"right"},{default:a(({row:t})=>[l(p,{type:"primary",link:"",size:"small",onClick:V=>z(t)},{default:a(()=>[...e[14]||(e[14]=[s("编辑",-1)])]),_:2},1032,["onClick"]),l(p,{type:"danger",link:"",size:"small",onClick:V=>Y(t),disabled:t.module_type==="SYSTEM"&&t.module_code==="sys_core"},{default:a(()=>[...e[15]||(e[15]=[s(" 删除 ",-1)])]),_:2},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[X,i.value]])])]),_:1}),l(W,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=t=>f.value=t),title:c.value==="add"?"新增授权模块":"编辑授权模块",width:"500px","destroy-on-close":""},{footer:a(()=>[d("div",qe,[l(p,{onClick:e[10]||(e[10]=t=>f.value=!1)},{default:a(()=>[...e[20]||(e[20]=[s("取消",-1)])]),_:1}),l(p,{type:"primary",loading:C.value,onClick:G},{default:a(()=>[...e[21]||(e[21]=[s(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l(Q,{ref_key:"formRef",ref:w,model:o,rules:A,"label-width":"100px"},{default:a(()=>[l(m,{label:"模块标识",prop:"module_code"},{default:a(()=>[l(u,{modelValue:o.module_code,"onUpdate:modelValue":e[2]||(e[2]=t=>o.module_code=t),placeholder:"例如: plugin_workflow",disabled:c.value==="edit"},ve({_:2},[c.value==="add"?{name:"prefix",fn:a(()=>[e[16]||(e[16]=d("span",{class:"text-gray-400"},"#",-1))]),key:"0"}:void 0]),1032,["modelValue","disabled"]),c.value==="add"?(g(),E("div",Ge," 唯一标识，创建后不可修改。 ")):fe("",!0)]),_:1}),l(m,{label:"模块名称",prop:"module_name"},{default:a(()=>[l(u,{modelValue:o.module_name,"onUpdate:modelValue":e[3]||(e[3]=t=>o.module_name=t),placeholder:"例如: TalkMyData Core"},null,8,["modelValue"])]),_:1}),l(m,{label:"模块中文名称",prop:"module_name_cn"},{default:a(()=>[l(u,{modelValue:o.module_name_cn,"onUpdate:modelValue":e[4]||(e[4]=t=>o.module_name_cn=t),placeholder:"例如: 系统核心"},null,8,["modelValue"])]),_:1}),l(m,{label:"模块类型",prop:"module_type"},{default:a(()=>[l(j,{modelValue:o.module_type,"onUpdate:modelValue":e[5]||(e[5]=t=>o.module_type=t),class:"w-full"},{default:a(()=>[l(I,{label:"系统核心 (SYSTEM)",value:"SYSTEM"}),l(I,{label:"功能插件 (PLUGIN)",value:"PLUGIN"})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"默认策略",prop:"default_strategy"},{default:a(()=>[l(H,{modelValue:o.default_strategy,"onUpdate:modelValue":e[6]||(e[6]=t=>o.default_strategy=t)},{default:a(()=>[l(R,{value:"PERMANENT"},{default:a(()=>[...e[17]||(e[17]=[s("永久 (Permanent)",-1)])]),_:1}),l(R,{value:"TRIAL"},{default:a(()=>[...e[18]||(e[18]=[s("限期 (Trial)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"排序权重",prop:"sort_order"},{default:a(()=>[l(J,{modelValue:o.sort_order,"onUpdate:modelValue":e[7]||(e[7]=t=>o.sort_order=t),min:0,step:1},null,8,["modelValue"]),e[19]||(e[19]=d("span",{class:"ml-2 text-xs text-gray-400"},"数字越小越靠前",-1))]),_:1}),l(m,{label:"状态",prop:"is_active"},{default:a(()=>[l(N,{modelValue:o.is_active,"onUpdate:modelValue":e[8]||(e[8]=t=>o.is_active=t)},null,8,["modelValue"]),d("span",Ye,x(o.is_active?"启用":"禁用"),1)]),_:1}),l(m,{label:"备注说明",prop:"description"},{default:a(()=>[l(u,{modelValue:o.description,"onUpdate:modelValue":e[9]||(e[9]=t=>o.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ze="commercial_config",Ke={title:"commercial_config",i18nKey:"route.commercial_config",order:2,icon:"material-symbols:settings-cinematic-blur-rounded"},D={name:ze,meta:Ke};typeof D=="function"&&D(P);const je=we(P,[["__scopeId","data-v-3e854486"]]);export{je as default};
