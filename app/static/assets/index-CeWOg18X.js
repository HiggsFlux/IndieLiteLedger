import{d as G,au as J,r as u,a as D,N as z,b as Q,o as h,f as a,w as l,y as W,p as X,q as Z,x as N,E as x,g as d,t as s,J as ee,e as T,O as ae,c as V,ai as le,aj as oe,R as te,h as B,ab as re,P as ne,av as de,ag as se,ah as me,ao as ue,al as ie,ac as C}from"./index-DLYPaTml.js";import{f as ce,a as pe,b as fe,c as be}from"./role-Kmq_HSPA.js";const _e={class:"h-full overflow-hidden flex flex-col p-4"},ge={class:"mb-4"},ve={class:"dialog-footer"},ke=G({name:"manage_role",__name:"index",setup(he){const{t:o}=J(),y=u(!1),v=u([]),U=u(),i=u({name:"",code:""}),p=u(!1),b=u("add"),$=u(""),n=u({name:"",code:"",description:"",menu_keys:[],data_scope:2,is_system:!1}),A=D(()=>({name:[{required:!0,message:o("manage.role.form.roleName"),trigger:"blur"}],code:[{required:!0,message:o("manage.role.form.roleCode"),trigger:"blur"}],data_scope:[{required:!0,message:"请选择数据权限",trigger:"change"}]})),q=D(()=>[{id:"dashboard",label:o("route.dashboard"),children:[{id:"dashboard_analysis",label:o("route.dashboard_analysis")},{id:"dashboard_workbench",label:o("route.dashboard_workbench")}]},{id:"customer",label:o("route.customer"),children:[{id:"customer_list",label:o("route.customer_list")},{id:"customer_detail",label:o("route.customer_detail")}]},{id:"commercial",label:o("route.commercial"),children:[{id:"commercial_generate",label:o("route.commercial_generate")},{id:"commercial_history",label:o("route.commercial_history")},{id:"commercial_config",label:o("route.commercial_config")},{id:"commercial_mail-config",label:o("route.commercial_mail-config")}]},{id:"manage",label:o("route.manage"),children:[{id:"manage_user",label:o("route.manage_user")},{id:"manage_role",label:o("route.manage_role")}]},{id:"order",label:o("route.order"),children:[{id:"order_list",label:o("route.order_list")},{id:"order_expense",label:o("route.order_expense")}]}]);async function _(){y.value=!0;try{const e=await ce(i.value);e.data&&Array.isArray(e.data)?v.value=e.data:v.value=[]}catch(e){console.error("Error fetching role list:",e),v.value=[]}finally{y.value=!1}}function k(){_()}function M(){i.value={name:"",code:""},_()}function I(){b.value="add",$.value="",n.value={name:"",code:"",description:"",menu_keys:[],data_scope:2,is_system:!1},p.value=!0}function Y(e){b.value="edit",$.value=e.id,n.value={name:e.name,code:e.code,description:e.description,menu_keys:e.menu_keys,data_scope:e.data_scope,is_system:e.is_system},p.value=!0}async function K(e){try{await ie.confirm(o("manage.role.deleteConfirm"),o("common.warning"),{type:"warning",confirmButtonText:o("common.delete"),cancelButtonText:o("common.cancel")}),await pe(e.id),C.success(o("common.deleteSuccess")),_()}catch{}}async function L(){try{b.value==="add"?(await fe(n.value),C.success(o("common.addSuccess"))):(await be($.value,n.value),C.success(o("common.updateSuccess"))),p.value=!1,_()}catch(e){console.error("Error submitting role form:",e)}}return z(()=>{_()}),(e,r)=>{const g=Z,m=X,c=x,w=W,E=ee,f=oe,S=te,O=le,R=me,j=se,F=ue,H=ne;return h(),Q("div",_e,[a(E,{class:"mb-4"},{default:l(()=>[a(w,{inline:!0,model:i.value},{default:l(()=>[a(m,{label:e.$t("manage.role.roleName")},{default:l(()=>[a(g,{modelValue:i.value.name,"onUpdate:modelValue":r[0]||(r[0]=t=>i.value.name=t),placeholder:e.$t("manage.role.form.roleName"),clearable:"",onKeyup:N(k,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.role.roleCode")},{default:l(()=>[a(g,{modelValue:i.value.code,"onUpdate:modelValue":r[1]||(r[1]=t=>i.value.code=t),placeholder:e.$t("manage.role.form.roleCode"),clearable:"",onKeyup:N(k,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,null,{default:l(()=>[a(c,{type:"primary",onClick:k},{default:l(()=>[d(s(e.$t("common.search")),1)]),_:1}),a(c,{onClick:M},{default:l(()=>[d(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(E,{class:"flex-1 overflow-hidden flex flex-col"},{default:l(()=>[T("div",ge,[a(c,{type:"primary",onClick:I},{default:l(()=>[d(s(e.$t("manage.role.addRole")),1)]),_:1})]),ae((h(),V(O,{data:v.value,border:"",style:{width:"100%",flex:"1",overflow:"auto"}},{default:l(()=>[a(f,{prop:"name",label:e.$t("manage.role.roleName"),"min-width":"120"},null,8,["label"]),a(f,{prop:"code",label:e.$t("manage.role.roleCode"),"min-width":"120"},null,8,["label"]),a(f,{prop:"description",label:e.$t("manage.role.desc"),"min-width":"150"},null,8,["label"]),a(f,{prop:"data_scope",label:e.$t("manage.role.dataScope"),"min-width":"100"},{default:l(({row:t})=>[t.data_scope===1?(h(),V(S,{key:0,type:"danger"},{default:l(()=>[d(s(e.$t("manage.role.dataScopeAll")),1)]),_:1})):(h(),V(S,{key:1,type:"info"},{default:l(()=>[d(s(e.$t("manage.role.dataScopeSelf")),1)]),_:1}))]),_:1},8,["label"]),a(f,{prop:"created_at",label:e.$t("manage.user.createTime"),"min-width":"160"},{default:l(({row:t})=>[d(s(B(re)(t.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),a(f,{label:e.$t("common.action"),width:"180",fixed:"right"},{default:l(({row:t})=>[a(c,{link:"",type:"primary",onClick:P=>Y(t)},{default:l(()=>[d(s(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),a(c,{link:"",type:"danger",onClick:P=>K(t)},{default:l(()=>[d(s(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[H,y.value]])]),_:1}),a(F,{modelValue:p.value,"onUpdate:modelValue":r[7]||(r[7]=t=>p.value=t),title:b.value==="add"?e.$t("manage.role.addRole"):e.$t("manage.role.editRole"),width:"500px"},{footer:l(()=>[T("span",ve,[a(c,{onClick:r[6]||(r[6]=t=>p.value=!1)},{default:l(()=>[d(s(e.$t("common.cancel")),1)]),_:1}),a(c,{type:"primary",onClick:L},{default:l(()=>[d(s(e.$t("common.confirm")),1)]),_:1})])]),default:l(()=>[a(w,{ref:"formRef",model:n.value,rules:A.value,"label-width":"80px"},{default:l(()=>[a(m,{label:e.$t("manage.role.roleName"),prop:"name"},{default:l(()=>[a(g,{modelValue:n.value.name,"onUpdate:modelValue":r[2]||(r[2]=t=>n.value.name=t),placeholder:e.$t("manage.role.form.roleName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.role.roleCode"),prop:"code"},{default:l(()=>[a(g,{modelValue:n.value.code,"onUpdate:modelValue":r[3]||(r[3]=t=>n.value.code=t),placeholder:e.$t("manage.role.form.roleCode"),disabled:b.value==="edit"},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.role.desc"),prop:"description"},{default:l(()=>[a(g,{modelValue:n.value.description,"onUpdate:modelValue":r[4]||(r[4]=t=>n.value.description=t),type:"textarea",placeholder:e.$t("manage.role.form.roleDesc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.role.menuAuth")},{default:l(()=>[a(B(de),{ref_key:"treeRef",ref:U,data:q.value,"show-checkbox":"","node-key":"id",props:{label:"label",children:"children"}},null,8,["data"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.role.dataScope"),prop:"data_scope"},{default:l(()=>[a(j,{modelValue:n.value.data_scope,"onUpdate:modelValue":r[5]||(r[5]=t=>n.value.data_scope=t),placeholder:e.$t("manage.role.dataScope")},{default:l(()=>[a(R,{label:e.$t("manage.role.dataScopeAll"),value:1},null,8,["label"]),a(R,{label:e.$t("manage.role.dataScopeSelf"),value:2},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{ke as default};
