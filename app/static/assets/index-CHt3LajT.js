import{d as re,r as h,a as ne,am as de,N as ie,$ as s,b as w,o as f,f as n,e,w as r,t as o,h as l,c as P,a6 as ce,ag as pe,ah as ue,E as me,g as x,_ as ge,ap as he,J as ye,G as C,a9 as B,a7 as fe,W as _e,X as be,a8 as ve,Q as xe,R as we,ad as Se}from"./index-DLYPaTml.js";import{u as F,f as Ce,a as Be,b as Fe,c as Ae,d as Re,e as Te}from"./echarts-KNdSnvTu.js";const Ee={class:"p-4 space-y-4 bg-[#F0F2F5] min-h-screen text-[#333]"},Le={class:"flex flex-wrap justify-between items-center gap-4"},ke={class:"flex items-center gap-4"},$e={class:"font-bold text-lg border-l-4 border-[#3B82F6] pl-3 text-gray-800"},Pe={class:"flex items-center gap-2"},De={class:"flex gap-2"},Oe={class:"metric-card bg-gradient-to-r from-[#F97316] to-[#FB923C]"},Ve={class:"card-content"},Me={class:"flex justify-between items-start"},We={class:"flex flex-col"},Ne={class:"metric-label"},ze={class:"metric-value"},Ue={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Ye={class:"metric-card bg-gradient-to-r from-[#8B5CF6] to-[#A78BFA]"},je={class:"card-content"},Ie={class:"flex justify-between items-start"},Ge={class:"flex flex-col"},He={class:"metric-label"},Je={class:"metric-value"},Qe={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Xe={class:"metric-card bg-gradient-to-r from-[#EF4444] to-[#F87171]"},Ze={class:"card-content"},qe={class:"flex justify-between items-start"},Ke={class:"flex flex-col"},ea={class:"metric-label"},aa={class:"metric-value"},ta={key:0,class:"mt-4 flex items-center text-xs text-white/80"},sa={class:"metric-card bg-gradient-to-r from-[#06B6D4] to-[#22D3EE]"},oa={class:"card-content"},la={class:"flex justify-between items-start"},ra={class:"flex flex-col"},na={class:"metric-label"},da={class:"metric-value"},ia={key:0,class:"mt-4 flex items-center text-xs text-white/80"},ca={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},pa={class:"flex items-center gap-2"},ua={class:"font-bold text-gray-800"},ma={class:"flex items-center gap-2"},ga={class:"font-bold text-gray-800"},ha={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},ya={class:"flex items-center gap-2"},fa={class:"font-bold text-gray-800"},_a={class:"flex items-center gap-2"},ba={class:"font-bold text-gray-800"},va={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},xa={class:"flex items-center gap-2"},wa={class:"font-bold text-gray-800"},Sa={class:"h-[350px] overflow-y-auto pr-2 pl-4"},Ca={class:"flex items-start gap-3 mt-2"},Ba={class:"flex flex-col gap-1 w-full"},Fa={class:"flex items-center gap-2"},Aa={class:"text-sm text-gray-700 leading-relaxed"},Ra={class:"font-bold text-gray-900 mr-1"},Ta={class:"flex items-center gap-2"},Ea={class:"font-bold text-gray-800"},La=re({name:"dashboard_analysis",__name:"index",setup(ka){const y=h("year"),A=h("2025"),b=h(["2025-01","2025-12"]),R=h("all"),T=h({xAxis:[],series:[]}),E=h({xAxis:[],series:[]}),S=h({order_type:[],order_status:[]}),D=h([]),k=h({xAxis:[],series:[]}),L=ne(()=>y.value==="year"?!0:y.value==="month"?b.value&&b.value[0]===b.value[1]:!1),d=h({trial_count:0,trial_growth:0,order_count:0,order_growth:0,sales_amount:0,sales_compare_amount:0,collection_amount:0,collection_growth:0,pending_amount:0,pending_growth:0});async function O(){const a={time_dimension:y.value,year:A.value,month_range:b.value||void 0,order_type:R.value};try{const[t,m,c,_,p]=await Promise.all([Be(a),Fe(a),Ae(a),Re(a),Te(a)]);t.data&&(T.value=t.data,z((u,g)=>g())),m.data&&(E.value=m.data,H((u,g)=>g())),c.data&&(d.value=c.data),_.data&&(S.value=_.data,I((u,g)=>g()),Q((u,g)=>g())),p.data&&(k.value=p.data,Z((u,g)=>g()))}catch(t){console.error("Failed to fetch analysis data:",t)}}de([y,A,b,R],()=>{O()}),ie(()=>{O(),q()});const{domRef:N,updateOptions:z}=F(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.95)",borderWidth:0,textStyle:{color:"#333"},shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.1)"},grid:{left:"12%",right:"5%",bottom:"10%",top:"15%"},legend:{data:[s("page.dashboard.analysis.salesAmountLabel"),s("page.dashboard.analysis.collectionAmountLabel")],top:0,itemWidth:10,itemHeight:10,textStyle:{color:"#666"}},xAxis:{type:"category",data:T.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280"}},yAxis:[{type:"value",name:s("page.dashboard.analysis.amountUnit"),nameTextStyle:{color:"#6B7280"},axisLabel:{color:"#6B7280"},splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}}}],series:[{name:s("page.dashboard.analysis.salesAmountLabel"),type:"bar",barWidth:"15%",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#2dd4bf"},{offset:1,color:"rgba(45, 212, 191, 0.2)"}]}},data:T.value.series.map(a=>a.sales_amount)},{name:s("page.dashboard.analysis.collectionAmountLabel"),type:"bar",barWidth:"15%",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#60a5fa"},{offset:1,color:"rgba(96, 165, 250, 0.2)"}]}},data:T.value.series.map(a=>a.collection_amount)}]})),U={新购:"orderTypeNew",续费:"orderTypeRenew",增购:"orderTypeUpsell",人工服务:"orderTypeService",项目实施:"orderTypeImplementation"};function V(a){const t=U[a];return t?s(`page.dashboard.analysis.${t}`):a}const Y={已成交:"statusCompleted",待付款:"statusPending",部分付款:"statusPartial",已退款:"statusRefunded",退款中:"statusRefunding",部分退款:"statusPartialRefund",已作废:"statusVoided",已取消:"statusCancelled"};function $(a){const t=Y[a];return t?s(`page.dashboard.analysis.${t}`):a}const{domRef:j,updateOptions:I}=F(()=>({tooltip:{trigger:"item",formatter:a=>`${V(a.name)}: ${a.value} (${a.percent}%)`},legend:{bottom:"0%",left:"center",itemWidth:10,itemHeight:10,textStyle:{color:"#666"},formatter:a=>{const t=S.value?.order_type||[],m=t.find(p=>p.name===a),c=t.reduce((p,u)=>p+u.value,0)||0,_=m&&c>0?(m.value/c*100).toFixed(1)+"%":"0%";return`${V(a)}  (${_})`}},series:[{name:s("page.dashboard.analysis.orderType"),type:"pie",radius:["45%","70%"],center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:3},label:{show:!1},data:(S.value?.order_type||[]).map(a=>({name:a.name,value:a.value,itemStyle:{color:a.name==="新购"?"#2dd4bf":a.name==="续费"?"#60a5fa":a.name==="增购"?"#818cf8":a.name==="人工服务"?"#fb923c":a.name==="项目实施"?"#f472b6":"#ccc"}}))}]})),{domRef:G,updateOptions:H}=F(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.95)",textStyle:{color:"#333"}},legend:{data:[s("page.dashboard.analysis.enterpriseSales"),s("page.dashboard.analysis.personalSales")],bottom:0,itemWidth:10,itemHeight:10,textStyle:{color:"#666"}},grid:{left:"12%",right:"5%",bottom:"15%",top:"15%"},xAxis:{type:"category",data:E.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280"}},yAxis:[{type:"value",name:s("page.dashboard.analysis.amountUnit"),axisLabel:{color:"#6B7280"},splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}}}],series:[{name:s("page.dashboard.analysis.enterpriseSales"),type:"bar",barGap:0,itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#fb923c"},{offset:1,color:"rgba(251, 146, 60, 0.2)"}]}},data:E.value.series.map(a=>a.enterprise_sales)},{name:s("page.dashboard.analysis.personalSales"),type:"bar",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#06b6d4"},{offset:1,color:"rgba(6, 182, 212, 0.2)"}]}},data:E.value.series.map(a=>a.personal_sales)}]})),{domRef:J,updateOptions:Q}=F(()=>({tooltip:{trigger:"item",formatter:a=>`${$(a.name)}: ${a.value} (${a.percent}%)`},legend:{bottom:"0%",left:"center",textStyle:{color:"#666"},formatter:a=>{const t=S.value?.order_status||[],m=t.find(p=>p.name===a),c=t.reduce((p,u)=>p+u.value,0)||0,_=m&&c>0?(m.value/c*100).toFixed(1)+"%":"0%";return`${$(a)}  (${_})`}},series:[{name:s("page.dashboard.analysis.orderStatus"),type:"pie",radius:"60%",center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:a=>`${$(a.name)}
${a.percent}%`},data:(S.value?.order_status||[]).map(a=>({name:a.name,value:a.value,itemStyle:{color:a.name==="已成交"?"#34d399":a.name==="待付款"?"#60a5fa":a.name==="部分付款"?"#fbbf24":a.name==="已退款"?"#f87171":a.name==="退款中"?"#fca5a5":a.name==="部分退款"?"#fb923c":a.name==="已作废"?"#9ca3af":a.name==="已取消"?"#8b5cf6":"#ccc"}}))}]})),{domRef:X,updateOptions:Z}=F(()=>({tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"#ccc"}},backgroundColor:"rgba(255, 255, 255, 0.95)",textStyle:{color:"#333"}},legend:{show:!1},grid:{left:"12%",right:"5%",bottom:"10%",top:"15%"},xAxis:{type:"category",boundaryGap:!1,data:k.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280",formatter:a=>{if(!a)return"";const t=a.split("-");return t.length===2?`${Number(t[1])}${s("page.dashboard.analysis.month")}`:a}}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}},axisLabel:{color:"#6B7280"}},series:[{name:s("page.dashboard.analysis.newCustomer"),type:"line",smooth:!0,symbol:"circle",symbolSize:8,showSymbol:!0,lineStyle:{width:3,color:"#22D3EE"},itemStyle:{color:"#fff",borderColor:"#22D3EE",borderWidth:2},label:{show:!0,position:"top",color:"#0891B2"},areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(34, 211, 238, 0.6)"},{offset:1,color:"rgba(34, 211, 238, 0)"}]}},emphasis:{focus:"series"},data:k.value.series}]}));async function q(){try{const{data:a}=await Ce();a&&(D.value=a.activities)}catch(a){console.error("Failed to fetch activities:",a)}}function K(a){return a?a.replace("T"," ").substring(0,19):""}const M={0:{label:s("page.dashboard.analysis.personal"),type:"warning"},1:{label:s("page.dashboard.analysis.enterprise"),type:"success"}},ee={Wechat:s("page.dashboard.analysis.wechat"),Phone:s("page.dashboard.analysis.phone"),Visit:s("page.dashboard.analysis.visit"),Email:s("page.dashboard.analysis.email")};function ae(a){if(!a)return"";const t=a.trim().charAt(0);return/^[a-zA-Z]/.test(t)?t.toUpperCase():t}return(a,t)=>{const m=ce,c=ue,_=pe,p=ge,u=me,g=he,v=ye,te=xe,W=we,se=ve,oe=fe;return f(),w("div",Ee,[n(v,{shadow:"never",class:"!border-none !bg-white rounded-lg shadow-sm","body-style":{padding:"16px"}},{default:r(()=>[e("div",Le,[e("div",ke,[e("div",$e,o(l(s)("page.dashboard.analysis.title")),1),e("div",Pe,[y.value==="year"?(f(),P(m,{key:0,modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=i=>A.value=i),type:"year",placeholder:l(s)("page.dashboard.analysis.year"),size:"default",style:{width:"100px"},"value-format":"YYYY",clearable:!1},null,8,["modelValue","placeholder"])):(f(),P(m,{key:1,modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=i=>b.value=i),type:"monthrange","range-separator":"-","start-placeholder":l(s)("page.dashboard.analysis.start"),"end-placeholder":l(s)("page.dashboard.analysis.end"),size:"default",style:{width:"200px"},"value-format":"YYYY-MM",clearable:!1},null,8,["modelValue","start-placeholder","end-placeholder"])),n(_,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=i=>R.value=i),size:"default",style:{width:"110px"}},{default:r(()=>[n(c,{label:l(s)("page.dashboard.analysis.allOrders"),value:"all"},null,8,["label"]),n(c,{label:l(s)("page.dashboard.analysis.orderTypeNew"),value:"new"},null,8,["label"]),n(c,{label:l(s)("page.dashboard.analysis.orderTypeRenew"),value:"renew"},null,8,["label"]),n(c,{label:l(s)("page.dashboard.analysis.orderTypeUpsell"),value:"upsell"},null,8,["label"]),n(c,{label:l(s)("page.dashboard.analysis.orderTypeService"),value:"service"},null,8,["label"]),n(c,{label:l(s)("page.dashboard.analysis.orderTypeImplementation"),value:"implementation"},null,8,["label"])]),_:1},8,["modelValue"]),e("div",De,[n(u,{type:"primary",class:"!bg-[#3B82F6] !border-[#3B82F6] hover:!bg-[#2563EB]"},{icon:r(()=>[n(p,{icon:"mdi:magnify",class:"text-lg"})]),default:r(()=>[x(" "+o(l(s)("common.search")),1)]),_:1}),n(u,{class:"!text-[#666] hover:!text-[#3B82F6] hover:!border-[#3B82F6]"},{icon:r(()=>[n(p,{icon:"mdi:refresh",class:"text-lg"})]),default:r(()=>[x(" "+o(l(s)("common.reset")),1)]),_:1})])])]),n(g,null,{default:r(()=>[n(u,{type:y.value==="month"?"primary":"default",onClick:t[3]||(t[3]=i=>y.value="month"),class:"!h-8"},{default:r(()=>[x(o(l(s)("page.dashboard.analysis.month")),1)]),_:1},8,["type"]),n(u,{type:y.value==="year"?"primary":"default",onClick:t[4]||(t[4]=i=>y.value="year"),class:"!h-8"},{default:r(()=>[x(o(l(s)("page.dashboard.analysis.yearUnit")),1)]),_:1},8,["type"])]),_:1})])]),_:1}),e("div",{class:B(["grid grid-cols-1 md:grid-cols-3 gap-4","lg:grid-cols-4"])},[C("",!0),e("div",Oe,[e("div",Ve,[e("div",Me,[e("div",We,[e("span",Ne,o(l(s)("page.dashboard.analysis.orderCount")),1),e("span",ze,o(d.value.order_count),1)]),t[6]||(t[6]=e("div",{class:"i-mdi-cart text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),L.value?(f(),w("div",Ue,[e("span",null,o(l(s)("page.dashboard.analysis.comparedToLastPeriod"))+" "+o(d.value.order_growth>=0?"+":"")+o(d.value.order_growth),1),e("div",{class:B([d.value.order_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):C("",!0)])]),e("div",Ye,[e("div",je,[e("div",Ie,[e("div",Ge,[e("span",He,o(l(s)("page.dashboard.analysis.salesAmount")),1),e("span",Je,o(Math.round(d.value.sales_amount).toLocaleString()),1)]),t[7]||(t[7]=e("div",{class:"i-mdi-currency-usd text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),L.value?(f(),w("div",Qe,[e("span",null,o(l(s)("page.dashboard.analysis.comparedToLastPeriod"))+" "+o(d.value.sales_amount-d.value.sales_compare_amount>=0?"+":"")+o(Math.round(d.value.sales_amount-d.value.sales_compare_amount).toLocaleString()),1),e("div",{class:B([d.value.sales_amount-d.value.sales_compare_amount>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):C("",!0)])]),e("div",Xe,[e("div",Ze,[e("div",qe,[e("div",Ke,[e("span",ea,o(l(s)("page.dashboard.analysis.collectionAmount")),1),e("span",aa,o(Math.round(d.value.collection_amount).toLocaleString()),1)]),t[8]||(t[8]=e("div",{class:"i-mdi-cash-check text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),L.value?(f(),w("div",ta,[e("span",null,o(l(s)("page.dashboard.analysis.comparedToLastPeriod"))+" "+o(d.value.collection_growth>=0?"+":"")+o(Math.round(d.value.collection_growth).toLocaleString()),1),e("div",{class:B([d.value.collection_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):C("",!0)])]),e("div",sa,[e("div",oa,[e("div",la,[e("div",ra,[e("span",na,o(l(s)("page.dashboard.analysis.pendingAmount")),1),e("span",da,o(Math.round(d.value.pending_amount).toLocaleString()),1)]),t[9]||(t[9]=e("div",{class:"i-mdi-timer-sand text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),L.value?(f(),w("div",ia,[e("span",null,o(l(s)("page.dashboard.analysis.comparedToLastPeriod"))+" "+o(d.value.pending_growth>=0?"+":"")+o(Math.round(d.value.pending_growth).toLocaleString()),1),e("div",{class:B([d.value.pending_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):C("",!0)])])],2),e("div",ca,[n(v,{class:"lg:col-span-2 !border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:r(()=>[e("div",pa,[t[10]||(t[10]=e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"},null,-1)),e("span",ua,o(l(s)("page.dashboard.analysis.trendTitle")),1)])]),default:r(()=>[e("div",{ref_key:"trendChartRef",ref:N,class:"w-full h-[380px]"},null,512)]),_:1}),n(v,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:r(()=>[e("div",ma,[t[11]||(t[11]=e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"},null,-1)),e("span",ga,o(l(s)("page.dashboard.analysis.typeDistribution")),1)])]),default:r(()=>[e("div",{ref_key:"typePieRef",ref:j,class:"w-full h-[380px]"},null,512)]),_:1})]),e("div",ha,[n(v,{class:"lg:col-span-2 !border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:r(()=>[e("div",ya,[t[12]||(t[12]=e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"},null,-1)),e("span",fa,o(l(s)("page.dashboard.analysis.customerComparison")),1)])]),default:r(()=>[e("div",{ref_key:"comparisonChartRef",ref:G,class:"w-full h-[350px]"},null,512)]),_:1}),n(v,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:r(()=>[e("div",_a,[t[13]||(t[13]=e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"},null,-1)),e("span",ba,o(l(s)("page.dashboard.analysis.statusDistribution")),1)])]),default:r(()=>[e("div",{ref_key:"statusPieRef",ref:J,class:"w-full h-[350px]"},null,512)]),_:1})]),e("div",va,[n(v,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:r(()=>[e("div",xa,[t[14]||(t[14]=e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"},null,-1)),e("span",wa,o(l(s)("page.dashboard.analysis.title")),1)])]),default:r(()=>[e("div",Sa,[n(oe,null,{default:r(()=>[(f(!0),w(_e,null,be(D.value,(i,le)=>(f(),P(se,{key:le,color:i.color,timestamp:K(i.timestamp),placement:"top"},{default:r(()=>[e("div",Ca,[n(te,{size:40,class:"flex-shrink-0 font-bold text-lg !bg-[#3B82F6] text-white"},{default:r(()=>[x(o(ae(i.client_name)),1)]),_:2},1024),e("div",Ba,[e("div",Fa,[n(W,{size:"small",type:M[i.client_type]?.type||"info",effect:"plain",class:"!rounded-md"},{default:r(()=>[x(o(M[i.client_type]?.label||"未知"),1)]),_:2},1032,["type"]),n(W,{size:"small",type:"info",effect:"plain",class:"!rounded-md"},{default:r(()=>[x(o(ee[i.method]||i.method),1)]),_:2},1024)]),e("div",Aa,[e("span",Ra,o(i.client_name),1),e("span",null,o(i.content),1)])])])]),_:2},1032,["color","timestamp"]))),128))]),_:1})])]),_:1}),n(v,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:r(()=>[e("div",Ta,[t[15]||(t[15]=e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"},null,-1)),e("span",Ea,o(l(s)("page.dashboard.analysis.newCustomerTrend")),1)])]),default:r(()=>[e("div",{ref_key:"newCustomerChartRef",ref:X,class:"w-full h-[350px]"},null,512)]),_:1})])])}}}),Da=Se(La,[["__scopeId","data-v-dc92333e"]]);export{Da as default};
