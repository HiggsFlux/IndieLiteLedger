import{d as O,ae as J,r as m,a as W,$ as e,af as X,N as G,b as V,o as _,f as t,w as o,y as Q,p as Z,h as s,q as ee,x as D,ag as te,W as le,X as ae,c as y,ah as oe,E as se,g as r,t as u,J as ne,e as B,O as ie,ai as re,aj as ue,R as ce,P as de,ak as pe,al as me,ac as fe,ab as _e,ad as he}from"./index-tAfeRux5.js";import{b as ve,d as be}from"./client-1lYjJWgD.js";import{_ as ge}from"./ClientOperateDialog.vue_vue_type_script_setup_true_lang-CVzid3-a.js";const ye={class:"h-full overflow-hidden flex flex-col p-4 gap-4"},we={class:"mb-4"},Ce={class:"mt-4 flex justify-end"},ke=O({name:"customer_list",__name:"index",setup(xe){const N=J(),w=m(!1),v=m([]),c=m({name:"",phone:"",status:void 0}),C=m("add"),b=m(!1);m(!1);const k=m(null),x=W(()=>({0:{label:e("customer.list.statusLeads"),type:"info"},1:{label:e("customer.list.statusTrial"),type:"primary"},2:{label:e("customer.list.statusDone"),type:"success"},3:{label:e("customer.list.statusLost"),type:"warning"},9:{label:e("customer.list.statusBlacklist"),type:"danger"}})),n=X({currentPage:1,pageSize:20,total:0});async function p(){w.value=!0;try{const{data:a}=await ve({...c.value,skip:(n.currentPage-1)*n.pageSize,limit:n.pageSize});a&&(Array.isArray(a)?(v.value=a,n.total=a.length):a.items?(v.value=a.items,n.total=a.total||a.items.length):v.value=a)}finally{w.value=!1}}function $(a){n.pageSize=a,p()}function L(a){n.currentPage=a,p()}function E(){n.currentPage=1,p()}function M(){c.value={name:"",phone:"",status:void 0},n.currentPage=1,p()}function T(){C.value="add",k.value=null,b.value=!0}function U(a){C.value="edit",k.value=a,b.value=!0}function j(a){N.push({path:`/customer/detail/${a.id}`})}async function A(a){try{await me.confirm(e("customer.list.deleteConfirm"),e("common.tip"),{type:"warning"}),await be(a.id),fe.success(e("customer.list.deleteSuccess")),p()}catch{}}function R(a){return a?_e(a).format("YYYY-MM-DD HH:mm"):"-"}return G(()=>{p()}),(a,i)=>{const S=ee,g=Z,Y=oe,F=te,f=se,I=Q,z=ne,d=ue,P=ce,K=re,q=pe,H=de;return _(),V("div",ye,[t(z,{shadow:"never",class:"flex-none"},{default:o(()=>[t(I,{inline:!0,model:c.value},{default:o(()=>[t(g,{label:s(e)("customer.list.clientName")},{default:o(()=>[t(S,{modelValue:c.value.name,"onUpdate:modelValue":i[0]||(i[0]=l=>c.value.name=l),placeholder:s(e)("customer.list.namePlaceholder"),clearable:"",onKeyup:D(E,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:s(e)("customer.list.phone")},{default:o(()=>[t(S,{modelValue:c.value.phone,"onUpdate:modelValue":i[1]||(i[1]=l=>c.value.phone=l),placeholder:s(e)("customer.list.phonePlaceholder"),clearable:"",onKeyup:D(E,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:s(e)("customer.list.status")},{default:o(()=>[t(F,{modelValue:c.value.status,"onUpdate:modelValue":i[2]||(i[2]=l=>c.value.status=l),placeholder:s(e)("customer.list.statusPlaceholder"),clearable:"",style:{width:"150px"}},{default:o(()=>[(_(!0),V(le,null,ae(x.value,(l,h)=>(_(),y(Y,{key:h,label:l.label,value:Number(h)},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,null,{default:o(()=>[t(f,{type:"primary",onClick:E},{default:o(()=>[r(u(s(e)("common.search")),1)]),_:1}),t(f,{onClick:M},{default:o(()=>[r(u(s(e)("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{shadow:"never",class:"flex-1 flex flex-col min-h-0"},{default:o(()=>[B("div",we,[t(f,{type:"primary",onClick:T},{default:o(()=>[r(u(s(e)("customer.list.addClient")),1)]),_:1})]),ie((_(),y(K,{data:v.value,border:"",style:{width:"100%",height:"100%"}},{default:o(()=>[t(d,{prop:"name",label:s(e)("customer.list.clientName"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),t(d,{prop:"type",label:s(e)("customer.list.type"),width:"100"},{default:o(({row:l})=>[l.type===0?(_(),y(P,{key:0,type:"info"},{default:o(()=>[r(u(s(e)("customer.list.personal")),1)]),_:1})):(_(),y(P,{key:1,type:"primary"},{default:o(()=>[r(u(s(e)("customer.list.enterprise")),1)]),_:1}))]),_:1},8,["label"]),t(d,{prop:"status",label:s(e)("customer.list.status"),width:"120"},{default:o(({row:l})=>[t(P,{type:x.value[l.status]?.type},{default:o(()=>[r(u(x.value[l.status]?.label),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(d,{prop:"wechat",label:s(e)("customer.list.wechat"),width:"150","show-overflow-tooltip":""},null,8,["label"]),t(d,{prop:"phone",label:s(e)("customer.list.phone"),width:"150","show-overflow-tooltip":""},null,8,["label"]),t(d,{prop:"contact_person",label:s(e)("customer.list.contactPerson"),width:"120","show-overflow-tooltip":""},null,8,["label"]),t(d,{prop:"created_at",label:s(e)("customer.list.createdAt"),width:"180"},{default:o(({row:l})=>[r(u(R(l.created_at)),1)]),_:1},8,["label"]),t(d,{label:s(e)("customer.list.operate"),width:"250",fixed:"right"},{default:o(({row:l})=>[t(f,{link:"",type:"primary",onClick:h=>j(l)},{default:o(()=>[r(u(s(e)("common.check")),1)]),_:2},1032,["onClick"]),t(f,{link:"",type:"primary",onClick:h=>U(l)},{default:o(()=>[r(u(s(e)("common.edit")),1)]),_:2},1032,["onClick"]),t(f,{link:"",type:"danger",onClick:h=>A(l)},{default:o(()=>[r(u(s(e)("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[H,w.value]]),B("div",Ce,[t(q,{"current-page":n.currentPage,"onUpdate:currentPage":i[3]||(i[3]=l=>n.currentPage=l),"page-size":n.pageSize,"onUpdate:pageSize":i[4]||(i[4]=l=>n.pageSize=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:n.total,onSizeChange:$,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1}),t(ge,{visible:b.value,"onUpdate:visible":i[5]||(i[5]=l=>b.value=l),"operate-type":C.value,"row-data":k.value,onSubmitted:p},null,8,["visible","operate-type","row-data"])])}}}),ze=he(ke,[["__scopeId","data-v-80905dff"]]);export{ze as default};
