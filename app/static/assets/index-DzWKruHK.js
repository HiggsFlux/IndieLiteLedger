import{d as ee,r as m,a as te,ap as ae,N as se,b,o as g,f as o,e,w as s,c as L,a6 as oe,ah as le,ai as re,E as ne,g as _,_ as ie,as as de,J as ce,G as w,t as i,a9 as R,a7 as ue,W as pe,X as me,a8 as fe,Q as ge,R as ye,ae as ve}from"./index-CN2tD0BG.js";import{u as S,f as xe,a as _e,b as be,c as he,d as we,e as Se}from"./echarts-CzNTgnU1.js";const Be={class:"p-4 space-y-4 bg-[#F0F2F5] min-h-screen text-[#333]"},Fe={class:"flex flex-wrap justify-between items-center gap-4"},Ce={class:"flex items-center gap-4"},Ee={class:"flex items-center gap-2"},Re={class:"flex gap-2"},Ae={class:"metric-card bg-gradient-to-r from-[#F97316] to-[#FB923C]"},ke={class:"card-content"},Le={class:"flex justify-between items-start"},De={class:"flex flex-col"},Ve={class:"metric-value"},Oe={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Pe={class:"metric-card bg-gradient-to-r from-[#8B5CF6] to-[#A78BFA]"},Te={class:"card-content"},We={class:"flex justify-between items-start"},Me={class:"flex flex-col"},ze={class:"metric-value"},Ne={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Ye={class:"metric-card bg-gradient-to-r from-[#EF4444] to-[#F87171]"},$e={class:"card-content"},je={class:"flex justify-between items-start"},Ge={class:"flex flex-col"},Ue={class:"metric-value"},He={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Ie={class:"metric-card bg-gradient-to-r from-[#06B6D4] to-[#22D3EE]"},Je={class:"card-content"},Qe={class:"flex justify-between items-start"},Xe={class:"flex flex-col"},Ze={class:"metric-value"},qe={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Ke={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},et={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},tt={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},at={class:"h-[350px] overflow-y-auto pr-2 pl-4"},st={class:"flex items-start gap-3 mt-2"},ot={class:"flex flex-col gap-1 w-full"},lt={class:"flex items-center gap-2"},rt={class:"text-sm text-gray-700 leading-relaxed"},nt={class:"font-bold text-gray-900 mr-1"},it=ee({name:"dashboard_analysis",__name:"index",setup(dt){const f=m("year"),B=m("2025"),v=m(["2025-01","2025-12"]),F=m("all"),C=m({xAxis:[],series:[]}),E=m({xAxis:[],series:[]}),h=m({order_type:[],order_status:[]}),D=m([]),A=m({xAxis:[],series:[]}),k=te(()=>f.value==="year"?!0:f.value==="month"?v.value&&v.value[0]===v.value[1]:!1),l=m({trial_count:0,trial_growth:0,order_count:0,order_growth:0,sales_amount:0,sales_compare_amount:0,collection_amount:0,collection_growth:0,pending_amount:0,pending_growth:0});async function V(){const a={time_dimension:f.value,year:B.value,month_range:v.value||void 0,order_type:F.value};try{const[t,u,n,y,d]=await Promise.all([_e(a),be(a),he(a),we(a),Se(a)]);t.data&&(C.value=t.data,W((c,p)=>p())),u.data&&(E.value=u.data,Y((c,p)=>p())),n.data&&(l.value=n.data),y.data&&(h.value=y.data,z((c,p)=>p()),j((c,p)=>p())),d.data&&(A.value=d.data,U((c,p)=>p()))}catch(t){console.error("Failed to fetch analysis data:",t)}}ae([f,B,v,F],()=>{V()}),se(()=>{V(),H()});const{domRef:T,updateOptions:W}=S(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.95)",borderWidth:0,textStyle:{color:"#333"},shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.1)"},grid:{left:"12%",right:"5%",bottom:"10%",top:"15%"},legend:{data:["销售额","收款额"],top:0,itemWidth:10,itemHeight:10,textStyle:{color:"#666"}},xAxis:{type:"category",data:C.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280"}},yAxis:[{type:"value",name:"金额 (元)",nameTextStyle:{color:"#6B7280"},axisLabel:{color:"#6B7280"},splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}}}],series:[{name:"销售额",type:"bar",barWidth:"15%",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#2dd4bf"},{offset:1,color:"rgba(45, 212, 191, 0.2)"}]}},data:C.value.series.map(a=>a.sales_amount)},{name:"收款额",type:"bar",barWidth:"15%",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#60a5fa"},{offset:1,color:"rgba(96, 165, 250, 0.2)"}]}},data:C.value.series.map(a=>a.collection_amount)}]})),{domRef:M,updateOptions:z}=S(()=>({tooltip:{trigger:"item"},legend:{bottom:"0%",left:"center",itemWidth:10,itemHeight:10,textStyle:{color:"#666"},formatter:a=>{const t=h.value?.order_type||[],u=t.find(d=>d.name===a),n=t.reduce((d,c)=>d+c.value,0)||0,y=u&&n>0?(u.value/n*100).toFixed(1)+"%":"0%";return`${a}  (${y})`}},series:[{name:"订单类型",type:"pie",radius:["45%","70%"],center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:3},label:{show:!1},data:(h.value?.order_type||[]).map(a=>({name:a.name,value:a.value,itemStyle:{color:a.name==="新购"?"#2dd4bf":a.name==="续费"?"#60a5fa":a.name==="增购"?"#818cf8":a.name==="人工服务"?"#fb923c":a.name==="项目实施"?"#f472b6":"#ccc"}}))}]})),{domRef:N,updateOptions:Y}=S(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.95)",textStyle:{color:"#333"}},legend:{data:["企业销售额","个人销售额"],bottom:0,itemWidth:10,itemHeight:10,textStyle:{color:"#666"}},grid:{left:"12%",right:"5%",bottom:"15%",top:"15%"},xAxis:{type:"category",data:E.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280"}},yAxis:[{type:"value",name:"金额 (元)",axisLabel:{color:"#6B7280"},splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}}}],series:[{name:"企业销售额",type:"bar",barGap:0,itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#fb923c"},{offset:1,color:"rgba(251, 146, 60, 0.2)"}]}},data:E.value.series.map(a=>a.enterprise_sales)},{name:"个人销售额",type:"bar",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#06b6d4"},{offset:1,color:"rgba(6, 182, 212, 0.2)"}]}},data:E.value.series.map(a=>a.personal_sales)}]})),{domRef:$,updateOptions:j}=S(()=>({tooltip:{trigger:"item"},legend:{bottom:"0%",left:"center",textStyle:{color:"#666"},formatter:a=>{const t=h.value?.order_status||[],u=t.find(d=>d.name===a),n=t.reduce((d,c)=>d+c.value,0)||0,y=u&&n>0?(u.value/n*100).toFixed(1)+"%":"0%";return`${a}  (${y})`}},series:[{name:"订单状态",type:"pie",radius:"60%",center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:`{b}
{d}%`},data:(h.value?.order_status||[]).map(a=>({name:a.name,value:a.value,itemStyle:{color:a.name==="已成交"?"#34d399":a.name==="待付款"?"#60a5fa":a.name==="部分付款"?"#fbbf24":a.name==="已退款"?"#f87171":a.name==="退款中"?"#fca5a5":a.name==="部分退款"?"#fb923c":a.name==="已作废"?"#9ca3af":a.name==="已取消"?"#8b5cf6":"#ccc"}}))}]})),{domRef:G,updateOptions:U}=S(()=>({tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"#ccc"}},backgroundColor:"rgba(255, 255, 255, 0.95)",textStyle:{color:"#333"}},legend:{show:!1},grid:{left:"12%",right:"5%",bottom:"10%",top:"15%"},xAxis:{type:"category",boundaryGap:!1,data:A.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280",formatter:a=>{if(!a)return"";const t=a.split("-");return t.length===2?`${Number(t[1])}月`:a}}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}},axisLabel:{color:"#6B7280"}},series:[{name:"新增客户",type:"line",smooth:!0,symbol:"circle",symbolSize:8,showSymbol:!0,lineStyle:{width:3,color:"#22D3EE"},itemStyle:{color:"#fff",borderColor:"#22D3EE",borderWidth:2},label:{show:!0,position:"top",color:"#0891B2"},areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(34, 211, 238, 0.6)"},{offset:1,color:"rgba(34, 211, 238, 0)"}]}},emphasis:{focus:"series"},data:A.value.series}]}));async function H(){try{const{data:a}=await xe();a&&(D.value=a.activities)}catch(a){console.error("Failed to fetch activities:",a)}}function I(a){return a?a.replace("T"," ").substring(0,19):""}const O={0:{label:"个人",type:"warning"},1:{label:"企业",type:"success"}},J={Wechat:"微信",Phone:"电话",Visit:"拜访",Email:"邮件"};function Q(a){if(!a)return"";const t=a.trim().charAt(0);return/^[a-zA-Z]/.test(t)?t.toUpperCase():t}return(a,t)=>{const u=oe,n=re,y=le,d=ie,c=ne,p=de,x=ce,X=ge,P=ye,Z=fe,q=ue;return g(),b("div",Be,[o(x,{shadow:"never",class:"!border-none !bg-white rounded-lg shadow-sm","body-style":{padding:"16px"}},{default:s(()=>[e("div",Fe,[e("div",Ce,[t[7]||(t[7]=e("div",{class:"font-bold text-lg border-l-4 border-[#3B82F6] pl-3 text-gray-800"},"销售分析看板",-1)),e("div",Ee,[f.value==="year"?(g(),L(u,{key:0,modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=r=>B.value=r),type:"year",placeholder:"年份",size:"default",style:{width:"100px"},"value-format":"YYYY",clearable:!1},null,8,["modelValue"])):(g(),L(u,{key:1,modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=r=>v.value=r),type:"monthrange","range-separator":"-","start-placeholder":"开始","end-placeholder":"结束",size:"default",style:{width:"200px"},"value-format":"YYYY-MM",clearable:!1},null,8,["modelValue"])),o(y,{modelValue:F.value,"onUpdate:modelValue":t[2]||(t[2]=r=>F.value=r),size:"default",style:{width:"110px"}},{default:s(()=>[o(n,{label:"全部订单",value:"all"}),o(n,{label:"新购",value:"new"}),o(n,{label:"续费",value:"renew"}),o(n,{label:"增购",value:"upsell"}),o(n,{label:"人工服务",value:"service"}),o(n,{label:"项目实施",value:"implementation"})]),_:1},8,["modelValue"]),e("div",Re,[o(c,{type:"primary",class:"!bg-[#3B82F6] !border-[#3B82F6] hover:!bg-[#2563EB]"},{icon:s(()=>[o(d,{icon:"mdi:magnify",class:"text-lg"})]),default:s(()=>[t[5]||(t[5]=_(" 查询 ",-1))]),_:1}),o(c,{class:"!text-[#666] hover:!text-[#3B82F6] hover:!border-[#3B82F6]"},{icon:s(()=>[o(d,{icon:"mdi:refresh",class:"text-lg"})]),default:s(()=>[t[6]||(t[6]=_(" 重置 ",-1))]),_:1})])])]),o(p,null,{default:s(()=>[o(c,{type:f.value==="month"?"primary":"default",onClick:t[3]||(t[3]=r=>f.value="month"),class:"!h-8"},{default:s(()=>[...t[8]||(t[8]=[_("月",-1)])]),_:1},8,["type"]),o(c,{type:f.value==="year"?"primary":"default",onClick:t[4]||(t[4]=r=>f.value="year"),class:"!h-8"},{default:s(()=>[...t[9]||(t[9]=[_("年",-1)])]),_:1},8,["type"])]),_:1})])]),_:1}),e("div",{class:R(["grid grid-cols-1 md:grid-cols-3 gap-4","lg:grid-cols-4"])},[w("",!0),e("div",Ae,[e("div",ke,[e("div",Le,[e("div",De,[t[12]||(t[12]=e("span",{class:"metric-label"},"订单量 (单)",-1)),e("span",Ve,i(l.value.order_count),1)]),t[13]||(t[13]=e("div",{class:"i-mdi-cart text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(g(),b("div",Oe,[e("span",null,"较上期 "+i(l.value.order_growth>=0?"+":"")+i(l.value.order_growth),1),e("div",{class:R([l.value.order_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):w("",!0)])]),e("div",Pe,[e("div",Te,[e("div",We,[e("div",Me,[t[14]||(t[14]=e("span",{class:"metric-label"},"销售额 (元)",-1)),e("span",ze,i(Math.round(l.value.sales_amount).toLocaleString()),1)]),t[15]||(t[15]=e("div",{class:"i-mdi-currency-usd text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(g(),b("div",Ne,[e("span",null,"较上期 "+i(l.value.sales_amount-l.value.sales_compare_amount>=0?"+":"")+i(Math.round(l.value.sales_amount-l.value.sales_compare_amount).toLocaleString())+" 元",1),e("div",{class:R([l.value.sales_amount-l.value.sales_compare_amount>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):w("",!0)])]),e("div",Ye,[e("div",$e,[e("div",je,[e("div",Ge,[t[16]||(t[16]=e("span",{class:"metric-label"},"回款金额 (元)",-1)),e("span",Ue,i(Math.round(l.value.collection_amount).toLocaleString()),1)]),t[17]||(t[17]=e("div",{class:"i-mdi-cash-check text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(g(),b("div",He,[e("span",null,"较上期 "+i(l.value.collection_growth>=0?"+":"")+i(Math.round(l.value.collection_growth).toLocaleString())+" 元",1),e("div",{class:R([l.value.collection_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):w("",!0)])]),e("div",Ie,[e("div",Je,[e("div",Qe,[e("div",Xe,[t[18]||(t[18]=e("span",{class:"metric-label"},"待回款 (元)",-1)),e("span",Ze,i(Math.round(l.value.pending_amount).toLocaleString()),1)]),t[19]||(t[19]=e("div",{class:"i-mdi-clock-alert text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),l.value.pending_amount>5e3?(g(),b("div",qe,[...t[20]||(t[20]=[e("span",null,"需加紧催收",-1)])])):w("",!0)])])],2),e("div",Ke,[o(x,{class:"lg:col-span-2 !border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:s(()=>[...t[21]||(t[21]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"销售与收款趋势")],-1)])]),default:s(()=>[e("div",{ref_key:"trendChartRef",ref:T,class:"w-full h-[380px]"},null,512)]),_:1}),o(x,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:s(()=>[...t[22]||(t[22]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"订单类型分布")],-1)])]),default:s(()=>[e("div",{ref_key:"typePieRef",ref:M,class:"w-full h-[380px]"},null,512)]),_:1})]),e("div",et,[o(x,{class:"lg:col-span-2 !border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:s(()=>[...t[23]||(t[23]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"客户对比 (企业 vs 个人)")],-1)])]),default:s(()=>[e("div",{ref_key:"comparisonChartRef",ref:N,class:"w-full h-[350px]"},null,512)]),_:1}),o(x,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:s(()=>[...t[24]||(t[24]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"订单状态占比分析")],-1)])]),default:s(()=>[e("div",{ref_key:"statusPieRef",ref:$,class:"w-full h-[350px]"},null,512)]),_:1})]),e("div",tt,[o(x,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:s(()=>[...t[25]||(t[25]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"用户跟进记录")],-1)])]),default:s(()=>[e("div",at,[o(q,null,{default:s(()=>[(g(!0),b(pe,null,me(D.value,(r,K)=>(g(),L(Z,{key:K,color:r.color,timestamp:I(r.timestamp),placement:"top"},{default:s(()=>[e("div",st,[o(X,{size:40,class:"flex-shrink-0 font-bold text-lg !bg-[#3B82F6] text-white"},{default:s(()=>[_(i(Q(r.client_name)),1)]),_:2},1024),e("div",ot,[e("div",lt,[o(P,{size:"small",type:O[r.client_type]?.type||"info",effect:"plain",class:"!rounded-md"},{default:s(()=>[_(i(O[r.client_type]?.label||"未知"),1)]),_:2},1032,["type"]),o(P,{size:"small",type:"info",effect:"plain",class:"!rounded-md"},{default:s(()=>[_(i(J[r.method]||r.method),1)]),_:2},1024)]),e("div",rt,[e("span",nt,i(r.client_name),1),e("span",null,i(r.content),1)])])])]),_:2},1032,["color","timestamp"]))),128))]),_:1})])]),_:1}),o(x,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:s(()=>[...t[26]||(t[26]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"最近6个月新增客户信息")],-1)])]),default:s(()=>[e("div",{ref_key:"newCustomerChartRef",ref:G,class:"w-full h-[350px]"},null,512)]),_:1})])])}}}),pt=ve(it,[["__scopeId","data-v-a888aeaa"]]);export{pt as default};
