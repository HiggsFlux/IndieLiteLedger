import{aq as N,d as q,a as S,r as V,af as G,$ as e,am as ce,c as U,o as m,w as l,f as t,y as de,p as ie,h as o,q as ue,ax as pe,g as _,ag as z,b as C,W as j,X as H,ah as J,a6 as X,a4 as me,a5 as _e,t as s,E as W,ao as Q,ac as F,G as Z,U as ge,V as ve,e as a,R as ee,ay as be,_ as te,ad as ae,N as xe,a9 as B,J as ye,O as fe,ai as he,aj as Ae,P as we,al as Me}from"./index-DLYPaTml.js";import{_ as oe}from"./image-upload.vue_vue_type_script_setup_true_lang-DIFpvivy.js";import"./order-CWAkhiTI.js";function Ce(b){return N({url:"/cost/list",method:"get",params:b})}function Se(b){return N({url:"/cost",method:"post",data:b})}function Ee(b){return N({url:`/cost/${b}`,method:"delete"})}function Ve(b,E){return N({url:`/cost/${b}`,method:"put",data:E})}function Ie(){return N({url:"/cost/stats",method:"get"})}const ke=q({name:"AddCostModal",__name:"AddCostModal",props:{visible:{type:Boolean}},emits:["update:visible","success"],setup(b,{emit:E}){const A=b,r=E,x=S({get(){return A.visible},set(f){r("update:visible",f)}}),w=V(),g=V(!1),c=G({title:"",amount:0,category:"CLOUD",pay_time:new Date().toISOString().split("T")[0],pay_account:"ALIPAY",invoice_url:"",remark:""}),T=S(()=>({title:[{required:!0,message:e("order.expense.validation.summary"),trigger:"blur"}],amount:[{required:!0,message:e("order.expense.validation.amount"),trigger:"blur"}],category:[{required:!0,message:e("order.expense.validation.category"),trigger:"change"}],pay_time:[{required:!0,message:e("order.expense.validation.payTime"),trigger:"change"}],pay_account:[{required:!0,message:e("order.expense.validation.payAccount"),trigger:"change"}]})),u=S(()=>[{label:e("order.expense.categoryMap.CLOUD"),value:"CLOUD"},{label:e("order.expense.categoryMap.AI_API"),value:"AI_API"},{label:e("order.expense.categoryMap.LABOR"),value:"LABOR"},{label:e("order.expense.categoryMap.SAAS"),value:"SAAS"},{label:e("order.expense.categoryMap.MARKETING"),value:"MARKETING"},{label:e("order.expense.categoryMap.OTHER"),value:"OTHER"}]),M=S(()=>[{label:e("order.expense.accountMap.ALIPAY"),value:"ALIPAY"},{label:e("order.expense.accountMap.WECHAT"),value:"WECHAT"},{label:e("order.expense.accountMap.BANK"),value:"BANK"}]);async function y(){await w.value?.validate(),g.value=!0;try{const{error:f}=await Se(c);f||(F.success(e("common.addSuccess")),r("success"),x.value=!1,I())}finally{g.value=!1}}function I(){w.value?.resetFields(),c.title="",c.amount=0,c.category="CLOUD",c.pay_time=new Date().toISOString().split("T")[0],c.pay_account="ALIPAY",c.invoice_url="",c.remark=""}return ce(x,f=>{f||I()}),(f,i)=>{const k=ue,h=ie,P=pe,O=J,v=z,p=X,L=_e,D=me,K=de,Y=W,$=Q;return m(),U($,{modelValue:x.value,"onUpdate:modelValue":i[8]||(i[8]=d=>x.value=d),title:o(e)("order.expense.addTitle"),width:"600px","destroy-on-close":""},{footer:l(()=>[t(Y,{onClick:i[7]||(i[7]=d=>x.value=!1)},{default:l(()=>[_(s(o(e)("common.cancel")),1)]),_:1}),t(Y,{type:"primary",loading:g.value,onClick:y},{default:l(()=>[_(s(o(e)("common.confirm")),1)]),_:1},8,["loading"])]),default:l(()=>[t(K,{ref_key:"formRef",ref:w,model:c,rules:T.value,"label-width":"100px"},{default:l(()=>[t(h,{label:o(e)("order.expense.summary"),prop:"title"},{default:l(()=>[t(k,{modelValue:c.title,"onUpdate:modelValue":i[0]||(i[0]=d=>c.title=d),placeholder:o(e)("order.expense.summaryPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(h,{label:o(e)("order.expense.amount"),prop:"amount"},{default:l(()=>[t(P,{modelValue:c.amount,"onUpdate:modelValue":i[1]||(i[1]=d=>c.amount=d),min:0,precision:2,class:"!w-full"},{prefix:l(()=>[...i[9]||(i[9]=[_("¥",-1)])]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(h,{label:o(e)("order.expense.category"),prop:"category"},{default:l(()=>[t(v,{modelValue:c.category,"onUpdate:modelValue":i[2]||(i[2]=d=>c.category=d),placeholder:o(e)("order.expense.categoryPlaceholder"),class:"w-full"},{default:l(()=>[(m(!0),C(j,null,H(u.value,d=>(m(),U(O,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(h,{label:o(e)("order.expense.expenseTime"),prop:"pay_time"},{default:l(()=>[t(p,{modelValue:c.pay_time,"onUpdate:modelValue":i[3]||(i[3]=d=>c.pay_time=d),type:"date",placeholder:o(e)("order.expense.payTimePlaceholder"),"value-format":"YYYY-MM-DD",class:"!w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(h,{label:o(e)("order.expense.payAccount"),prop:"pay_account"},{default:l(()=>[t(D,{modelValue:c.pay_account,"onUpdate:modelValue":i[4]||(i[4]=d=>c.pay_account=d)},{default:l(()=>[(m(!0),C(j,null,H(M.value,d=>(m(),U(L,{key:d.value,value:d.value},{default:l(()=>[_(s(d.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(h,{label:o(e)("order.expense.voucher"),prop:"invoice_url"},{default:l(()=>[t(oe,{modelValue:c.invoice_url,"onUpdate:modelValue":i[5]||(i[5]=d=>c.invoice_url=d)},null,8,["modelValue"])]),_:1},8,["label"]),t(h,{label:o(e)("common.remark"),prop:"remark"},{default:l(()=>[t(k,{modelValue:c.remark,"onUpdate:modelValue":i[6]||(i[6]=d=>c.remark=d),type:"textarea",rows:3,placeholder:o(e)("order.expense.remarkPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Le={key:0,class:"space-y-4"},Te={class:"font-mono font-bold text-red-500"},Oe={class:"flex flex-col gap-4 mt-2"},Re={key:0},De={class:"flex items-center justify-center w-full h-40 bg-gray-50 text-gray-400"},Be={key:1,class:"text-gray-400 mb-2"},Ue={class:"pt-2 border-t border-gray-50"},Pe=q({name:"CostDetailModal",__name:"CostDetailModal",props:{visible:{type:Boolean},data:{}},emits:["update:visible","success"],setup(b,{emit:E}){const A=b,r=E,x=V(!1),w=S({get(){return A.visible},set(u){r("update:visible",u)}}),g=S(()=>({CLOUD:e("order.expense.categoryMap.CLOUD"),AI_API:e("order.expense.categoryMap.AI_API"),LABOR:e("order.expense.categoryMap.LABOR"),SAAS:e("order.expense.categoryMap.SAAS"),MARKETING:e("order.expense.categoryMap.MARKETING"),OTHER:e("order.expense.categoryMap.OTHER")})),c=S(()=>({ALIPAY:e("order.expense.accountMap.ALIPAY"),WECHAT:e("order.expense.accountMap.WECHAT"),BANK:e("order.expense.accountMap.BANK")}));async function T(u){if(A.data?.id){x.value=!0;try{const{error:M}=await Ve(A.data.id,{invoice_url:u});M||(F.success(e("common.updateSuccess")),A.data&&(A.data.invoice_url=u),r("success"))}finally{x.value=!1}}}return(u,M)=>{const y=ve,I=ee,f=te,i=be,k=ge,h=W,P=Q;return m(),U(P,{modelValue:w.value,"onUpdate:modelValue":M[1]||(M[1]=O=>w.value=O),title:o(e)("common.check"),width:"600px","destroy-on-close":""},{footer:l(()=>[t(h,{onClick:M[0]||(M[0]=O=>w.value=!1)},{default:l(()=>[_(s(o(e)("common.close")),1)]),_:1})]),default:l(()=>[u.data?(m(),C("div",Le,[t(k,{column:1,border:""},{default:l(()=>[t(y,{label:o(e)("order.expense.summary")},{default:l(()=>[_(s(u.data.title),1)]),_:1},8,["label"]),t(y,{label:o(e)("order.expense.amount")},{default:l(()=>[a("span",Te,"¥"+s(Number(u.data.amount).toLocaleString()),1)]),_:1},8,["label"]),t(y,{label:o(e)("order.expense.category")},{default:l(()=>[t(I,null,{default:l(()=>[_(s(g.value[u.data.category]||u.data.category),1)]),_:1})]),_:1},8,["label"]),t(y,{label:o(e)("order.expense.expenseTime")},{default:l(()=>[_(s(u.data.pay_time),1)]),_:1},8,["label"]),t(y,{label:o(e)("order.expense.payAccount")},{default:l(()=>[_(s(c.value[u.data.pay_account]||u.data.pay_account),1)]),_:1},8,["label"]),t(y,{label:o(e)("common.remark")},{default:l(()=>[_(s(u.data.remark||"-"),1)]),_:1},8,["label"]),t(y,{label:o(e)("order.expense.voucher")},{default:l(()=>[a("div",Oe,[u.data.invoice_url?(m(),C("div",Re,[t(i,{src:u.data.invoice_url,"preview-src-list":[u.data.invoice_url],fit:"contain",class:"w-full max-h-80 rounded-lg border border-gray-100 shadow-sm","preview-teleported":""},{error:l(()=>[a("div",De,[t(f,{icon:"material-symbols:image-not-supported-outline",class:"text-3xl"})])]),_:1},8,["src","preview-src-list"])])):(m(),C("div",Be,s(o(e)("order.list.attachment.noAttachment")),1)),a("div",Ue,[t(oe,{"model-value":u.data.invoice_url,placeholder:u.data.invoice_url?o(e)("common.update")+o(e)("order.expense.voucher"):o(e)("common.upload")+o(e)("order.expense.voucher"),"onUpdate:modelValue":T},null,8,["model-value","placeholder"])])])]),_:1},8,["label"])]),_:1})])):Z("",!0)]),_:1},8,["modelValue","title"])}}}),Ne=ae(Pe,[["__scopeId","data-v-66fe7526"]]),Ye={class:"h-full flex flex-col gap-4 p-4 overflow-hidden"},$e={key:0,class:"grid grid-cols-1 lg:grid-cols-4 gap-4 shrink-0"},je={class:"flex flex-col h-full p-5"},He={class:"flex justify-between items-start mb-4"},Ke={class:"p-4 bg-blue-50 rounded-xl text-blue-500 flex items-center justify-center"},Ge={class:"text-right"},qe={class:"text-gray-500 text-base font-medium mb-1"},We={class:"text-3xl font-bold text-gray-900"},Fe={class:"mt-auto space-y-1 text-base"},ze={class:"flex justify-between items-center"},Je={class:"text-gray-500"},Xe={class:"font-medium text-gray-700"},Qe={class:"flex justify-between items-center"},Ze={class:"text-gray-500"},et={class:"flex justify-between items-center"},tt={class:"text-gray-500"},at={class:"flex flex-col h-full p-5"},ot={class:"flex justify-between items-start mb-4"},lt={class:"p-4 bg-indigo-50 rounded-xl text-indigo-500 flex items-center justify-center"},st={class:"text-right"},nt={class:"text-gray-500 text-base font-medium mb-1"},rt={class:"text-3xl font-bold text-gray-900"},ct={class:"mt-auto space-y-1 text-base"},dt={class:"flex justify-between items-center"},it={class:"text-gray-500"},ut={class:"font-medium text-gray-700"},pt={class:"flex justify-between items-center"},mt={class:"text-gray-500"},_t={class:"flex justify-between items-center"},gt={class:"text-gray-500"},vt={class:"flex flex-col h-full p-4"},bt={class:"flex items-center justify-between mb-4"},xt={class:"flex items-center gap-2 font-bold text-gray-800"},yt={class:"grid grid-cols-2 sm:grid-cols-3 gap-2"},ft={class:"flex flex-col flex-1 min-w-0"},ht={class:"text-xs text-gray-500 mb-1 truncate"},At={class:"flex items-baseline justify-between gap-2"},wt={class:"font-bold text-gray-900 text-lg truncate"},Mt={class:"text-xs text-gray-400 shrink-0"},Ct={class:"flex justify-between items-center"},St={class:"flex gap-4"},Et={class:"font-mono font-bold text-red-500"},Vt={class:"flex gap-2"},It=q({name:"order_expense",__name:"index",setup(b){const E=V(!1),A=V([]),r=V(null),x=V(!1),w=V(null),g=G({category:"",pay_time_start:void 0,pay_time_end:void 0}),c=G({current:1,pageSize:20,total:0}),T=V(!1),u=S(()=>[{label:e("order.expense.allCategory"),value:""},{label:e("order.expense.categoryMap.CLOUD"),value:"CLOUD"},{label:e("order.expense.categoryMap.AI_API"),value:"AI_API"},{label:e("order.expense.categoryMap.LABOR"),value:"LABOR"},{label:e("order.expense.categoryMap.SAAS"),value:"SAAS"},{label:e("order.expense.categoryMap.MARKETING"),value:"MARKETING"},{label:e("order.expense.categoryMap.OTHER"),value:"OTHER"}]),M=S(()=>({ALIPAY:e("order.expense.accountMap.ALIPAY"),WECHAT:e("order.expense.accountMap.WECHAT"),BANK:e("order.expense.accountMap.BANK")})),y=S(()=>({CLOUD:e("order.expense.categoryMap.CLOUD"),AI_API:e("order.expense.categoryMap.AI_API"),LABOR:e("order.expense.categoryMap.LABOR"),SAAS:e("order.expense.categoryMap.SAAS"),MARKETING:e("order.expense.categoryMap.MARKETING"),OTHER:e("order.expense.categoryMap.OTHER")}));function I(v){return{CLOUD:{bg:"bg-blue-50",text:"text-blue-600",icon:"carbon:cloud-service-management",iconBg:"bg-blue-100"},AI_API:{bg:"bg-orange-50",text:"text-orange-600",icon:"carbon:bot",iconBg:"bg-orange-100"},LABOR:{bg:"bg-red-50",text:"text-red-600",icon:"carbon:user-multiple",iconBg:"bg-red-100"},SAAS:{bg:"bg-green-50",text:"text-green-600",icon:"carbon:application",iconBg:"bg-green-100"},MARKETING:{bg:"bg-purple-50",text:"text-purple-600",icon:"carbon:bullhorn",iconBg:"bg-purple-100"},OTHER:{bg:"bg-gray-50",text:"text-gray-600",icon:"carbon:document",iconBg:"bg-gray-100"}}[v]||{bg:"bg-gray-50",text:"text-gray-600",icon:"carbon:unknown",iconBg:"bg-gray-100"}}async function f(){const{data:v,error:p}=await Ie();!p&&v&&(r.value=v)}async function i(){E.value=!0;try{const v={...g,skip:(c.current-1)*c.pageSize,limit:c.pageSize},{data:p,error:L}=await Ce(v);!L&&p&&(A.value=p,c.total=p.length)}finally{E.value=!1}}function k(){c.current=1,i()}function h(v){w.value=v,x.value=!0}async function P(v){try{await Me.confirm(e("order.expense.deleteConfirm"),e("common.warning"),{type:"warning"});const{error:p}=await Ee(v.id);p||(F.success(e("common.deleteSuccess")),i(),f())}catch{}}function O(){i(),f()}return xe(()=>{i(),f()}),(v,p)=>{const L=te,D=ye,K=J,Y=z,$=X,d=W,R=Ae,le=ee,se=he,ne=we;return m(),C("div",Ye,[r.value?(m(),C("div",$e,[t(D,{shadow:"never",class:"!border-none bg-white rounded-xl"},{default:l(()=>[a("div",je,[a("div",He,[a("div",Ke,[t(L,{icon:"material-symbols:calendar-month-outline",class:"text-4xl"})]),a("div",Ge,[a("div",qe,s(o(e)("order.expense.monthlyCost")),1),a("div",We,s(r.value.month_cost.toLocaleString()),1)])]),a("div",Fe,[a("div",ze,[a("span",Je,s(o(e)("order.expense.lastMonthPeriod")),1),a("span",Xe,s(r.value.month_cost_last.toLocaleString()),1)]),a("div",Qe,[a("span",Ze,s(o(e)("order.expense.growthAmount")),1),a("span",{class:B(["font-bold",r.value.month_cost-r.value.month_cost_last>0?"text-red-500":"text-green-500"])},s(r.value.month_cost-r.value.month_cost_last>0?"+":"")+s(Math.abs(r.value.month_cost-r.value.month_cost_last).toLocaleString()),3)]),a("div",et,[a("span",tt,s(o(e)("order.expense.growthRate")),1),a("span",{class:B(["font-bold",r.value.month_growth>0?"text-red-500":"text-green-500"])},s(r.value.month_growth>0?"+":"")+s(r.value.month_growth)+"% ",3)])])])]),_:1}),t(D,{shadow:"never",class:"!border-none bg-white rounded-xl"},{default:l(()=>[a("div",at,[a("div",ot,[a("div",lt,[t(L,{icon:"material-symbols:trending-up",class:"text-4xl"})]),a("div",st,[a("div",nt,s(o(e)("order.expense.yearlyCost")),1),a("div",rt,s(r.value.year_cost.toLocaleString()),1)])]),a("div",ct,[a("div",dt,[a("span",it,s(o(e)("order.expense.lastYearPeriod")),1),a("span",ut,s(r.value.year_cost_last.toLocaleString()),1)]),a("div",pt,[a("span",mt,s(o(e)("order.expense.growthAmount")),1),a("span",{class:B(["font-bold",r.value.year_cost-r.value.year_cost_last>0?"text-red-500":"text-green-500"])},s(r.value.year_cost-r.value.year_cost_last>0?"+":"")+s(Math.abs(r.value.year_cost-r.value.year_cost_last).toLocaleString()),3)]),a("div",_t,[a("span",gt,s(o(e)("order.expense.growthRate")),1),a("span",{class:B(["font-bold",r.value.year_growth>0?"text-red-500":"text-green-500"])},s(r.value.year_growth>0?"+":"")+s(r.value.year_growth)+"% ",3)])])])]),_:1}),t(D,{shadow:"never",class:"!border-none bg-white lg:col-span-2 rounded-xl"},{default:l(()=>[a("div",vt,[a("div",bt,[a("div",xt,s(o(e)("order.expense.categoryOverview")),1)]),a("div",yt,[(m(!0),C(j,null,H(r.value.category_breakdown,n=>(m(),C("div",{key:n.name,class:B(["p-3 rounded-xl flex items-center gap-3 transition-all hover:shadow-sm border border-transparent hover:border-gray-100",I(n.name).bg])},[a("div",{class:B(["w-10 h-10 rounded-lg flex items-center justify-center shrink-0 bg-white shadow-sm",I(n.name).text])},[t(L,{icon:I(n.name).icon,class:"text-xl"},null,8,["icon"])],2),a("div",ft,[a("span",ht,s(y.value[n.name]||n.name),1),a("div",At,[a("span",wt,s(n.amount.toLocaleString()),1),a("span",Mt,s(n.percent)+"%",1)])])],2))),128))])])]),_:1})])):Z("",!0),t(D,{shadow:"never",class:"flex-1 flex flex-col !border-none"},{header:l(()=>[a("div",Ct,[a("div",St,[t(Y,{modelValue:g.category,"onUpdate:modelValue":p[0]||(p[0]=n=>g.category=n),placeholder:o(e)("order.expense.category"),clearable:"",onChange:k,class:"w-40"},{default:l(()=>[(m(!0),C(j,null,H(u.value,n=>(m(),U(K,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),t($,{modelValue:g.pay_time_start,"onUpdate:modelValue":p[1]||(p[1]=n=>g.pay_time_start=n),type:"date",placeholder:o(e)("common.startTime"),"value-format":"YYYY-MM-DD",onChange:k,class:"w-40"},null,8,["modelValue","placeholder"]),t($,{modelValue:g.pay_time_end,"onUpdate:modelValue":p[2]||(p[2]=n=>g.pay_time_end=n),type:"date",placeholder:o(e)("common.endTime"),"value-format":"YYYY-MM-DD",onChange:k,class:"w-40"},null,8,["modelValue","placeholder"])]),t(d,{type:"primary",onClick:p[3]||(p[3]=n=>T.value=!0)},{icon:l(()=>[t(L,{icon:"material-symbols:add"})]),default:l(()=>[_(" "+s(o(e)("order.expense.addExpense")),1)]),_:1})])]),default:l(()=>[fe((m(),U(se,{data:A.value,height:"100%",stripe:""},{default:l(()=>[t(R,{prop:"pay_time",label:o(e)("order.expense.expenseTime"),width:"120",sortable:""},null,8,["label"]),t(R,{prop:"title",label:o(e)("order.expense.summary"),"min-width":"200","show-overflow-tooltip":""},null,8,["label"]),t(R,{prop:"category",label:o(e)("order.expense.category"),width:"120"},{default:l(({row:n})=>[t(le,null,{default:l(()=>[_(s(y.value[n.category]||n.category),1)]),_:2},1024)]),_:1},8,["label"]),t(R,{prop:"amount",label:o(e)("order.expense.amount"),width:"120",align:"right"},{default:l(({row:n})=>[a("span",Et,"-¥"+s(Number(n.amount).toLocaleString()),1)]),_:1},8,["label"]),t(R,{prop:"pay_account",label:o(e)("order.expense.payAccount"),width:"120"},{default:l(({row:n})=>[_(s(M.value[n.pay_account]||n.pay_account),1)]),_:1},8,["label"]),t(R,{prop:"remark",label:o(e)("common.remark"),"min-width":"150","show-overflow-tooltip":""},null,8,["label"]),t(R,{label:o(e)("common.action"),width:"140",fixed:"right"},{default:l(({row:n})=>[a("div",Vt,[t(d,{type:"primary",link:"",onClick:re=>h(n)},{default:l(()=>[_(s(o(e)("common.check")),1)]),_:2},1032,["onClick"]),t(d,{type:"danger",link:"",onClick:re=>P(n)},{default:l(()=>[_(s(o(e)("common.delete")),1)]),_:2},1032,["onClick"])])]),_:1},8,["label"])]),_:1},8,["data"])),[[ne,E.value]])]),_:1}),t(ke,{visible:T.value,"onUpdate:visible":p[4]||(p[4]=n=>T.value=n),onSuccess:O},null,8,["visible"]),t(Ne,{visible:x.value,"onUpdate:visible":p[5]||(p[5]=n=>x.value=n),data:w.value,onSuccess:O},null,8,["visible","data"])])}}}),Ot=ae(It,[["__scopeId","data-v-8e158df6"]]);export{Ot as default};
