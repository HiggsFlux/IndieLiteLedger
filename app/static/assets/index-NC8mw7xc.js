import{d as ee,r as f,a as te,aa as se,N as ae,b as v,o as p,f as o,e,w as a,c as L,af as oe,W as le,X as re,E as ne,g as b,_ as ie,aB as de,J as ce,G as B,t as r,ak as F,au as ue,ai as me,aj as pe,av as fe,ar as ye,R as ge,a4 as ve}from"./index-Cl2Qds7-.js";import{u as C,f as xe,a as _e,b as be,c as he,d as we,e as Se}from"./echarts-D7VVrSl0.js";const Be={class:"p-4 space-y-4 bg-[#F0F2F5] min-h-screen text-[#333]"},Fe={class:"flex flex-wrap justify-between items-center gap-4"},Ce={class:"flex items-center gap-4"},Ae={class:"flex items-center gap-2"},Ee={class:"flex gap-2"},ke={key:0,class:"metric-card bg-gradient-to-r from-[#3B82F6] to-[#60A5FA]"},Re={class:"card-content"},Le={class:"flex justify-between items-start"},De={class:"flex flex-col"},Ve={class:"metric-value"},We={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Oe={class:"metric-card bg-gradient-to-r from-[#F97316] to-[#FB923C]"},Te={class:"card-content"},ze={class:"flex justify-between items-start"},Pe={class:"flex flex-col"},Me={class:"metric-value"},Ne={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Ye={class:"metric-card bg-gradient-to-r from-[#8B5CF6] to-[#A78BFA]"},$e={class:"card-content"},je={class:"flex justify-between items-start"},Ie={class:"flex flex-col"},Ge={class:"metric-value"},Ue={key:0,class:"mt-4 flex items-center text-xs text-white/80"},He={class:"metric-card bg-gradient-to-r from-[#EF4444] to-[#F87171]"},Je={class:"card-content"},Xe={class:"flex justify-between items-start"},Ze={class:"flex flex-col"},qe={class:"metric-value"},Ke={key:0,class:"mt-4 flex items-center text-xs text-white/80"},Qe={class:"metric-card bg-gradient-to-r from-[#06B6D4] to-[#22D3EE]"},et={class:"card-content"},tt={class:"flex justify-between items-start"},st={class:"flex flex-col"},at={class:"metric-value"},ot={key:0,class:"mt-4 flex items-center text-xs text-white/80"},lt={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},rt={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},it={class:"h-[350px] overflow-y-auto pr-2 pl-4"},dt={class:"flex items-start gap-3 mt-2"},ct={class:"flex flex-col gap-1 w-full"},ut={class:"flex items-center gap-2"},mt={class:"text-sm text-gray-700 leading-relaxed"},pt={class:"font-bold text-gray-900 mr-1"},ft=ee({name:"dashboard_analysis",__name:"index",setup(yt){const y=f("year"),A=f("2025"),x=f(["2025-01","2025-12"]),E=f("all"),w=f({xAxis:[],series:[]}),h=f({xAxis:[],series:[]}),S=f({order_type:[],order_status:[]}),D=f([]),R=f({xAxis:[],series:[]}),k=te(()=>y.value==="year"?!0:y.value==="month"?x.value&&x.value[0]===x.value[1]:!1),l=f({trial_count:0,trial_growth:0,order_count:0,order_growth:0,sales_amount:0,sales_compare_amount:0,collection_amount:0,collection_growth:0,pending_amount:0,pending_growth:0});async function V(){const s={time_dimension:y.value,year:A.value,month_range:x.value||void 0,order_type:E.value};try{const[t,u,i,g,d]=await Promise.all([_e(s),be(s),he(s),we(s),Se(s)]);t.data&&(w.value=t.data,z((c,m)=>m())),u.data&&(h.value=u.data,Y((c,m)=>m())),i.data&&(l.value=i.data),g.data&&(S.value=g.data,M((c,m)=>m()),j((c,m)=>m())),d.data&&(R.value=d.data,G((c,m)=>m()))}catch(t){console.error("Failed to fetch analysis data:",t)}}se([y,A,x,E],()=>{V()}),ae(()=>{V(),U()});const{domRef:T,updateOptions:z}=C(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.95)",borderWidth:0,textStyle:{color:"#333"},shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.1)"},grid:{left:"12%",right:"5%",bottom:"10%",top:"15%"},legend:{data:["销售额","收款额","试用量"],top:0,itemWidth:10,itemHeight:10,textStyle:{color:"#666"}},xAxis:{type:"category",data:w.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280"}},yAxis:[{type:"value",name:"金额 (元)",nameTextStyle:{color:"#6B7280"},axisLabel:{color:"#6B7280"},splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}}},{type:"value",name:"试用量",nameTextStyle:{color:"#6B7280"},axisLabel:{color:"#6B7280"},splitLine:{show:!1}}],series:[{name:"销售额",type:"bar",barWidth:"15%",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#2dd4bf"},{offset:1,color:"rgba(45, 212, 191, 0.2)"}]}},data:w.value.series.map(s=>s.sales_amount)},{name:"收款额",type:"bar",barWidth:"15%",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#60a5fa"},{offset:1,color:"rgba(96, 165, 250, 0.2)"}]}},data:w.value.series.map(s=>s.collection_amount)},{name:"试用量",type:"line",yAxisIndex:1,smooth:!0,symbolSize:8,lineStyle:{width:3,color:"#fcd34d"},itemStyle:{color:"#fcd34d",borderColor:"#fff",borderWidth:2},data:w.value.series.map(s=>s.trial_count)}]})),{domRef:P,updateOptions:M}=C(()=>({tooltip:{trigger:"item"},legend:{bottom:"0%",left:"center",itemWidth:10,itemHeight:10,textStyle:{color:"#666"},formatter:s=>{const t=S.value?.order_type||[],u=t.find(d=>d.name===s),i=t.reduce((d,c)=>d+c.value,0)||0,g=u&&i>0?(u.value/i*100).toFixed(1)+"%":"0%";return`${s}  (${g})`}},series:[{name:"订单类型",type:"pie",radius:["45%","70%"],center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:8,borderColor:"#fff",borderWidth:3},label:{show:!1},data:(S.value?.order_type||[]).map(s=>({name:s.name,value:s.value,itemStyle:{color:s.name==="新购"?"#2dd4bf":s.name==="续费"?"#60a5fa":s.name==="增购"?"#818cf8":s.name==="人工服务"?"#fb923c":s.name==="项目实施"?"#f472b6":"#ccc"}}))}]})),{domRef:N,updateOptions:Y}=C(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},backgroundColor:"rgba(255, 255, 255, 0.95)",textStyle:{color:"#333"}},legend:{data:["企业销售额","个人销售额","企业试用量","个人试用量"],bottom:0,itemWidth:10,itemHeight:10,textStyle:{color:"#666"}},grid:{left:"12%",right:"5%",bottom:"15%",top:"15%"},xAxis:{type:"category",data:h.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280"}},yAxis:[{type:"value",name:"金额 (元)",axisLabel:{color:"#6B7280"},splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}}},{type:"value",name:"试用量",axisLabel:{color:"#6B7280"},splitLine:{show:!1}}],series:[{name:"企业销售额",type:"bar",barGap:0,itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#fb923c"},{offset:1,color:"rgba(251, 146, 60, 0.2)"}]}},data:h.value.series.map(s=>s.enterprise_sales)},{name:"个人销售额",type:"bar",itemStyle:{borderRadius:[4,4,0,0],color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#06b6d4"},{offset:1,color:"rgba(6, 182, 212, 0.2)"}]}},data:h.value.series.map(s=>s.personal_sales)},{name:"企业试用量",type:"line",yAxisIndex:1,smooth:!0,symbol:"circle",symbolSize:8,lineStyle:{width:2,color:"#2dd4bf"},itemStyle:{color:"#2dd4bf",borderColor:"#fff",borderWidth:2},data:h.value.series.map(s=>s.enterprise_trial)},{name:"个人试用量",type:"line",yAxisIndex:1,smooth:!0,symbol:"circle",symbolSize:8,lineStyle:{width:2,color:"#818cf8"},itemStyle:{color:"#818cf8",borderColor:"#fff",borderWidth:2},data:h.value.series.map(s=>s.personal_trial)}]})),{domRef:$,updateOptions:j}=C(()=>({tooltip:{trigger:"item"},legend:{bottom:"0%",left:"center",textStyle:{color:"#666"},formatter:s=>{const t=S.value?.order_status||[],u=t.find(d=>d.name===s),i=t.reduce((d,c)=>d+c.value,0)||0,g=u&&i>0?(u.value/i*100).toFixed(1)+"%":"0%";return`${s}  (${g})`}},series:[{name:"订单状态",type:"pie",radius:"60%",center:["50%","45%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:4,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"outside",formatter:`{b}
{d}%`},data:(S.value?.order_status||[]).map(s=>({name:s.name,value:s.value,itemStyle:{color:s.name==="已成交"?"#34d399":s.name==="待付款"?"#60a5fa":s.name==="部分付款"?"#fbbf24":s.name==="已退款"?"#f87171":s.name==="退款中"?"#fca5a5":s.name==="部分退款"?"#fb923c":s.name==="已作废"?"#9ca3af":s.name==="已取消"?"#8b5cf6":"#ccc"}}))}]})),{domRef:I,updateOptions:G}=C(()=>({tooltip:{trigger:"axis",axisPointer:{type:"line",lineStyle:{type:"dashed",color:"#ccc"}},backgroundColor:"rgba(255, 255, 255, 0.95)",textStyle:{color:"#333"}},legend:{show:!1},grid:{left:"12%",right:"5%",bottom:"10%",top:"15%"},xAxis:{type:"category",boundaryGap:!1,data:R.value.xAxis,axisLine:{lineStyle:{color:"#E5E7EB"}},axisLabel:{color:"#6B7280",formatter:s=>{if(!s)return"";const t=s.split("-");return t.length===2?`${Number(t[1])}月`:s}}},yAxis:{type:"value",splitLine:{lineStyle:{type:"dashed",color:"#F3F4F6"}},axisLabel:{color:"#6B7280"}},series:[{name:"新增客户",type:"line",smooth:!0,symbol:"circle",symbolSize:8,showSymbol:!0,lineStyle:{width:3,color:"#22D3EE"},itemStyle:{color:"#fff",borderColor:"#22D3EE",borderWidth:2},label:{show:!0,position:"top",color:"#0891B2"},areaStyle:{opacity:.8,color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(34, 211, 238, 0.6)"},{offset:1,color:"rgba(34, 211, 238, 0)"}]}},emphasis:{focus:"series"},data:R.value.series}]}));async function U(){try{const{data:s}=await xe();s&&(D.value=s.activities)}catch(s){console.error("Failed to fetch activities:",s)}}function H(s){return s?s.replace("T"," ").substring(0,19):""}const W={0:{label:"个人",type:"warning"},1:{label:"企业",type:"success"}},J={Wechat:"微信",Phone:"电话",Visit:"拜访",Email:"邮件"};function X(s){if(!s)return"";const t=s.trim().charAt(0);return/^[a-zA-Z]/.test(t)?t.toUpperCase():t}return(s,t)=>{const u=oe,i=re,g=le,d=ie,c=ne,m=de,_=ce,Z=ye,O=ge,q=fe,K=ue;return p(),v("div",Be,[o(_,{shadow:"never",class:"!border-none !bg-white rounded-lg shadow-sm","body-style":{padding:"16px"}},{default:a(()=>[e("div",Fe,[e("div",Ce,[t[7]||(t[7]=e("div",{class:"font-bold text-lg border-l-4 border-[#3B82F6] pl-3 text-gray-800"},"销售分析看板",-1)),e("div",Ae,[y.value==="year"?(p(),L(u,{key:0,modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=n=>A.value=n),type:"year",placeholder:"年份",size:"default",style:{width:"100px"},"value-format":"YYYY",clearable:!1},null,8,["modelValue"])):(p(),L(u,{key:1,modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=n=>x.value=n),type:"monthrange","range-separator":"-","start-placeholder":"开始","end-placeholder":"结束",size:"default",style:{width:"200px"},"value-format":"YYYY-MM",clearable:!1},null,8,["modelValue"])),o(g,{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=n=>E.value=n),size:"default",style:{width:"110px"}},{default:a(()=>[o(i,{label:"全部订单",value:"all"}),o(i,{label:"新购",value:"new"}),o(i,{label:"续费",value:"renew"}),o(i,{label:"增购",value:"upsell"}),o(i,{label:"人工服务",value:"service"}),o(i,{label:"项目实施",value:"implementation"})]),_:1},8,["modelValue"]),e("div",Ee,[o(c,{type:"primary",class:"!bg-[#3B82F6] !border-[#3B82F6] hover:!bg-[#2563EB]"},{icon:a(()=>[o(d,{icon:"mdi:magnify",class:"text-lg"})]),default:a(()=>[t[5]||(t[5]=b(" 查询 ",-1))]),_:1}),o(c,{class:"!text-[#666] hover:!text-[#3B82F6] hover:!border-[#3B82F6]"},{icon:a(()=>[o(d,{icon:"mdi:refresh",class:"text-lg"})]),default:a(()=>[t[6]||(t[6]=b(" 重置 ",-1))]),_:1})])])]),o(m,null,{default:a(()=>[o(c,{type:y.value==="month"?"primary":"default",onClick:t[3]||(t[3]=n=>y.value="month"),class:"!h-8"},{default:a(()=>[...t[8]||(t[8]=[b("月",-1)])]),_:1},8,["type"]),o(c,{type:y.value==="year"?"primary":"default",onClick:t[4]||(t[4]=n=>y.value="year"),class:"!h-8"},{default:a(()=>[...t[9]||(t[9]=[b("年",-1)])]),_:1},8,["type"])]),_:1})])]),_:1}),e("div",{class:F(["grid grid-cols-1 md:grid-cols-3 gap-4","lg:grid-cols-5"])},[(p(),v("div",ke,[e("div",Re,[e("div",Le,[e("div",De,[t[10]||(t[10]=e("span",{class:"metric-label"},"试用量 (单)",-1)),e("span",Ve,r(l.value.trial_count),1)]),t[11]||(t[11]=e("div",{class:"i-mdi-account-plus text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(p(),v("div",We,[e("span",null,"较上期 "+r(l.value.trial_growth>=0?"+":"")+r(l.value.trial_growth),1),e("div",{class:F([l.value.trial_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):B("",!0)])])),e("div",Oe,[e("div",Te,[e("div",ze,[e("div",Pe,[t[12]||(t[12]=e("span",{class:"metric-label"},"订单量 (单)",-1)),e("span",Me,r(l.value.order_count),1)]),t[13]||(t[13]=e("div",{class:"i-mdi-cart text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(p(),v("div",Ne,[e("span",null,"较上期 "+r(l.value.order_growth>=0?"+":"")+r(l.value.order_growth),1),e("div",{class:F([l.value.order_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):B("",!0)])]),e("div",Ye,[e("div",$e,[e("div",je,[e("div",Ie,[t[14]||(t[14]=e("span",{class:"metric-label"},"销售额 (元)",-1)),e("span",Ge,r(Math.round(l.value.sales_amount).toLocaleString()),1)]),t[15]||(t[15]=e("div",{class:"i-mdi-currency-usd text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(p(),v("div",Ue,[e("span",null,"较上期 "+r(l.value.sales_amount-l.value.sales_compare_amount>=0?"+":"")+r(Math.round(l.value.sales_amount-l.value.sales_compare_amount).toLocaleString())+" 元",1),e("div",{class:F([l.value.sales_amount-l.value.sales_compare_amount>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):B("",!0)])]),e("div",He,[e("div",Je,[e("div",Xe,[e("div",Ze,[t[16]||(t[16]=e("span",{class:"metric-label"},"回款金额 (元)",-1)),e("span",qe,r(Math.round(l.value.collection_amount).toLocaleString()),1)]),t[17]||(t[17]=e("div",{class:"i-mdi-cash-check text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),k.value?(p(),v("div",Ke,[e("span",null,"较上期 "+r(l.value.collection_growth>=0?"+":"")+r(Math.round(l.value.collection_growth).toLocaleString())+" 元",1),e("div",{class:F([l.value.collection_growth>=0?"i-mdi-trending-up":"i-mdi-trending-down","ml-1"])},null,2)])):B("",!0)])]),e("div",Qe,[e("div",et,[e("div",tt,[e("div",st,[t[18]||(t[18]=e("span",{class:"metric-label"},"待回款 (元)",-1)),e("span",at,r(Math.round(l.value.pending_amount).toLocaleString()),1)]),t[19]||(t[19]=e("div",{class:"i-mdi-clock-alert text-3xl text-white/30 p-2 bg-white/10 rounded-lg"},null,-1))]),l.value.pending_amount>5e3?(p(),v("div",ot,[...t[20]||(t[20]=[e("span",null,"需加紧催收",-1)])])):B("",!0)])])],2),e("div",lt,[o(_,{class:"lg:col-span-2 !border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:a(()=>[...t[21]||(t[21]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"销售与收款趋势")],-1)])]),default:a(()=>[e("div",{ref_key:"trendChartRef",ref:T,class:"w-full h-[380px]"},null,512)]),_:1}),o(_,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:a(()=>[...t[22]||(t[22]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"订单类型分布")],-1)])]),default:a(()=>[e("div",{ref_key:"typePieRef",ref:P,class:"w-full h-[380px]"},null,512)]),_:1})]),e("div",rt,[o(_,{class:"lg:col-span-2 !border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:a(()=>[...t[23]||(t[23]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"客户对比 (企业 vs 个人)")],-1)])]),default:a(()=>[e("div",{ref_key:"comparisonChartRef",ref:N,class:"w-full h-[350px]"},null,512)]),_:1}),o(_,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:a(()=>[...t[24]||(t[24]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"订单状态占比分析")],-1)])]),default:a(()=>[e("div",{ref_key:"statusPieRef",ref:$,class:"w-full h-[350px]"},null,512)]),_:1})]),e("div",nt,[o(_,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:a(()=>[...t[25]||(t[25]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"用户跟进记录")],-1)])]),default:a(()=>[e("div",it,[o(K,null,{default:a(()=>[(p(!0),v(me,null,pe(D.value,(n,Q)=>(p(),L(q,{key:Q,color:n.color,timestamp:H(n.timestamp),placement:"top"},{default:a(()=>[e("div",dt,[o(Z,{size:40,class:"flex-shrink-0 font-bold text-lg !bg-[#3B82F6] text-white"},{default:a(()=>[b(r(X(n.client_name)),1)]),_:2},1024),e("div",ct,[e("div",ut,[o(O,{size:"small",type:W[n.client_type]?.type||"info",effect:"plain",class:"!rounded-md"},{default:a(()=>[b(r(W[n.client_type]?.label||"未知"),1)]),_:2},1032,["type"]),o(O,{size:"small",type:"info",effect:"plain",class:"!rounded-md"},{default:a(()=>[b(r(J[n.method]||n.method),1)]),_:2},1024)]),e("div",mt,[e("span",pt,r(n.client_name),1),e("span",null,r(n.content),1)])])])]),_:2},1032,["color","timestamp"]))),128))]),_:1})])]),_:1}),o(_,{class:"!border-none shadow-sm rounded-lg","body-style":{padding:"20px"}},{header:a(()=>[...t[26]||(t[26]=[e("div",{class:"flex items-center gap-2"},[e("div",{class:"w-1 h-4 bg-[#3B82F6] rounded-sm"}),e("span",{class:"font-bold text-gray-800"},"最近6个月新增客户信息")],-1)])]),default:a(()=>[e("div",{ref_key:"newCustomerChartRef",ref:I,class:"w-full h-[350px]"},null,512)]),_:1})])])}}}),xt=ve(ft,[["__scopeId","data-v-a888aeaa"]]);export{xt as default};
