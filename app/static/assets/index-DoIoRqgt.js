import{aq as w,d as W,au as X,r as i,N as z,b as $,o as c,f as a,w as t,y as Q,p as Z,q as x,x as D,E as ee,g as r,t as s,J as ae,e as R,O as le,c as k,ai as te,aj as oe,R as ne,h as se,ab as re,P as ue,G as L,ag as de,W as me,X as ie,ah as ce,aw as pe,ao as fe,al as ve,ac as C}from"./index-tAfeRux5.js";import{f as _e}from"./role-Crw7V5Qz.js";function ge(d){return w({url:"/user",method:"get",params:d})}function be(d){return w({url:"/user",method:"post",data:d})}function ye(d,u){return w({url:`/user/${d}`,method:"put",data:u})}function he(d){return w({url:`/user/${d}`,method:"delete"})}const $e={class:"h-full overflow-hidden flex flex-col p-4"},ke={class:"mb-4"},we={key:1},Ve={key:0,class:"text-xs text-gray-400 mt-1"},Ee={class:"dialog-footer"},Ne=W({name:"manage_user",__name:"index",setup(d){const{t:u}=X(),V=i(!1),h=i([]),N=i([]),p=i({username:"",nickname:""}),_=i(!1),f=i("add"),E=i(""),n=i({username:"",password:"",nickname:"",role_id:"",is_active:!0});async function A(){try{const e=await _e();e.data&&Array.isArray(e.data)&&(N.value=e.data)}catch(e){console.error("Error fetching role list:",e)}}async function b(){V.value=!0;try{const e=await ge(p.value);e.data&&Array.isArray(e.data)?h.value=e.data:(console.warn("User list data is not an array:",e.data),h.value=[])}catch(e){console.error("Error fetching user list:",e),h.value=[]}finally{V.value=!1}}function U(){b()}function M(){p.value={username:"",nickname:""},b()}function q(){f.value="add",E.value="",n.value={username:"",password:"",nickname:"",role_id:"",is_active:!0},_.value=!0}function I(e){f.value="edit",E.value=e.id,n.value={username:e.username,nickname:e.nickname,role_id:e.role?.id||e.role_id||"",is_active:e.is_active,password:""},_.value=!0}async function Y(e){try{await ve.confirm(u("manage.user.deleteConfirm"),u("common.warning"),{type:"warning",confirmButtonText:u("common.delete"),cancelButtonText:u("common.cancel")}),await he(e.id),C.success(u("common.deleteSuccess")),b()}catch{}}async function F(){try{f.value==="add"?(await be(n.value),C.success(u("common.addSuccess"))):(await ye(E.value,n.value),C.success(u("common.updateSuccess"))),_.value=!1,b()}catch(e){console.error("Error submitting user form:",e)}}return z(()=>{A(),b()}),(e,o)=>{const y=x,m=Z,v=ee,S=Q,T=ae,g=oe,B=ne,K=te,j=ce,G=de,H=pe,O=fe,P=ue;return c(),$("div",$e,[a(T,{class:"mb-4"},{default:t(()=>[a(S,{inline:!0,model:p.value},{default:t(()=>[a(m,{label:e.$t("manage.user.userName")},{default:t(()=>[a(y,{modelValue:p.value.username,"onUpdate:modelValue":o[0]||(o[0]=l=>p.value.username=l),placeholder:e.$t("manage.user.form.userName"),clearable:"",onKeyup:D(U,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.user.nickName")},{default:t(()=>[a(y,{modelValue:p.value.nickname,"onUpdate:modelValue":o[1]||(o[1]=l=>p.value.nickname=l),placeholder:e.$t("manage.user.form.nickName"),clearable:"",onKeyup:D(U,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,null,{default:t(()=>[a(v,{type:"primary",onClick:U},{default:t(()=>[r(s(e.$t("common.search")),1)]),_:1}),a(v,{onClick:M},{default:t(()=>[r(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(T,{class:"flex-1 overflow-hidden flex flex-col"},{default:t(()=>[R("div",ke,[a(v,{type:"primary",onClick:q},{default:t(()=>[r(s(e.$t("manage.user.addUser")),1)]),_:1})]),le((c(),k(K,{data:h.value,border:"",style:{width:"100%",flex:"1",overflow:"auto"}},{default:t(()=>[a(g,{prop:"username",label:e.$t("manage.user.userName"),"min-width":"120"},null,8,["label"]),a(g,{prop:"nickname",label:e.$t("manage.user.nickName"),"min-width":"120"},null,8,["label"]),a(g,{prop:"role",label:e.$t("manage.user.userRole"),"min-width":"120"},{default:t(({row:l})=>[l.role?(c(),k(B,{key:0},{default:t(()=>[r(s(l.role.name),1)]),_:2},1024)):(c(),$("span",we,"-"))]),_:1},8,["label"]),a(g,{prop:"is_active",label:e.$t("manage.user.userStatus"),"min-width":"100"},{default:t(({row:l})=>[a(B,{type:l.is_active?"success":"danger"},{default:t(()=>[r(s(l.is_active?e.$t("common.status.enable"):e.$t("common.status.disable")),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(g,{prop:"created_at",label:e.$t("manage.user.createTime"),"min-width":"160"},{default:t(({row:l})=>[r(s(se(re)(l.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["label"]),a(g,{label:e.$t("common.action"),width:"180",fixed:"right"},{default:t(({row:l})=>[a(v,{link:"",type:"primary",onClick:J=>I(l)},{default:t(()=>[r(s(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),a(v,{link:"",type:"danger",onClick:J=>Y(l)},{default:t(()=>[r(s(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[P,V.value]])]),_:1}),a(O,{modelValue:_.value,"onUpdate:modelValue":o[8]||(o[8]=l=>_.value=l),title:f.value==="add"?e.$t("manage.user.addUser"):e.$t("manage.user.editUser"),width:"500px"},{footer:t(()=>[R("span",Ee,[a(v,{onClick:o[7]||(o[7]=l=>_.value=!1)},{default:t(()=>[r(s(e.$t("common.cancel")),1)]),_:1}),a(v,{type:"primary",onClick:F},{default:t(()=>[r(s(e.$t("common.confirm")),1)]),_:1})])]),default:t(()=>[a(S,{model:n.value,"label-width":"80px"},{default:t(()=>[a(m,{label:e.$t("manage.user.userName")},{default:t(()=>[a(y,{modelValue:n.value.username,"onUpdate:modelValue":o[2]||(o[2]=l=>n.value.username=l),placeholder:e.$t("manage.user.form.userName"),disabled:f.value==="edit"},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),f.value==="add"||n.value.password?(c(),k(m,{key:0,label:e.$t("manage.user.password")},{default:t(()=>[a(y,{modelValue:n.value.password,"onUpdate:modelValue":o[3]||(o[3]=l=>n.value.password=l),type:"password",placeholder:e.$t("manage.user.form.password"),"show-password":""},null,8,["modelValue","placeholder"]),f.value==="edit"?(c(),$("div",Ve,s(e.$t("manage.user.form.passwordTip")),1)):L("",!0)]),_:1},8,["label"])):L("",!0),a(m,{label:e.$t("manage.user.nickName")},{default:t(()=>[a(y,{modelValue:n.value.nickname,"onUpdate:modelValue":o[4]||(o[4]=l=>n.value.nickname=l),placeholder:e.$t("manage.user.form.nickName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.user.userRole")},{default:t(()=>[a(G,{modelValue:n.value.role_id,"onUpdate:modelValue":o[5]||(o[5]=l=>n.value.role_id=l),placeholder:e.$t("manage.user.form.userRole"),clearable:""},{default:t(()=>[(c(!0),$(me,null,ie(N.value,l=>(c(),k(j,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),a(m,{label:e.$t("manage.user.userStatus")},{default:t(()=>[a(H,{modelValue:n.value.is_active,"onUpdate:modelValue":o[6]||(o[6]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ne as default};
