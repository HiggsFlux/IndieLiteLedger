import{at as w,d as P,r,N as J,b as V,o as i,f as e,w as t,y as W,p as X,q as z,x as L,E as Q,g as s,J as Z,e as A,O as ee,c as g,aj as ae,ak as le,R as te,t as E,h as oe,ac as ne,P as se,G as M,ah as ue,W as de,X as re,ai as ie,ay as me,ar as ce,am as pe,ad as C}from"./index-CcZaxT8H.js";import{f as fe}from"./role-DHXwtltp.js";function _e(u){return w({url:"/user",method:"get",params:u})}function ve(u){return w({url:"/user",method:"post",data:u})}function ye(u,v){return w({url:`/user/${u}`,method:"put",data:v})}function be(u){return w({url:`/user/${u}`,method:"delete"})}const ke={class:"h-full overflow-hidden flex flex-col p-4"},Ve={class:"mb-4"},ge={key:1},we={key:0,class:"text-xs text-gray-400 mt-1"},xe={class:"dialog-footer"},Ce=P({name:"manage_user",__name:"index",setup(u){const v=r(!1),k=r([]),U=r([]),m=r({username:"",nickname:""}),f=r(!1),c=r("add"),x=r(""),n=r({username:"",password:"",nickname:"",role_id:"",is_active:!0});async function N(){try{const o=await fe();o.data&&Array.isArray(o.data)&&(U.value=o.data)}catch(o){console.error("Error fetching role list:",o)}}async function y(){v.value=!0;try{const o=await _e(m.value);o.data&&Array.isArray(o.data)?k.value=o.data:(console.warn("User list data is not an array:",o.data),k.value=[])}catch(o){console.error("Error fetching user list:",o),k.value=[]}finally{v.value=!1}}function h(){y()}function S(){m.value={username:"",nickname:""},y()}function $(){c.value="add",x.value="",n.value={username:"",password:"",nickname:"",role_id:"",is_active:!0},f.value=!0}function R(o){c.value="edit",x.value=o.id,n.value={username:o.username,nickname:o.nickname,role_id:o.role?.id||o.role_id||"",is_active:o.is_active,password:""},f.value=!0}async function Y(o){try{await pe.confirm("确定要删除此用户吗？","警告",{type:"warning",confirmButtonText:"删除",cancelButtonText:"取消"}),await be(o.id),C.success("删除成功"),y()}catch{}}async function q(){try{c.value==="add"?(await ve(n.value),C.success("创建成功")):(await ye(x.value,n.value),C.success("更新成功")),f.value=!1,y()}catch(o){console.error("Error submitting user form:",o)}}return J(()=>{N(),y()}),(o,a)=>{const b=z,d=X,p=Q,B=W,D=Z,_=le,T=te,F=ae,I=ie,K=ue,j=me,G=ce,H=se;return i(),V("div",ke,[e(D,{class:"mb-4"},{default:t(()=>[e(B,{inline:!0,model:m.value},{default:t(()=>[e(d,{label:"用户名"},{default:t(()=>[e(b,{modelValue:m.value.username,"onUpdate:modelValue":a[0]||(a[0]=l=>m.value.username=l),placeholder:"请输入用户名",clearable:"",onKeyup:L(h,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{label:"昵称"},{default:t(()=>[e(b,{modelValue:m.value.nickname,"onUpdate:modelValue":a[1]||(a[1]=l=>m.value.nickname=l),placeholder:"请输入昵称",clearable:"",onKeyup:L(h,["enter"])},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(p,{type:"primary",onClick:h},{default:t(()=>[...a[9]||(a[9]=[s("查询",-1)])]),_:1}),e(p,{onClick:S},{default:t(()=>[...a[10]||(a[10]=[s("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(D,{class:"flex-1 overflow-hidden flex flex-col"},{default:t(()=>[A("div",Ve,[e(p,{type:"primary",onClick:$},{default:t(()=>[...a[11]||(a[11]=[s("新增用户",-1)])]),_:1})]),ee((i(),g(F,{data:k.value,border:"",style:{width:"100%",flex:"1",overflow:"auto"}},{default:t(()=>[e(_,{prop:"username",label:"用户名","min-width":"120"}),e(_,{prop:"nickname",label:"昵称","min-width":"120"}),e(_,{prop:"role",label:"角色","min-width":"120"},{default:t(({row:l})=>[l.role?(i(),g(T,{key:0},{default:t(()=>[s(E(l.role.name),1)]),_:2},1024)):(i(),V("span",ge,"-"))]),_:1}),e(_,{prop:"is_active",label:"状态","min-width":"100"},{default:t(({row:l})=>[e(T,{type:l.is_active?"success":"danger"},{default:t(()=>[s(E(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"created_at",label:"创建时间","min-width":"160"},{default:t(({row:l})=>[s(E(oe(ne)(l.created_at).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1}),e(_,{label:"操作",width:"180",fixed:"right"},{default:t(({row:l})=>[e(p,{link:"",type:"primary",onClick:O=>R(l)},{default:t(()=>[...a[12]||(a[12]=[s("编辑",-1)])]),_:2},1032,["onClick"]),e(p,{link:"",type:"danger",onClick:O=>Y(l)},{default:t(()=>[...a[13]||(a[13]=[s("删除",-1)])]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,v.value]])]),_:1}),e(G,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=l=>f.value=l),title:c.value==="add"?"新增用户":"编辑用户",width:"500px"},{footer:t(()=>[A("span",xe,[e(p,{onClick:a[7]||(a[7]=l=>f.value=!1)},{default:t(()=>[...a[14]||(a[14]=[s("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:q},{default:t(()=>[...a[15]||(a[15]=[s("确定",-1)])]),_:1})])]),default:t(()=>[e(B,{model:n.value,"label-width":"80px"},{default:t(()=>[e(d,{label:"用户名"},{default:t(()=>[e(b,{modelValue:n.value.username,"onUpdate:modelValue":a[2]||(a[2]=l=>n.value.username=l),placeholder:"请输入用户名",disabled:c.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),c.value==="add"||n.value.password?(i(),g(d,{key:0,label:"密码"},{default:t(()=>[e(b,{modelValue:n.value.password,"onUpdate:modelValue":a[3]||(a[3]=l=>n.value.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"]),c.value==="edit"?(i(),V("div",we,"留空则不修改密码")):M("",!0)]),_:1})):M("",!0),e(d,{label:"昵称"},{default:t(()=>[e(b,{modelValue:n.value.nickname,"onUpdate:modelValue":a[4]||(a[4]=l=>n.value.nickname=l),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),e(d,{label:"角色"},{default:t(()=>[e(K,{modelValue:n.value.role_id,"onUpdate:modelValue":a[5]||(a[5]=l=>n.value.role_id=l),placeholder:"请选择角色",clearable:""},{default:t(()=>[(i(!0),V(de,null,re(U.value,l=>(i(),g(I,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"状态"},{default:t(()=>[e(j,{modelValue:n.value.is_active,"onUpdate:modelValue":a[6]||(a[6]=l=>n.value.is_active=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Ce as default};
